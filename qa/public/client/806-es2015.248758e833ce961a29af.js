"use strict";(self.webpackChunkbedesk=self.webpackChunkbedesk||[]).push([[806],{30617:function(t,e,a){a.r(e),a.d(e,{TicketingModule:function(){return Ma}});var i=a(38583),n=a(3679),s=a(24668),r=a(83326),o=a(88002),c=a(87519),l=a(37716),d=a(87291),u=a(19244),p=a(96605),g=a(70837),h=a(93342),m=a(54395),b=a(43190),f=a(5304),v=a(69958),x=a(68939),_=a(22238),Z=a(65987),k=a(83644),w=a(45418),T=a(35866),y=a(13913),A=a(4928),C=a(15515),q=a(76627),O=a(26996),I=a(74180),M=a(15381),U=a(64058),F=a(1303),S=a(32141),Q=a(12178),J=a(6050),P=a(58341);function Y(t,e){1&t&&l._UZ(0,"mat-progress-bar",12)}function N(t,e){if(1&t&&(l.TgZ(0,"mat-chip",31),l._uU(1),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(1),l.Oqu(t.display_name)}}function B(t,e){if(1&t&&(l.ynx(0),l.YNc(1,N,2,1,"mat-chip",30),l.BQk()),2&t){const t=e.$implicit;l.xp6(1),l.Q6J("ngIf","status"!==t.type)}}function D(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"tr",13),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().openConversation(e)}),l._UZ(1,"td",14),l.TgZ(2,"td",15),l._uU(3),l.qZA(),l.TgZ(4,"td",16),l._UZ(5,"img",17),l.qZA(),l.TgZ(6,"td",18),l.TgZ(7,"div",19),l.TgZ(8,"mat-chip-list",20),l.YNc(9,B,2,1,"ng-container",21),l.qZA(),l.TgZ(10,"div",22),l._uU(11),l.qZA(),l.qZA(),l.TgZ(12,"div",23),l._uU(13),l.qZA(),l.qZA(),l.TgZ(14,"td",24),l.TgZ(15,"span",25),l._uU(16),l.qZA(),l.qZA(),l.TgZ(17,"td",26),l.TgZ(18,"div",27),l._uU(19),l.qZA(),l.qZA(),l.TgZ(20,"td",28),l._uU(21),l.qZA(),l.TgZ(22,"td",29),l.TgZ(23,"div",27),l._uU(24),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,a=l.oxw();l.ekj("not-closed",!t.closed_at)("open","open"===t.status)("selected",a.ticketSelected(t))("fadeIn",t.animated),l.xp6(1),l.Q6J("table-body-checkbox",t.id),l.xp6(2),l.Oqu(null==t||null==t.user?null:t.user.display_name),l.xp6(2),l.s9C("src",null==t||null==t.user?null:t.user.avatar,l.LSH),l.xp6(3),l.Q6J("selectable",!1),l.xp6(1),l.Q6J("ngForOf",t.tags),l.xp6(2),l.Oqu(t.subject),l.xp6(2),l.Oqu(a.getTicketBody(t)),l.xp6(3),l.Oqu(t.replies_count||1),l.xp6(3),l.hij(" ",t.assignee?t.assignee.display_name:""," "),l.xp6(2),l.Oqu(t.id),l.xp6(3),l.Oqu(t.updated_at_formatted)}}const E=["*"];let $=(()=>{class t{constructor(t,e,a,i){this.router=t,this.modal=e,this.mailboxTags=a,this.datatable=i,this.openTicketInModal=!1,this.tickets$=this.datatable.data$}openConversation(t){this.openTicketInModal?this.modal.open(I.D,{ticketId:t.id},{panelClass:"conversation-modal-container"}):this.router.navigate(["mailbox/tickets",t.id],{queryParams:{tagId:this.mailboxTags.activeTagId$.value}})}ticketSelected(t){return this.datatable.selectedRows$.value.includes(t.id)}getTicketBody(t){return t.latest_reply&&t.latest_reply.body?t.latest_reply.body:t.replies&&t.replies.length?t.replies[0].body:void 0}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(s.F0),l.Y36(M.u),l.Y36(d.N),l.Y36(Z.x))},t.\u0275cmp=l.Xpm({type:t,selectors:[["tickets-list"]],inputs:{openTicketInModal:"openTicketInModal"},ngContentSelectors:E,decls:24,vars:6,consts:[["mode","indeterminate","color","accent",4,"ngIf"],[1,"table-container"],[1,"material-table","responsive-table"],["table-header-checkbox",""],["table-sort-header","user_id","trans","",1,"customer-column"],[1,"avatar-column"],["trans",""],["table-sort-header","replies_count",1,"replies-count-column"],["table-sort-header","","trans","",1,"assigned-to-column"],["table-sort-header","id","trans","",1,"number-column"],["table-sort-header","updated_at","trans","",1,"last-updated-column"],["class","animated",3,"not-closed","open","selected","fadeIn","click",4,"ngFor","ngForOf"],["mode","indeterminate","color","accent"],[1,"animated",3,"click"],[3,"table-body-checkbox"],["data-label","Customer",1,"customer-column"],[1,"avatar-column","hidden-on-mobile"],["alt","customer avatar",3,"src"],[1,"summary-column","mobile-no-label"],[1,"title"],[1,"ticket-tags",3,"selectable"],[4,"ngFor","ngForOf"],[1,"title-text","ticket-subject"],[1,"ellipses","ticket-body"],[1,"replies-count-column","hidden-on-mobile"],["title","Replies count",1,"replies-count-number"],["data-label","Assigned To",1,"assigned-to-column"],[1,"column-text-content"],["data-label","ID",1,"number-column"],["data-label","Last Updated",1,"last-updated-column"],["class","mat-compact-chip ticket-tag",4,"ngIf"],[1,"mat-compact-chip","ticket-tag"]],template:function(t,e){1&t&&(l.F$t(),l.YNc(0,Y,1,0,"mat-progress-bar",0),l.ALo(1,"async"),l.TgZ(2,"div",1),l.TgZ(3,"table",2),l.TgZ(4,"thead"),l.TgZ(5,"tr"),l._UZ(6,"th",3),l.TgZ(7,"th",4),l._uU(8,"Customer"),l.qZA(),l._UZ(9,"th",5),l.TgZ(10,"th",6),l._uU(11,"Ticket Summary"),l.qZA(),l._UZ(12,"th",7),l.TgZ(13,"th",8),l._uU(14,"Assigned To"),l.qZA(),l.TgZ(15,"th",9),l._uU(16,"Number"),l.qZA(),l.TgZ(17,"th",10),l._uU(18,"Last Updated"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"tbody"),l.YNc(20,D,25,19,"tr",11),l.ALo(21,"async"),l.qZA(),l.qZA(),l.Hsn(22),l._UZ(23,"datatable-footer"),l.qZA()),2&t&&(l.Q6J("ngIf",l.lcZ(1,2,e.datatable.paginator.loading$)),l.xp6(20),l.Q6J("ngForOf",l.lcZ(21,4,e.tickets$)))},directives:[i.O5,U.e,F.p,C.P,i.sg,S.V,Q.pW,J.O,P.qn,P.HS],pipes:[i.Ov],styles:["[_nghost-%COMP%]{display:block;overflow:auto;height:100%;position:relative}[_nghost-%COMP%]     .no-results-message{padding:65px 0}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:var(--be-background-alternative)}table[_ngcontent-%COMP%]{table-layout:fixed}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:70px;cursor:pointer}tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .title-text[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .number-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .last-updated-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .customer-column[_ngcontent-%COMP%]{font-weight:500;color:var(--be-text)}tbody[_ngcontent-%COMP%]   tr.not-closed[_ngcontent-%COMP%]{background-color:var(--be-background)}tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover:not(.selected){background-color:var(--be-accent-emphasis)}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:35px;background-color:var(--be-background)}.table-checkbox[_ngcontent-%COMP%]{width:75px}.customer-column[_ngcontent-%COMP%]{width:130px;font-weight:500;color:var(--be-secondary-text)}.avatar-column[_ngcontent-%COMP%]{width:110px}.avatar-column[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:38px;height:38px;box-shadow:0 0 0 1px #fff,0 0 1px 2px #aaaeb7;border-radius:50%;margin:0 auto}.status-flag[_ngcontent-%COMP%]{width:15px;height:15px;line-height:15px;font-size:1rem;font-weight:600;text-align:center;border-radius:4px;text-transform:uppercase;color:#fff;background-color:red}.replies-count-column[_ngcontent-%COMP%]{width:50px;text-align:center}.number-column[_ngcontent-%COMP%]{width:90px;padding-right:10px}.last-updated-column[_ngcontent-%COMP%], .assigned-to-column[_ngcontent-%COMP%]{width:125px}.column-text-content[_ngcontent-%COMP%]{max-width:85%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.replies-count-number[_ngcontent-%COMP%]{background-color:var(--be-background-alternative);color:var(--be-secondary-text);border-radius:4px;padding:1px 6px 0;font-size:1.1rem;border:1px solid var(--be-divider-default)}.summary-column[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.summary-column[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center}.summary-column[_ngcontent-%COMP%]   .ticket-body[_ngcontent-%COMP%]{color:var(--be-secondary-text);max-width:98%;overflow:hidden;text-overflow:ellipsis;padding-top:5px}.ticket-tags[_ngcontent-%COMP%]{margin-right:7px}.ticket-tag[_ngcontent-%COMP%]{pointer-events:none}datatable-footer[_ngcontent-%COMP%]{height:45px;background-color:var(--be-background);border-top:1px solid var(--be-divider-default);margin-top:auto}datatable-footer[_ngcontent-%COMP%]     .page-size-input{height:25px;padding-top:0;padding-bottom:0}"]}),t})();var R=a(35718),L=a(24688),j=a(44625),H=a(11436),z=a(33935),V=a(4075),G=a(63297);function X(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",10),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(2).setStatusForSelectedTickets(e)}),l._uU(1),l.qZA()}if(2&t){const t=e.$implicit;l.Q6J("ngClass",t.name),l.xp6(1),l.hij(" ",t.display_name||t.name," ")}}function W(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"assign-ticket-dropdown",1),l.NdJ("assigned",function(){return l.CHM(t),l.oxw().ticketsUpdated()}),l.ALo(2,"async"),l.ALo(3,"trans"),l.qZA(),l.TgZ(4,"button",2),l._UZ(5,"mat-icon",3),l.qZA(),l.TgZ(6,"mat-menu",4,5),l.YNc(8,X,2,2,"button",6),l.qZA(),l.TgZ(9,"add-tag-dropdown",7),l.NdJ("tagAdded",function(){return l.CHM(t),l.oxw().ticketsUpdated()}),l.ALo(10,"async"),l.ALo(11,"trans"),l.qZA(),l.TgZ(12,"button",8),l.NdJ("click",function(){return l.CHM(t),l.oxw().maybeDeleteSelectedTickets()}),l.ALo(13,"trans"),l._UZ(14,"mat-icon",9),l.qZA(),l.BQk()}if(2&t){const t=l.MAs(7),e=l.oxw();l.xp6(1),l.Q6J("ticketIds",l.lcZ(2,8,e.datatable.selectedRows$))("matTooltip",l.lcZ(3,10,"Assign")),l.xp6(3),l.Q6J("matMenuTriggerFor",t),l.xp6(2),l.Q6J("overlapTrigger",!1),l.xp6(2),l.Q6J("ngForOf",e.mailboxTags.statusTags),l.xp6(1),l.Q6J("ticketIds",l.lcZ(10,12,e.datatable.selectedRows$))("matTooltip",l.lcZ(11,14,"Add Tag")),l.xp6(3),l.Q6J("matTooltip",l.lcZ(13,16,"Delete"))}}const K=function(){return["tickets.update"]};let tt=(()=>{class t{constructor(t,e,a,i,n){this.tickets=t,this.mailboxTags=e,this.toast=a,this.currentUser=i,this.datatable=n,this.onTicketsUpdated=new l.vpe}get noTicketsSelected(){return!this.datatable.selectedRows$.value.length}setStatusForSelectedTickets(t){this.tickets.changeMultipleTicketsStatus(this.datatable.selectedRows$.value,t).subscribe(()=>{this.ticketsUpdated()})}maybeDeleteSelectedTickets(){this.datatable.confirmResourceDeletion("tickets").subscribe(()=>{this.tickets.deleteMultiple(this.datatable.selectedRows$.value).subscribe(()=>{this.ticketsUpdated(),this.toast.open("Tickets deleted")})})}ticketsUpdated(){this.onTicketsUpdated.emit(),this.mailboxTags.refresh(),this.datatable.reset()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(v.g),l.Y36(d.N),l.Y36(R.F),l.Y36(L.I),l.Y36(Z.x))},t.\u0275cmp=l.Xpm({type:t,selectors:[["ticket-floating-toolbar"]],hostVars:2,hostBindings:function(t,e){2&t&&l.ekj("hidden",e.noTicketsSelected)},outputs:{onTicketsUpdated:"onTicketsUpdated"},decls:1,vars:2,consts:[[4,"ngIf"],[3,"ticketIds","matTooltip","assigned"],[1,"toolbar-item","no-style",3,"matMenuTriggerFor"],["svgIcon","flag-custom"],[1,"status-menu",3,"overlapTrigger"],["ticketStatusMenu","matMenu"],["mat-menu-item","",3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ticketIds","matTooltip","tagAdded"],[1,"no-style","toolbar-item","delete-tickets-button","last",3,"matTooltip","click"],["svgIcon","delete-custom"],["mat-menu-item","",3,"ngClass","click"]],template:function(t,e){1&t&&l.YNc(0,W,15,18,"ng-container",0),2&t&&l.Q6J("ngIf",e.currentUser.hasPermissions(l.DdM(1,K)))},directives:[i.O5,j.H,H.gM,z.p6,q.Hw,z.VK,i.sg,V.$,z.OP,i.mk],pipes:[i.Ov,G.R],styles:["ticket-floating-toolbar{display:flex;position:fixed;top:78px;background-color:var(--be-background);left:calc(50% - 117.5px);min-width:235px;box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px rgba(0,0,0,.141),0 1px 8px rgba(0,0,0,.122);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:10;white-space:nowrap}ticket-floating-toolbar .toolbar-item{position:relative;cursor:pointer;transition:all .2s ease-in-out;padding:15px;border-right:1px solid var(--be-divider-default);line-height:inherit}ticket-floating-toolbar .toolbar-item.last{border-bottom:none}ticket-floating-toolbar .toolbar-item:hover{background-color:var(--be-accent-emphasis)}ticket-floating-toolbar .toolbar-item .mat-icon{color:var(--be-help-center-title-text);vertical-align:bottom;width:28px;height:28px}ticket-floating-toolbar .toolbar-item .status-tag{text-transform:capitalize}\n"],encapsulation:2}),t})();var et=a(76403);function at(t,e){1&t&&(l.TgZ(0,"no-results-message",22),l.TgZ(1,"span",23),l._uU(2,"Nothing To Display."),l.qZA(),l.TgZ(3,"span",24),l._uU(4,"Could not find any tickets matching this search query."),l.qZA(),l.qZA())}const it=function(t){return["/mailbox/users",t]};function nt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"a",25),l.NdJ("click",function(){return l.CHM(t),l.oxw().close()}),l._UZ(1,"img",26),l.TgZ(2,"div",27),l.TgZ(3,"div",28),l._uU(4),l.qZA(),l.TgZ(5,"div",29),l._uU(6),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit;l.Q6J("routerLink",l.VKq(4,it,t.id)),l.xp6(1),l.s9C("src",t.avatar,l.LSH),l.xp6(3),l.Oqu(t.display_name),l.xp6(2),l.Oqu(t.email)}}function st(t,e){1&t&&(l.TgZ(0,"no-results-message",30),l.TgZ(1,"span",23),l._uU(2,"Nothing To Display."),l.qZA(),l.TgZ(3,"span",24),l._uU(4,"Could not find any users matching this search query."),l.qZA(),l.qZA())}function rt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"a",31),l.NdJ("click",function(){return l.CHM(t),l.oxw().close()}),l._UZ(1,"mat-icon",32),l.TgZ(2,"div",33),l.TgZ(3,"div",28),l._uU(4),l.qZA(),l.TgZ(5,"div",29),l._uU(6),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,a=l.oxw();l.Q6J("routerLink",a.urls.article(t)),l.xp6(4),l.Oqu(t.title),l.xp6(2),l.Oqu(t.body)}}function ot(t,e){1&t&&(l.TgZ(0,"no-results-message",34),l.TgZ(1,"span",23),l._uU(2,"Nothing To Display."),l.qZA(),l.TgZ(3,"span",24),l._uU(4,"Could not find any articles matching this search query."),l.qZA(),l.qZA())}let ct=(()=>{class t{constructor(t,e,a,i,s,r){this.dialogRef=t,this.data=e,this.tickets=a,this.urls=i,this.datatable=s,this.mailboxTags=r,this.filters=function(t){var e,a;return[new w.T7({description:"Date ticket was created"}),new w.yH({description:"Date ticket was last updated"}),new w.k4({key:"closed_at",label:"Closed At",description:"Date ticket was closed by customer or agent"}),new k.XQ({type:k.Bq.SelectModel,key:"assigned_to",label:"Assigned",description:"Agent ticket is currently assigned to",component:T.y}),new k.XQ({type:k.Bq.SelectModel,key:"user_id",label:"Customer",description:"Customer that created the ticket",component:T.y}),new k.XQ({type:k.Bq.Select,key:"status",description:"Current status of the ticket",defaultValue:null===(e=t.statusTags[0])||void 0===e?void 0:e.name,options:t.statusTags.map(t=>({key:(0,y.z)(t.display_name),value:t.name}))}),new k.XQ({type:k.Bq.Select,key:"tag",description:"Tags assigned to the ticket",defaultValue:null===(a=t.categoryTags[0])||void 0===a?void 0:a.name,options:t.categoryTags.map(t=>({key:(0,y.z)(t.display_name),value:t.name}))})]}({statusTags:this.mailboxTags.statusTags,categoryTags:this.mailboxTags.categoryTags}),this.results={},this.isSearching=!1,this.searchedOnce=!1,this.activeTab="tickets",this.searchQueryControl=new n.NI,this.hydrate()}ngOnInit(){this.datatable.paginator.dontUpdateQueryParams=!0}ngOnDestroy(){this.datatable.destroy()}close(){this.dialogRef.close()}hydrate(){this.bindToSearchInput(),this.searchQueryControl.setValue(this.data.query)}performSearch(){this.isSearching=!0,this.tickets.search(Object.assign(Object.assign({},this.getSearchQueryParams()),{filters:this.activeFilters,query:this.activeQuery})).pipe((0,x.x)(()=>{this.searchedOnce=!0,this.isSearching=!1})).subscribe(t=>{this.datatable.config?(this.datatable.paginator.response$.next({pagination:t.results.tickets}),this.datatable.config.staticParams=this.getSearchQueryParams()):this.datatable.init({uri:"search/tickets",staticParams:this.getSearchQueryParams(),initialData:t.results.tickets}),this.results=t.results})}bindToSearchInput(){this.searchQueryControl.valueChanges.pipe((0,m.b)(400),(0,c.x)()).subscribe(t=>(this.activeQuery=t,this.performSearch()))}getSearchQueryParams(){return{query:this.searchQueryControl.value,perPage:20,detailed:!0}}onFilterChange(t){this.activeFilters=t,this.performSearch()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(_.so),l.Y36(_.WI),l.Y36(v.g),l.Y36(A.X),l.Y36(Z.x),l.Y36(d.N))},t.\u0275cmp=l.Xpm({type:t,selectors:[["agent-search-modal"]],features:[l._Bn([Z.x])],decls:34,vars:27,consts:[[1,"modal-header"],["mat-dialog-title","","trans","",1,"modal-title"],["type","button","tabindex","-1",1,"close-button","no-style",3,"click"],["svgIcon","close"],["pluralName","tickets, articles and users",3,"searchControl","filters","filterChange"],[1,"search-results"],[1,"tab-menu"],[1,"tab-menu-item","tickets-menu-item",3,"click"],["trans",""],[1,"tab-menu-item","users-menu-item",3,"click"],[1,"tab-menu-item","articles-menu-item",3,"click"],[1,"tabs"],[1,"tab","tickets-tab"],[3,"openTicketInModal"],["svgImage","opened.svg",4,"ngIf"],[1,"tab","users-tab"],["class","user",3,"routerLink","click",4,"ngFor","ngForOf"],["svgImage","people.svg",4,"ngIf"],[1,"tab","articles-tab"],[1,"articles-list"],["class","article",3,"routerLink","click",4,"ngFor","ngForOf"],["svgImage","blog-post.svg",4,"ngIf"],["svgImage","opened.svg"],["primary-text","","trans",""],["secondary-text","","trans",""],[1,"user",3,"routerLink","click"],["alt","customer avatar",1,"avatar",3,"src"],[1,"text"],[1,"title"],[1,"body"],["svgImage","people.svg"],[1,"article",3,"routerLink","click"],["svgIcon","description"],[1,"article-info"],["svgImage","blog-post.svg"]],template:function(t,e){if(1&t&&(l.TgZ(0,"div",0),l.TgZ(1,"h2",1),l._uU(2,"Search"),l.qZA(),l.TgZ(3,"button",2),l.NdJ("click",function(){return e.close()}),l._UZ(4,"mat-icon",3),l.qZA(),l.qZA(),l.TgZ(5,"mat-dialog-content"),l.TgZ(6,"search-input-with-filters",4),l.NdJ("filterChange",function(t){return e.onFilterChange(t)}),l.qZA(),l.TgZ(7,"div",5),l.TgZ(8,"div",6),l.TgZ(9,"div",7),l.NdJ("click",function(){return e.activeTab="tickets"}),l._uU(10),l.ALo(11,"async"),l.TgZ(12,"span",8),l._uU(13,"Tickets"),l.qZA(),l.qZA(),l.TgZ(14,"div",9),l.NdJ("click",function(){return e.activeTab="users"}),l._uU(15),l.TgZ(16,"span",8),l._uU(17,"Users"),l.qZA(),l.qZA(),l.TgZ(18,"div",10),l.NdJ("click",function(){return e.activeTab="articles"}),l._uU(19),l.TgZ(20,"span",8),l._uU(21,"Articles"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(22,"div",11),l.TgZ(23,"div",12),l.TgZ(24,"tickets-list",13),l.YNc(25,at,5,0,"no-results-message",14),l.qZA(),l._UZ(26,"ticket-floating-toolbar"),l.qZA(),l.TgZ(27,"div",15),l.YNc(28,nt,7,6,"a",16),l.YNc(29,st,5,0,"no-results-message",17),l.qZA(),l.TgZ(30,"div",18),l.TgZ(31,"div",19),l.YNc(32,rt,7,3,"a",20),l.YNc(33,ot,5,0,"no-results-message",21),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t){let t;l.xp6(6),l.Q6J("searchControl",e.searchQueryControl)("filters",e.filters),l.xp6(2),l.ekj("visually-hidden",!e.searchedOnce),l.xp6(1),l.ekj("active","tickets"===e.activeTab),l.xp6(1),l.hij(" ",null==(t=l.lcZ(11,25,e.datatable.paginator.response$))||null==t.pagination?null:t.pagination.total," "),l.xp6(4),l.ekj("active","users"===e.activeTab),l.xp6(1),l.hij(" ",null==e.results.users?null:e.results.users.total," "),l.xp6(3),l.ekj("active","articles"===e.activeTab),l.xp6(1),l.hij(" ",null==e.results.articles?null:e.results.articles.total," "),l.xp6(4),l.ekj("hidden","tickets"!==e.activeTab),l.xp6(1),l.Q6J("openTicketInModal",!0),l.xp6(1),l.Q6J("ngIf",!(null!=e.results.tickets&&null!=e.results.tickets.data&&e.results.tickets.data.length||e.isSearching)),l.xp6(2),l.ekj("hidden","users"!==e.activeTab),l.xp6(1),l.Q6J("ngForOf",null==e.results.users?null:e.results.users.data),l.xp6(1),l.Q6J("ngIf",!(null!=e.results.users&&null!=e.results.users.data&&e.results.users.data.length||e.isSearching)),l.xp6(1),l.ekj("hidden","articles"!==e.activeTab),l.xp6(2),l.Q6J("ngForOf",null==e.results.articles?null:e.results.articles.data),l.xp6(1),l.Q6J("ngIf",!(null!=e.results.articles&&null!=e.results.articles.data&&e.results.articles.data.length||e.isSearching))}},directives:[_.uh,C.P,q.Hw,_.xY,O.k,$,i.O5,tt,i.sg,et.U,s.yS],pipes:[i.Ov],styles:[".agent-search-modal-container{height:100%;width:100%;max-width:none!important}.agent-search-modal-container .mat-dialog-container{border-radius:0;background-color:var(--be-background-alternative)}.agent-search-modal-container .mat-dialog-content{max-height:none;min-height:calc(100% - 54px)}.agent-search-modal-container .close-button{position:fixed;top:28px;right:38px;background-color:var(--be-background-alternative)}.agent-search-modal-container .modal-header{margin-bottom:15px}.agent-search-modal-container h2{font-size:2.4rem;font-weight:400}.agent-search-modal-container .search-results{border:1px solid var(--be-divider-default);border-radius:4px;background-color:var(--be-background);min-height:calc(100% - 75px)}.agent-search-modal-container .search-results .tab-menu{display:flex;border-bottom:1px solid var(--be-divider-default)}.agent-search-modal-container .search-results .tab-menu .tab-menu-item{padding:15px;border-bottom:2px solid transparent;cursor:pointer}.agent-search-modal-container .search-results .tab-menu .tab-menu-item.active{border-color:var(--be-accent-default)}.agent-search-modal-container .search-results .tabs{border:1px solid var(--be-divider-default);margin:15px}.agent-search-modal-container .search-results .tabs .tab{min-height:50px}.agent-search-modal-container .search-results .tabs .users-tab{padding:8px}.agent-search-modal-container .search-results .tabs .users-tab .user{display:inline-flex;width:300px;height:80px;border:1px solid var(--be-divider-default);border-radius:4px;padding:15px;margin:8px;color:var(--be-text)}.agent-search-modal-container .search-results .tabs .users-tab .user:hover{background-color:var(--be-accent-emphasis)}.agent-search-modal-container .search-results .tabs .users-tab .user img{margin-right:10px;width:50px;height:50px;-o-object-fit:cover;object-fit:cover}.agent-search-modal-container .search-results .tabs .users-tab .user .text{padding-top:6px;white-space:nowrap;overflow:hidden}.agent-search-modal-container .search-results .tabs .users-tab .user .text .title{font-size:1.5rem;overflow:hidden;text-overflow:ellipsis}.agent-search-modal-container .search-results .tabs .users-tab .user .text .body{color:var(--be-secondary-text);overflow:hidden;text-overflow:ellipsis}.agent-search-modal-container .search-results .tabs .articles-list .article{display:flex;padding:13px;border-bottom:1px solid var(--be-divider-default);color:var(--be-text)}.agent-search-modal-container .search-results .tabs .articles-list .article:last-of-type{border-bottom:none}.agent-search-modal-container .search-results .tabs .articles-list .article:hover{background-color:var(--be-accent-emphasis)}.agent-search-modal-container .search-results .tabs .articles-list .article .mat-icon{width:35px;height:35px;color:var(--be-secondary-text);margin-right:5px}.agent-search-modal-container .search-results .tabs .articles-list .article .article-info .title{font-size:1.6rem}.agent-search-modal-container .search-results .tabs .articles-list .article .article-info .body{word-wrap:break-word;color:var(--be-secondary-text)}.agent-search-modal-container .search-results .tabs tickets-list{background-color:transparent}.agent-search-modal-container .search-results no-results-message{padding:65px 0}.agent-search-modal-container search-input-with-filters{margin-bottom:25px}\n"],encapsulation:2}),t})();var lt=a(25917),dt=a(21554),ut=a(51095),pt=a(75811),gt=a(72458);function ht(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",16),l.NdJ("click",function(e){return l.CHM(t),l.oxw(2).setActiveCategory("tickets"),e.stopPropagation()}),l._uU(1," Conversations "),l.qZA()}if(2&t){const t=l.oxw(2);l.ekj("active","tickets"===t.activeCategory)}}function mt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",17),l.NdJ("click",function(e){return l.CHM(t),l.oxw(2).setActiveCategory("users"),e.stopPropagation()}),l._uU(1," Users "),l.qZA()}if(2&t){const t=l.oxw(2);l.ekj("active","users"===t.activeCategory)}}function bt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",24),l.NdJ("click",function(){l.CHM(t);const e=l.oxw().$implicit;return l.oxw(3).navigateToUser(e.user.id)}),l._uU(1),l.qZA()}if(2&t){const t=l.oxw().$implicit;l.xp6(1),l.hij(" ",t.user.display_name," ")}}function ft(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"mat-option",20),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(3).navigateToTicket(e.id)}),l.TgZ(1,"div",21),l._uU(2),l.qZA(),l.TgZ(3,"div",22),l._uU(4),l.qZA(),l.YNc(5,bt,2,1,"div",23),l.qZA()}if(2&t){const t=e.$implicit;l.xp6(2),l.Oqu(t.subject),l.xp6(2),l.Oqu(t.latest_reply&&t.latest_reply.body),l.xp6(1),l.Q6J("ngIf",t.user)}}function vt(t,e){if(1&t&&(l.TgZ(0,"div",18),l.YNc(1,ft,6,3,"mat-option",19),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",t.results.tickets.data)}}function xt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"mat-option",27),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(3).navigateToUser(e.id)}),l._UZ(1,"img",28),l.TgZ(2,"div",29),l.TgZ(3,"div",21),l._uU(4),l.qZA(),l.TgZ(5,"div",22),l._uU(6),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit;l.xp6(1),l.s9C("src",t.avatar,l.LSH),l.xp6(3),l.Oqu(t.email),l.xp6(2),l.Oqu(t.display_name)}}function _t(t,e){if(1&t&&(l.TgZ(0,"div",25),l.YNc(1,xt,7,3,"mat-option",26),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",t.results.users.data)}}function Zt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",30),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).openSearchModal()}),l.TgZ(1,"span",31),l._uU(2,"View All Results"),l.qZA(),l.qZA()}}function kt(t,e){if(1&t&&(l.TgZ(0,"div",9),l.TgZ(1,"div",10),l.YNc(2,ht,2,2,"div",11),l.YNc(3,mt,2,2,"div",12),l.qZA(),l.YNc(4,vt,2,1,"div",13),l.YNc(5,_t,2,1,"div",14),l.YNc(6,Zt,3,0,"div",15),l.qZA()),2&t){const t=l.oxw();l.xp6(2),l.Q6J("ngIf",t.results.tickets.data.length),l.xp6(1),l.Q6J("ngIf",t.results.users.data.length),l.xp6(1),l.Q6J("ngIf","tickets"===t.activeCategory),l.xp6(1),l.Q6J("ngIf","users"===t.activeCategory),l.xp6(1),l.Q6J("ngIf",t.searchQuery.value)}}function wt(t,e){1&t&&(l.TgZ(0,"div",32),l._uU(1," No tickets or users matching your search query were found. "),l.qZA())}const Tt={data:{tickets:{},users:{},articles:{}}};let yt=(()=>{class t{constructor(t,e,a){this.tickets=t,this.router=e,this.modal=a,this.searchQuery=new n.NI,this.activeCategory="tickets",this.hasResults=!1,this.loadedResultsAtLeastOnce=!1,this.isLoading=!1,this.results={tickets:{data:[]},users:{data:[]}}}ngOnInit(){this.bindToQueryChangeEvent()}setActiveCategory(t){this.activeCategory=t}navigateToTicket(t){this.reset(),this.router.navigate(["/mailbox/tickets",t])}navigateToUser(t){this.reset(),this.router.navigate(["/mailbox/users",t])}openSearchModal(){const t=this.searchQuery.value;this.reset(),this.modal.open(ct,{query:t},{panelClass:"agent-search-modal-container"})}search(t=null){return t?(this.isLoading=!0,this.tickets.search({query:t,perPage:10}).pipe((0,h.b)(t=>{this.hasResults=!(!t.results.tickets.total&&!t.results.users.total),this.loadedResultsAtLeastOnce=!0,this.results=t.results,this.isLoading=!1,this.setActiveCategory(t.results.tickets.total?"tickets":"users")}))):(0,lt.of)(Tt)}reset(){this.searchQuery.setValue(null),this.hasResults=!1,this.results=null,this.activeCategory="tickets",this.loadedResultsAtLeastOnce=!1}bindToQueryChangeEvent(){this.searchQuery.valueChanges.pipe((0,m.b)(250),(0,c.x)(),(0,b.w)(t=>this.search(t)),(0,f.K)(()=>(0,lt.of)(Tt))).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(v.g),l.Y36(s.F0),l.Y36(M.u))},t.\u0275cmp=l.Xpm({type:t,selectors:[["ticket-search-dropdown"]],features:[l._Bn([v.g])],decls:9,vars:4,consts:[[1,"input-container",3,"ngSubmit"],["type","text","placeholder","Search...","trans-placeholder","",1,"search-input","nav-searchbar-input",3,"matAutocomplete","formControl"],["input",""],["type","submit","mat-icon-button","",1,"search-button"],["svgIcon","search"],["customScrollbar","",1,"agent-mailbox-autocomplete"],["auto","matAutocomplete"],["class","results-container",4,"ngIf"],["class","no-results","trans","",4,"ngIf"],[1,"results-container"],[1,"header"],["class","header-item tickets-item","trans","",3,"active","click",4,"ngIf"],["class","header-item users-item","trans","",3,"active","click",4,"ngIf"],["class","results-panel tickets-panel",4,"ngIf"],["class","results-panel users-panel",4,"ngIf"],["class","footer",3,"click",4,"ngIf"],["trans","",1,"header-item","tickets-item",3,"click"],["trans","",1,"header-item","users-item",3,"click"],[1,"results-panel","tickets-panel"],["class","result",3,"click",4,"ngFor","ngForOf"],[1,"result",3,"click"],[1,"title"],[1,"body"],["class","user",3,"click",4,"ngIf"],[1,"user",3,"click"],[1,"results-panel","users-panel"],["class","result media",3,"click",4,"ngFor","ngForOf"],[1,"result","media",3,"click"],["alt","customer avatar",1,"avatar",3,"src"],[1,"text"],[1,"footer",3,"click"],["trans",""],["trans","",1,"no-results"]],template:function(t,e){if(1&t&&(l.TgZ(0,"form",0),l.NdJ("ngSubmit",function(){return e.openSearchModal()}),l._UZ(1,"input",1,2),l.TgZ(3,"button",3),l._UZ(4,"mat-icon",4),l.qZA(),l.qZA(),l.TgZ(5,"mat-autocomplete",5,6),l.YNc(7,kt,7,5,"div",7),l.YNc(8,wt,2,0,"div",8),l.qZA()),2&t){const t=l.MAs(6);l.xp6(1),l.Q6J("matAutocomplete",t)("formControl",e.searchQuery),l.xp6(6),l.Q6J("ngIf",e.results),l.xp6(1),l.Q6J("ngIf",e.searchQuery.value&&!e.isLoading&&!e.hasResults&&e.loadedResultsAtLeastOnce)}},directives:[n._Y,n.JL,n.F,dt.ZL,n.Fj,C.P,n.JJ,n.oH,ut.lW,q.Hw,dt.XC,pt.j,i.O5,i.sg,gt.ey],styles:["ticket-search-dropdown{display:block;position:relative;max-width:700px;width:100%}ticket-search-dropdown .input-container{position:relative;height:100%}ticket-search-dropdown .input-container .search-button{position:absolute;top:2px;left:0;z-index:1}ticket-search-dropdown .input-container input{padding-left:36px}.agent-mailbox-autocomplete.mat-autocomplete-panel{max-height:750px;background-color:var(--be-background)}.agent-mailbox-autocomplete.mat-autocomplete-panel .header{display:flex;background-color:var(--be-background-alternative)}.agent-mailbox-autocomplete.mat-autocomplete-panel .header .header-item{width:50%;flex:0 0 50%;padding:12px;border-bottom:2px solid var(--be-divider-default);cursor:pointer}.agent-mailbox-autocomplete.mat-autocomplete-panel .header .header-item.active{border-color:var(--be-accent-default)}.agent-mailbox-autocomplete.mat-autocomplete-panel .no-results{font-size:1.5rem;text-align:center;width:100%;padding:10px}.agent-mailbox-autocomplete.mat-autocomplete-panel .footer{background-color:var(--be-background-alternative);text-align:center;padding:10px;cursor:pointer}.agent-mailbox-autocomplete.mat-autocomplete-panel .result{border-bottom:1px solid var(--be-divider-default);padding:10px 15px;height:auto;line-height:normal;line-height:initial;font-size:1.4rem}.agent-mailbox-autocomplete.mat-autocomplete-panel .result:hover{background-color:var(--be-background-alternative)}.agent-mailbox-autocomplete.mat-autocomplete-panel .title{font-weight:500;color:var(--be-text);overflow:hidden}.agent-mailbox-autocomplete.mat-autocomplete-panel .body{color:var(--be-secondary-text);font-size:1.3rem;word-wrap:break-word;white-space:-webkit-pre-wrap;word-break:break-all;white-space:normal}.agent-mailbox-autocomplete.mat-autocomplete-panel .user{margin-top:5px;font-size:1.25rem;font-weight:500;color:var(--be-secondary-text)}.agent-mailbox-autocomplete.mat-autocomplete-panel .media .mat-option-text{display:flex;align-items:center}.agent-mailbox-autocomplete.mat-autocomplete-panel .media .mat-option-text img{margin-right:10px;width:50px;height:50px;-o-object-fit:cover;object-fit:cover}\n"],encapsulation:2}),t})();var At=a(80521),Ct=a(13416),qt=a(39490),Ot=a(36461),It=a(79765),Mt=a(22759),Ut=a(66682),Ft=a(45435),St=a(77393);function Qt(t){return e=>e.lift(new Jt(t))}class Jt{constructor(t){this.value=t}call(t,e){return e.subscribe(new Pt(t,this.value))}}class Pt extends St.L{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}var Yt=a(46782),Nt=a(15257),Bt=a(39761),Dt=a(17238),Et=a(46237),$t=a(19238),Rt=a(70946);const Lt=["*"];function jt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",2),l.NdJ("click",function(){return l.CHM(t),l.oxw()._onBackdropClicked()}),l.qZA()}if(2&t){const t=l.oxw();l.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Ht(t,e){1&t&&(l.TgZ(0,"mat-drawer-content"),l.Hsn(1,2),l.qZA())}const zt=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],Vt=["mat-drawer","mat-drawer-content","*"];function Gt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",2),l.NdJ("click",function(){return l.CHM(t),l.oxw()._onBackdropClicked()}),l.qZA()}if(2&t){const t=l.oxw();l.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Xt(t,e){1&t&&(l.TgZ(0,"mat-sidenav-content",3),l.Hsn(1,2),l.qZA())}const Wt=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],Kt=["mat-sidenav","mat-sidenav-content","*"],te=".mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n",ee={transformDrawer:(0,Dt.X$)("transform",[(0,Dt.SB)("open, open-instant",(0,Dt.oB)({transform:"none",visibility:"visible"})),(0,Dt.SB)("void",(0,Dt.oB)({"box-shadow":"none",visibility:"hidden"})),(0,Dt.eR)("void => open-instant",(0,Dt.jt)("0ms")),(0,Dt.eR)("void <=> open, open-instant => void",(0,Dt.jt)("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},ae=new l.OlP("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function(){return!1}}),ie=new l.OlP("MAT_DRAWER_CONTAINER");let ne=(()=>{class t extends Ct.PQ{constructor(t,e,a,i,n){super(a,i,n),this._changeDetectorRef=t,this._container=e}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(l.sBO),l.Y36((0,l.Gpc)(()=>re)),l.Y36(l.SBq),l.Y36(Ct.mF),l.Y36(l.R0b))},t.\u0275cmp=l.Xpm({type:t,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(t,e){2&t&&l.Udp("margin-left",e._container._contentMargins.left,"px")("margin-right",e._container._contentMargins.right,"px")},features:[l.qOj],ngContentSelectors:Lt,decls:1,vars:0,template:function(t,e){1&t&&(l.F$t(),l.Hsn(0))},encapsulation:2,changeDetection:0}),t})(),se=(()=>{class t{constructor(t,e,a,i,n,s,r){this._elementRef=t,this._focusTrapFactory=e,this._focusMonitor=a,this._platform=i,this._ngZone=n,this._doc=s,this._container=r,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new It.xQ,this._animationEnd=new It.xQ,this._animationState="void",this.openedChange=new l.vpe(!0),this._openedStream=this.openedChange.pipe((0,Ft.h)(t=>t),(0,o.U)(()=>{})),this.openedStart=this._animationStarted.pipe((0,Ft.h)(t=>t.fromState!==t.toState&&0===t.toState.indexOf("open")),Qt(void 0)),this._closedStream=this.openedChange.pipe((0,Ft.h)(t=>!t),(0,o.U)(()=>{})),this.closedStart=this._animationStarted.pipe((0,Ft.h)(t=>t.fromState!==t.toState&&"void"===t.toState),Qt(void 0)),this._destroyed=new It.xQ,this.onPositionChanged=new l.vpe,this._modeChanged=new It.xQ,this.openedChange.subscribe(t=>{t?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus()}),this._ngZone.runOutsideAngular(()=>{(0,Mt.R)(this._elementRef.nativeElement,"keydown").pipe((0,Ft.h)(t=>t.keyCode===Ot.hY&&!this.disableClose&&!(0,Ot.Vb)(t)),(0,Yt.R)(this._destroyed)).subscribe(t=>this._ngZone.run(()=>{this.close(),t.stopPropagation(),t.preventDefault()}))}),this._animationEnd.pipe((0,c.x)((t,e)=>t.fromState===e.fromState&&t.toState===e.toState)).subscribe(t=>{const{fromState:e,toState:a}=t;(0===a.indexOf("open")&&"void"===e||"void"===a&&0===e.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t="end"===t?"end":"start")!=this._position&&(this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=(0,qt.Ig)(t)}get autoFocus(){const t=this._autoFocus;return null==t?"side"!==this.mode:t}set autoFocus(t){this._autoFocus=(0,qt.Ig)(t)}get opened(){return this._opened}set opened(t){this.toggle((0,qt.Ig)(t))}_takeFocus(){!this.autoFocus||!this._focusTrap||this._focusTrap.focusInitialElementWhenReady().then(t=>{!t&&"function"==typeof this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()})}_restoreFocus(){!this.autoFocus||(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,this._openedVia):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null,this._openedVia=null)}_isFocusWithinDrawer(){var t;const e=null===(t=this._doc)||void 0===t?void 0:t.activeElement;return!!e&&this._elementRef.nativeElement.contains(e)}ngAfterContentInit(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState()}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){this._focusTrap&&this._focusTrap.destroy(),this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0)}toggle(t=!this.opened,e){return this._setOpen(t,!t&&this._isFocusWithinDrawer(),e)}_setOpen(t,e,a="program"){return this._opened=t,t?(this._animationState=this._enableAnimations?"open":"open-instant",this._openedVia=a):(this._animationState="void",e&&this._restoreFocus()),this._updateFocusTrapState(),new Promise(t=>{this.openedChange.pipe((0,Nt.q)(1)).subscribe(e=>t(e?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_animationStartListener(t){this._animationStarted.next(t)}_animationDoneListener(t){this._animationEnd.next(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(l.SBq),l.Y36($t.qV),l.Y36($t.tE),l.Y36(At.t4),l.Y36(l.R0b),l.Y36(i.K0,8),l.Y36(ie,8))},t.\u0275cmp=l.Xpm({type:t,selectors:[["mat-drawer"]],hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(t,e){1&t&&l.WFA("@transform.start",function(t){return e._animationStartListener(t)})("@transform.done",function(t){return e._animationDoneListener(t)}),2&t&&(l.uIk("align",null),l.d8E("@transform",e._animationState),l.ekj("mat-drawer-end","end"===e.position)("mat-drawer-over","over"===e.mode)("mat-drawer-push","push"===e.mode)("mat-drawer-side","side"===e.mode)("mat-drawer-opened",e.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:Lt,decls:2,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"]],template:function(t,e){1&t&&(l.F$t(),l.TgZ(0,"div",0),l.Hsn(1),l.qZA())},directives:[Ct.PQ],encapsulation:2,data:{animation:[ee.transformDrawer]},changeDetection:0}),t})(),re=(()=>{class t{constructor(t,e,a,i,n,s=!1,r){this._dir=t,this._element=e,this._ngZone=a,this._changeDetectorRef=i,this._animationMode=r,this._drawers=new l.n_E,this.backdropClick=new l.vpe,this._destroyed=new It.xQ,this._doCheckSubject=new It.xQ,this._contentMargins={left:null,right:null},this._contentMarginChanges=new It.xQ,t&&t.change.pipe((0,Yt.R)(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),n.change().pipe((0,Yt.R)(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=s}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=(0,qt.Ig)(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:(0,qt.Ig)(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe((0,Bt.O)(this._allDrawers),(0,Yt.R)(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(t=>!t._container||t._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe((0,Bt.O)(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe((0,m.b)(10),(0,Yt.R)(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,e=0;if(this._left&&this._left.opened)if("side"==this._left.mode)t+=this._left._getWidth();else if("push"==this._left.mode){const a=this._left._getWidth();t+=a,e-=a}if(this._right&&this._right.opened)if("side"==this._right.mode)e+=this._right._getWidth();else if("push"==this._right.mode){const a=this._right._getWidth();e+=a,t-=a}t=t||null,e=e||null,(t!==this._contentMargins.left||e!==this._contentMargins.right)&&(this._contentMargins={left:t,right:e},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe((0,Ft.h)(t=>t.fromState!==t.toState),(0,Yt.R)(this._drawers.changes)).subscribe(t=>{"open-instant"!==t.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==t.mode&&t.openedChange.pipe((0,Yt.R)(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe((0,Yt.R)(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe((0,Nt.q)(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe((0,Yt.R)((0,Ut.T)(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const e=this._element.nativeElement.classList,a="mat-drawer-container-has-open";t?e.add(a):e.remove(a)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{"end"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return"side"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Rt.Is,8),l.Y36(l.SBq),l.Y36(l.R0b),l.Y36(l.sBO),l.Y36(Ct.rL),l.Y36(ae),l.Y36(Et.Qb,8))},t.\u0275cmp=l.Xpm({type:t,selectors:[["mat-drawer-container"]],contentQueries:function(t,e,a){if(1&t&&(l.Suo(a,ne,5),l.Suo(a,se,5)),2&t){let t;l.iGM(t=l.CRH())&&(e._content=t.first),l.iGM(t=l.CRH())&&(e._allDrawers=t)}},viewQuery:function(t,e){if(1&t&&l.Gf(ne,5),2&t){let t;l.iGM(t=l.CRH())&&(e._userContent=t.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(t,e){2&t&&l.ekj("mat-drawer-container-explicit-backdrop",e._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[l._Bn([{provide:ie,useExisting:t}])],ngContentSelectors:Vt,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,e){1&t&&(l.F$t(zt),l.YNc(0,jt,1,2,"div",0),l.Hsn(1),l.Hsn(2,1),l.YNc(3,Ht,2,0,"mat-drawer-content",1)),2&t&&(l.Q6J("ngIf",e.hasBackdrop),l.xp6(3),l.Q6J("ngIf",!e._content))},directives:[i.O5,ne],styles:[te],encapsulation:2,changeDetection:0}),t})(),oe=(()=>{class t extends ne{constructor(t,e,a,i,n){super(t,e,a,i,n)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(l.sBO),l.Y36((0,l.Gpc)(()=>le)),l.Y36(l.SBq),l.Y36(Ct.mF),l.Y36(l.R0b))},t.\u0275cmp=l.Xpm({type:t,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(t,e){2&t&&l.Udp("margin-left",e._container._contentMargins.left,"px")("margin-right",e._container._contentMargins.right,"px")},features:[l.qOj],ngContentSelectors:Lt,decls:1,vars:0,template:function(t,e){1&t&&(l.F$t(),l.Hsn(0))},encapsulation:2,changeDetection:0}),t})(),ce=(()=>{class t extends se{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(t){this._fixedInViewport=(0,qt.Ig)(t)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(t){this._fixedTopGap=(0,qt.su)(t)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(t){this._fixedBottomGap=(0,qt.su)(t)}}return t.\u0275fac=function(){let e;return function(a){return(e||(e=l.n5z(t)))(a||t)}}(),t.\u0275cmp=l.Xpm({type:t,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(t,e){2&t&&(l.uIk("align",null),l.Udp("top",e.fixedInViewport?e.fixedTopGap:null,"px")("bottom",e.fixedInViewport?e.fixedBottomGap:null,"px"),l.ekj("mat-drawer-end","end"===e.position)("mat-drawer-over","over"===e.mode)("mat-drawer-push","push"===e.mode)("mat-drawer-side","side"===e.mode)("mat-drawer-opened",e.opened)("mat-sidenav-fixed",e.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[l.qOj],ngContentSelectors:Lt,decls:2,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"]],template:function(t,e){1&t&&(l.F$t(),l.TgZ(0,"div",0),l.Hsn(1),l.qZA())},directives:[Ct.PQ],encapsulation:2,data:{animation:[ee.transformDrawer]},changeDetection:0}),t})(),le=(()=>{class t extends re{}return t.\u0275fac=function(){let e;return function(a){return(e||(e=l.n5z(t)))(a||t)}}(),t.\u0275cmp=l.Xpm({type:t,selectors:[["mat-sidenav-container"]],contentQueries:function(t,e,a){if(1&t&&(l.Suo(a,oe,5),l.Suo(a,ce,5)),2&t){let t;l.iGM(t=l.CRH())&&(e._content=t.first),l.iGM(t=l.CRH())&&(e._allDrawers=t)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(t,e){2&t&&l.ekj("mat-drawer-container-explicit-backdrop",e._backdropOverride)},exportAs:["matSidenavContainer"],features:[l._Bn([{provide:ie,useExisting:t}]),l.qOj],ngContentSelectors:Kt,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],["cdkScrollable","",4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"],["cdkScrollable",""]],template:function(t,e){1&t&&(l.F$t(Wt),l.YNc(0,Gt,1,2,"div",0),l.Hsn(1),l.Hsn(2,1),l.YNc(3,Xt,2,0,"mat-sidenav-content",1)),2&t&&(l.Q6J("ngIf",e.hasBackdrop),l.xp6(3),l.Q6J("ngIf",!e._content))},directives:[i.O5,oe,Ct.PQ],styles:[te],encapsulation:2,changeDetection:0}),t})(),de=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[i.ez,gt.BQ,At.ud,Ct.ZD],Ct.ZD,gt.BQ]}),t})();var ue=a(64833);const pe=function(){return["/mailbox/tickets"]},ge=function(t){return{tagId:t}};function he(t,e){if(1&t&&(l.TgZ(0,"div",18),l.TgZ(1,"a",19),l.ALo(2,"async"),l.TgZ(3,"span",20),l._uU(4),l.ALo(5,"trans"),l.qZA(),l.TgZ(6,"span",21),l._uU(7),l.qZA(),l.qZA(),l.qZA()),2&t){const t=e.$implicit,a=l.oxw();l.Q6J("@fadeIn",void 0),l.xp6(1),l.ekj("router-link-active",l.lcZ(2,10,a.mailboxTags.activeTagId$)==t.id),l.Q6J("routerLink",l.DdM(14,pe))("queryParams",l.VKq(15,ge,t.id))("ngClass",t.name),l.xp6(3),l.Oqu(l.lcZ(5,12,t.display_name)),l.xp6(2),l.ekj("hidden",!t.tickets_count),l.xp6(1),l.Oqu(t.tickets_count)}}function me(t,e){1&t&&(l.TgZ(0,"div",24),l._UZ(1,"skeleton"),l.qZA())}const be=function(){return[1,2,3,4]};function fe(t,e){1&t&&(l.TgZ(0,"div",22),l.YNc(1,me,2,0,"div",23),l.qZA()),2&t&&(l.Q6J("@fadeOut",void 0),l.xp6(1),l.Q6J("ngForOf",l.DdM(2,be)))}function ve(t,e){if(1&t&&(l.TgZ(0,"div",25),l.TgZ(1,"a",26),l.ALo(2,"async"),l.TgZ(3,"span",20),l._uU(4),l.qZA(),l.TgZ(5,"span",21),l._uU(6),l.qZA(),l.qZA(),l.qZA()),2&t){const t=e.$implicit,a=l.oxw();l.Q6J("@fadeIn",void 0),l.xp6(1),l.ekj("router-link-active",l.lcZ(2,9,a.mailboxTags.activeTagId$)==t.id),l.Q6J("routerLink",l.DdM(11,pe))("queryParams",l.VKq(12,ge,t.id)),l.xp6(3),l.Oqu(t.display_name),l.xp6(1),l.ekj("hidden",!t.tickets_count),l.xp6(1),l.Oqu(t.tickets_count)}}function xe(t,e){1&t&&(l.TgZ(0,"div",24),l._UZ(1,"skeleton"),l.qZA())}function _e(t,e){1&t&&(l.TgZ(0,"div",22),l.YNc(1,xe,2,0,"div",23),l.qZA()),2&t&&(l.Q6J("@fadeOut",void 0),l.xp6(1),l.Q6J("ngForOf",l.DdM(2,be)))}let Ze=(()=>{class t{constructor(t,e,a,i){this.mailboxTags=t,this.route=e,this.i18n=a,this.breakpoints=i,this.leftColumnIsHidden=!1,this.trackByFn=(t,e)=>e.id}ngOnInit(){this.leftColumnIsHidden=this.breakpoints.isMobile$.value,this.route.queryParams.pipe((0,o.U)(t=>t.tagId),(0,c.x)()).subscribe(t=>{this.mailboxTags.setActiveTag(t)})}toggleLeftSidebar(){this.leftColumnIsHidden=!this.leftColumnIsHidden}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(d.N),l.Y36(s.gz),l.Y36(u.Z),l.Y36(p.S))},t.\u0275cmp=l.Xpm({type:t,selectors:[["mailbox"]],decls:31,vars:25,consts:[["menuPosition","agent-mailbox","color","accent",1,"box-shadow",3,"showToggleButton","hideToggleBtnOnDesktop","toggleButtonClick"],[1,"nav-searchbar"],[1,"mailbox-container"],[1,"left-column",3,"opened","mode","fixedInViewport","fixedTopGap"],[1,"aside-container","status-tags"],[1,"aside-container-title"],["svgIcon","inbox-custom",1,"title-icon"],["trans","",1,"aside-container-name"],[1,"aside-container-body"],["class","status-tag",4,"ngFor","ngForOf","ngForTrackBy"],["class","skeletons-container",4,"ngIf"],[1,"aside-container","category-tags"],["svgIcon","box-filled-custom",1,"title-icon"],["class","category-tag",4,"ngFor","ngForOf","ngForTrackBy"],[1,"bottom-action-container"],["mat-icon-button","","routerLink","/mailbox/tickets/new",3,"matTooltip"],["svgIcon","new-ticket-custom"],[1,"right-column"],[1,"status-tag"],[1,"aside-nav-item",3,"routerLink","queryParams","ngClass"],[1,"tag-name"],[1,"label","tickets-count"],[1,"skeletons-container"],["class","aside-nav-item",4,"ngFor","ngForOf"],[1,"aside-nav-item"],[1,"category-tag"],[1,"aside-nav-item",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(l.TgZ(0,"material-navbar",0),l.NdJ("toggleButtonClick",function(){return e.toggleLeftSidebar()}),l._UZ(1,"ticket-search-dropdown",1),l.qZA(),l.TgZ(2,"mat-sidenav-container",2),l.TgZ(3,"mat-sidenav",3),l.ALo(4,"async"),l.TgZ(5,"section",4),l.TgZ(6,"div",5),l._UZ(7,"mat-icon",6),l.TgZ(8,"span",7),l._uU(9,"Inbox"),l.qZA(),l.qZA(),l.TgZ(10,"div",8),l.YNc(11,he,8,17,"div",9),l.YNc(12,fe,2,3,"div",10),l.ALo(13,"async"),l.ALo(14,"async"),l.qZA(),l.qZA(),l.TgZ(15,"section",11),l.TgZ(16,"div",5),l._UZ(17,"mat-icon",12),l.TgZ(18,"span",7),l._uU(19,"Folders"),l.qZA(),l.qZA(),l.TgZ(20,"div",8),l.YNc(21,ve,7,14,"div",13),l.YNc(22,_e,2,3,"div",10),l.ALo(23,"async"),l.ALo(24,"async"),l.qZA(),l.qZA(),l.TgZ(25,"div",14),l.TgZ(26,"a",15),l.ALo(27,"trans"),l._UZ(28,"mat-icon",16),l.qZA(),l.qZA(),l.qZA(),l.TgZ(29,"mat-sidenav-content",17),l._UZ(30,"router-outlet"),l.qZA(),l.qZA()),2&t&&(l.Q6J("showToggleButton",!0)("hideToggleBtnOnDesktop",!0),l.xp6(3),l.Q6J("opened",!e.leftColumnIsHidden)("mode",l.lcZ(4,13,e.breakpoints.isMobile$)?"over":"side")("fixedInViewport",!0)("fixedTopGap",70),l.xp6(8),l.Q6J("ngForOf",e.mailboxTags.viewTags)("ngForTrackBy",e.trackByFn),l.xp6(1),l.Q6J("ngIf",!l.lcZ(13,15,e.mailboxTags.allTags$).length&&l.lcZ(14,17,e.mailboxTags.loading$)),l.xp6(9),l.Q6J("ngForOf",e.mailboxTags.categoryTags)("ngForTrackBy",e.trackByFn),l.xp6(1),l.Q6J("ngIf",!l.lcZ(23,19,e.mailboxTags.allTags$).length&&l.lcZ(24,21,e.mailboxTags.loading$)),l.xp6(4),l.Q6J("matTooltip",l.lcZ(27,23,"Create new ticket")))},directives:[g.e,yt,le,ce,q.Hw,C.P,i.sg,i.O5,ut.zs,s.yS,H.gM,oe,s.lC,i.mk,ue._],pipes:[i.Ov,G.R],styles:["[_nghost-%COMP%]{display:block;position:relative;max-height:100vh;overflow:hidden}material-navbar[_ngcontent-%COMP%]{height:70px}.left-column[_ngcontent-%COMP%]{width:225px;background-color:var(--be-background-alternative);border-right:1px solid var(--be-divider-default)}.aside-container[_ngcontent-%COMP%]{list-style:none;padding-left:0}skeleton[_ngcontent-%COMP%]{max-width:77%}.aside-container-body[_ngcontent-%COMP%]{position:relative;min-height:160px}.skeletons-container[_ngcontent-%COMP%]{position:absolute;top:0;width:100%}.aside-container-title[_ngcontent-%COMP%]{position:relative;padding:20px 15px 15px;text-transform:uppercase;letter-spacing:.03em;color:var(--be-secondary-text);font-weight:500;white-space:nowrap;overflow:hidden}.aside-container-title[_ngcontent-%COMP%]   .title-icon[_ngcontent-%COMP%]{position:absolute;top:17px}.aside-container-title[_ngcontent-%COMP%]   .aside-container-name[_ngcontent-%COMP%]{padding-left:30px}.aside-nav-item[_ngcontent-%COMP%]{display:block;position:relative;padding:10px 0 10px 41px;cursor:pointer;clear:both;text-transform:capitalize;color:#858b94;text-decoration:none;width:100%;border-left:3px solid transparent}.aside-nav-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:1.1rem;text-transform:none;position:absolute;top:12px;right:5px;border-radius:20px;padding:1px 10px;line-height:15px}.aside-nav-item[_ngcontent-%COMP%]   .tag-name[_ngcontent-%COMP%]{display:block;max-width:80%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.aside-nav-item.router-link-active[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis);border-left-color:var(--be-accent-default)}.aside-nav-item.router-link-active[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.aside-nav-item[_ngcontent-%COMP%]:hover{background-color:var(--be-hover)}.be-dark-mode[_nghost-%COMP%]   .aside-nav-item[_ngcontent-%COMP%], .be-dark-mode   [_nghost-%COMP%]   .aside-nav-item[_ngcontent-%COMP%]{color:var(--be-secondary-text)}.right-column[_ngcontent-%COMP%]{background-color:var(--be-background)}conversation[_ngcontent-%COMP%]{margin-bottom:15px}.bottom-action-container[_ngcontent-%COMP%]{position:absolute;bottom:5px;left:5px;color:var(--be-secondary-text)}"],data:{animation:r.B}}),t})();var ke=a(3093);function we(t,e){1&t&&(l.TgZ(0,"no-results-message",1),l.TgZ(1,"span",2),l._uU(2,"There are no tickets in this category yet."),l.qZA(),l.qZA())}let Te=(()=>{class t{constructor(t,e,a,i,n,s){this.mailboxTags=t,this.router=e,this.modal=a,this.route=i,this.backendEvents=n,this.datatable=s,this.datatable.paginator.perPageCacheKey="agent-ticket-list-per-page"}ngOnInit(){this.datatable.init({uri:"tickets",staticParams:{tagId:this.mailboxTags.activeTagId$.value}}),this.mailboxSub=this.mailboxTags.activeTagId$.pipe((0,c.x)()).subscribe(t=>{this.datatable.reset({tagId:t})}),this.bindToBackendEvents()}ngOnDestroy(){this.datatable.destroy(),this.mailboxSub.unsubscribe()}bindToBackendEvents(){this.backendEvents.ticketCreated.subscribe(t=>{!t.tags||!t.tags.find(t=>t.id===this.mailboxTags.activeTagId$.value)||this.datatable.data.find(e=>e.id===t.id)||(t.animated=!0,this.datatable.data=[t,...this.datatable.data],this.mailboxTags.refresh())})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(d.N),l.Y36(s.F0),l.Y36(M.u),l.Y36(s.gz),l.Y36(ke.O),l.Y36(Z.x))},t.\u0275cmp=l.Xpm({type:t,selectors:[["agent-mailbox-ticket-list"]],features:[l._Bn([Z.x])],decls:4,vars:3,consts:[["svgImage","opened.svg",4,"ngIf"],["svgImage","opened.svg"],["primary-text","","trans",""]],template:function(t,e){1&t&&(l.TgZ(0,"tickets-list"),l.YNc(1,we,3,0,"no-results-message",0),l.ALo(2,"async"),l.qZA(),l._UZ(3,"ticket-floating-toolbar")),2&t&&(l.xp6(1),l.Q6J("ngIf",l.lcZ(2,1,e.datatable.paginator.noResults$)))},directives:[$,i.O5,tt,et.U,C.P],pipes:[i.Ov],styles:["agent-mailbox-ticket-list{display:block;height:calc(100vh - 70px)}\n"],encapsulation:2}),t})();var ye=a(61),Ae=a(20964),Ce=a(34060);class qe{constructor(t={}){for(let e in t)this[e]=t[e]}}var Oe=a(73429);function Ie(t,e){if(1&t&&(l.TgZ(0,"div",11),l._uU(1),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.Oqu(t.errors["emails.0"])}}let Me=(()=>{class t{constructor(t,e,a){this.dialogRef=t,this.data=e,this.users=a,this.errors={}}close(t){this.dialogRef.close(t)}confirm(){this.users.addEmail(this.data.userId,{emails:[this.emailAddress]}).subscribe(()=>{this.close(this.emailAddress)},t=>this.errors=t.errors)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(_.so),l.Y36(_.WI),l.Y36(Oe.Q))},t.\u0275cmp=l.Xpm({type:t,selectors:[["email-address-modal"]],decls:15,vars:2,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["ngNativeValidate","","mat-dialog-content","",3,"ngSubmit"],[1,"input-container"],["for","email"],["type","email","name","email","id","email","required","",3,"ngModel","ngModelChange"],["class","error",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"error"]],template:function(t,e){1&t&&(l.TgZ(0,"div",0),l.TgZ(1,"h2",1),l._uU(2,"Enter Email Address"),l.qZA(),l.TgZ(3,"button",2),l.NdJ("click",function(){return e.close()}),l._UZ(4,"mat-icon",3),l.qZA(),l.qZA(),l.TgZ(5,"form",4),l.NdJ("ngSubmit",function(){return e.confirm()}),l.TgZ(6,"div",5),l._UZ(7,"label",6),l.TgZ(8,"input",7),l.NdJ("ngModelChange",function(t){return e.emailAddress=t}),l.qZA(),l.YNc(9,Ie,2,1,"div",8),l.qZA(),l.TgZ(10,"mat-dialog-actions"),l.TgZ(11,"button",9),l.NdJ("click",function(){return e.close()}),l._uU(12,"Cancel"),l.qZA(),l.TgZ(13,"button",10),l._uU(14,"Confirm"),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(8),l.Q6J("ngModel",e.emailAddress),l.xp6(1),l.Q6J("ngIf",e.errors["emails.0"]))},directives:[_.uh,C.P,ut.lW,q.Hw,n.JL,n.F,_.xY,n.Fj,n.Q7,n.JJ,n.On,i.O5,_.H8],styles:["[_nghost-%COMP%]{display:block;width:400px;max-width:100%}"]}),t})();var Ue=a(56313),Fe=a(53534),Se=a(26215),Qe=a(13880),Je=a(81378),Pe=a(34673),Ye=a(42099),Ne=a(65939),Be=a(9489),De=a(36749);function Ee(t,e){if(1&t&&l._UZ(0,"mat-icon",36),2&t){l.oxw();const t=l.MAs(12);l.Q6J("matMenuTriggerFor",t)}}function $e(t,e){if(1&t&&(l.TgZ(0,"div",19),l.TgZ(1,"div",16),l._uU(2,"Envato"),l.qZA(),l.TgZ(3,"div",37),l._uU(4),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.xp6(4),l.Oqu(t.user.purchase_codes[0].envato_username)}}function Re(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",40),l.NdJ("click",function(){l.CHM(t);const e=l.oxw().$implicit;return l.oxw().removeEmail(e.address)}),l._UZ(1,"mat-icon",41),l.qZA()}}function Le(t,e){if(1&t&&(l.TgZ(0,"div",38),l.YNc(1,Re,2,0,"button",39),l.TgZ(2,"span"),l._uU(3),l.qZA(),l.qZA()),2&t){const t=e.$implicit,a=l.oxw();l.xp6(1),l.Q6J("ngIf",a.detailsEditable),l.xp6(2),l.Oqu(t.address)}}function je(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"button",42),l.NdJ("click",function(){return l.CHM(t),l.oxw().openAddEmailModal()}),l._uU(2,"Add Email"),l.qZA(),l.qZA()}}let He=(()=>{class t{constructor(t,e,a,i,s,r,o,c,l){this.users=t,this.route=e,this.toast=a,this.modal=i,this.avatarValidator=s,this.currentUser=r,this.settings=o,this.reports=c,this.datatable=l,this.user=new Ce.n({purchase_codes:[]}),this.detailsEditable=!1,this.userSearches$=new Se.X(null),this.profile=new n.cw({details:new n.NI,notes:new n.NI}),this.tagsControl=new n.NI([])}ngOnInit(){this.route.data.subscribe(t=>{this.hydrateProfile(t.user),this.bindFormControls(),this.createDataSource()}),this.detailsEditable=this.currentUser.hasPermission("users.update")}openAddEmailModal(){this.modal.show(Me,{userId:this.user.id}).afterClosed().subscribe(t=>{this.user.secondary_emails.push(new qe({address:t}))})}removeEmail(t){this.users.removeEmail(this.user.id,{emails:[t]}).subscribe(()=>{const e=this.user.secondary_emails.findIndex(e=>e.address===t);this.user.secondary_emails.splice(e,1)})}openAvatarUploadDialog(){(0,Ue.r)({types:[Fe.j.image]}).then(t=>{this.avatarValidator.validateWithToast(t[0]).failed||this.users.uploadAvatar(this.user.id,t).subscribe(t=>{this.user.avatar=t.user.avatar,this.currentUser.set("avatar",t.user.avatar),this.toast.open("Avatar updated")},t=>{const e=Object.keys(t.errors)[0];this.toast.open(t.errors[e])})})}deleteAvatar(){this.users.deleteAvatar(this.user.id).subscribe(t=>{this.user.avatar=t.avatar,this.toast.open("Avatar removed.")})}hydrateProfile(t){this.user=t,t.details&&this.profile.setValue({details:t.details.details,notes:t.details.notes}),this.tagsControl.setValue(t.tags.map(t=>t.name))}createDataSource(){this.datatable.paginator.dontUpdateQueryParams=!0,this.datatable.init({uri:"tickets",staticParams:{userId:this.user.id}})}bindFormControls(){this.profile.valueChanges.pipe((0,m.b)(600),(0,c.x)()).subscribe(t=>{this.users.updateDetails(this.user.id,t).subscribe(()=>{this.toast.open("Updated user details.")})}),this.tagsControl.valueChanges.subscribe(t=>{this.users.syncTags(this.user.id,{tags:t}).subscribe()})}tabChanged(t){1===t.index&&!this.userSearches$.value&&this.reports.getUserSearchesReport(this.user.id).subscribe(t=>{this.userSearches$.next(t.report)})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Oe.Q),l.Y36(s.gz),l.Y36(R.F),l.Y36(M.u),l.Y36(Je.m),l.Y36(L.I),l.Y36(Pe.Z),l.Y36(Ye.F),l.Y36(Z.x))},t.\u0275cmp=l.Xpm({type:t,selectors:[["user-profile"]],viewQuery:function(t,e){if(1&t&&l.Gf(Qe.s,7),2&t){let t;l.iGM(t=l.CRH())&&(e.tagsManager=t.first)}},features:[l._Bn([Z.x])],decls:66,vars:28,consts:[["menuPosition","agent-mailbox"],[1,"nav-searchbar"],[1,"content"],["customScrollbar","lite",1,"sidebar"],[1,"panel"],[1,"panel-body"],[1,"user-info"],[1,"avatar-container"],["alt","user avatar",1,"user-avatar",3,"src"],[1,"hover-overlay"],["svgIcon","edit",3,"matMenuTriggerFor",4,"ngIf"],[1,"update-avatar-menu"],["updateAvatarMenu","matMenu"],["mat-menu-item","","trans","",1,"upload-avatar-item",3,"click"],["mat-menu-item","","trans","",1,"delete-avatar-item",3,"click"],[1,"names"],[1,"name"],[1,"email","primary-email"],[1,"user-details"],[1,"details-row"],["trans","",1,"name"],[1,"input-container","value"],["name","details","id","details",3,"formControl","readonly"],["name","notes","id","notes",3,"formControl","readonly"],["class","details-row",4,"ngIf"],[1,"emails","value"],["class","email secondary-email",4,"ngFor","ngForOf"],["trans","",1,"panel-header"],[3,"formControl","readonly"],["color","accent",3,"selectedTabChange"],[3,"label"],[1,"tickets"],[3,"openTicketInModal"],["primary-text","","trans",""],[3,"data"],["trans",""],["svgIcon","edit",3,"matMenuTriggerFor"],[1,"value"],[1,"email","secondary-email"],["class","remove-email-button","mat-icon-button","",3,"click",4,"ngIf"],["mat-icon-button","",1,"remove-email-button",3,"click"],["svgIcon","close"],["mat-flat-button","","color","accent","trans","",1,"add-email-button",3,"click"]],template:function(t,e){1&t&&(l.TgZ(0,"material-navbar",0),l._UZ(1,"ticket-search-dropdown",1),l.qZA(),l.TgZ(2,"div",2),l.TgZ(3,"aside",3),l.TgZ(4,"div",4),l.TgZ(5,"div",5),l.TgZ(6,"div",6),l.TgZ(7,"div",7),l._UZ(8,"img",8),l.TgZ(9,"div",9),l.YNc(10,Ee,1,1,"mat-icon",10),l.qZA(),l.qZA(),l.TgZ(11,"mat-menu",11,12),l.TgZ(13,"button",13),l.NdJ("click",function(){return e.openAvatarUploadDialog()}),l._uU(14,"Upload"),l.qZA(),l.TgZ(15,"button",14),l.NdJ("click",function(){return e.deleteAvatar()}),l._uU(16,"Remove"),l.qZA(),l.qZA(),l.TgZ(17,"div",15),l.TgZ(18,"div",16),l._uU(19),l.qZA(),l.TgZ(20,"div",17),l._uU(21),l.qZA(),l.qZA(),l.qZA(),l.TgZ(22,"div",18),l.TgZ(23,"div",19),l.TgZ(24,"div",20),l._uU(25,"Details"),l.qZA(),l.TgZ(26,"div",21),l._UZ(27,"textarea",22),l.qZA(),l.qZA(),l.TgZ(28,"div",19),l.TgZ(29,"div",20),l._uU(30,"Notes"),l.qZA(),l.TgZ(31,"div",21),l._UZ(32,"textarea",23),l.qZA(),l.qZA(),l.YNc(33,$e,5,1,"div",24),l.TgZ(34,"div",19),l.TgZ(35,"div",20),l._uU(36,"Emails"),l.qZA(),l.TgZ(37,"div",25),l.TgZ(38,"div",17),l._uU(39),l.qZA(),l.YNc(40,Le,4,2,"div",26),l.qZA(),l.qZA(),l.YNc(41,je,3,0,"div",24),l.qZA(),l.qZA(),l.qZA(),l.TgZ(42,"div",4),l.TgZ(43,"div",27),l._uU(44,"Tags"),l.qZA(),l.TgZ(45,"div",5),l._UZ(46,"tags-manager",28),l.qZA(),l.qZA(),l.qZA(),l.TgZ(47,"mat-tab-group",29),l.NdJ("selectedTabChange",function(t){return e.tabChanged(t)}),l.TgZ(48,"mat-tab",30),l.ALo(49,"trans"),l.TgZ(50,"div",31),l.TgZ(51,"tickets-list",32),l.TgZ(52,"no-results-message"),l.ALo(53,"async"),l.TgZ(54,"span",33),l._uU(55,"This user did not create any tickets yet."),l.qZA(),l.qZA(),l.qZA(),l._UZ(56,"ticket-floating-toolbar"),l.qZA(),l.qZA(),l.TgZ(57,"mat-tab",30),l.ALo(58,"trans"),l.TgZ(59,"search-report-table",34),l.ALo(60,"async"),l.TgZ(61,"span",35),l._uU(62,"Search Term"),l.qZA(),l.TgZ(63,"info-popover"),l.TgZ(64,"span",35),l._uU(65,"This report shows what this user searched for recently."),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(8),l.s9C("src",e.user.avatar,l.LSH),l.xp6(2),l.Q6J("ngIf",e.detailsEditable),l.xp6(9),l.Oqu(e.user.display_name),l.xp6(2),l.Oqu(e.user.email),l.xp6(6),l.Q6J("formControl",e.profile.controls.details)("readonly",!e.detailsEditable),l.xp6(5),l.Q6J("formControl",e.profile.controls.notes)("readonly",!e.detailsEditable),l.xp6(1),l.Q6J("ngIf",e.user.purchase_codes&&(null==e.user.purchase_codes[0]?null:e.user.purchase_codes[0].envato_username)),l.xp6(6),l.Oqu(e.user.email),l.xp6(1),l.Q6J("ngForOf",e.user.secondary_emails),l.xp6(1),l.Q6J("ngIf",e.detailsEditable),l.xp6(5),l.Q6J("formControl",e.tagsControl)("readonly",!e.detailsEditable),l.xp6(2),l.Q6J("label",l.lcZ(49,20,"Tickets")),l.xp6(3),l.Q6J("openTicketInModal",!0),l.xp6(1),l.ekj("hidden",!l.lcZ(53,22,e.datatable.paginator.noResults$)),l.xp6(5),l.Q6J("label",l.lcZ(58,24,"Searches")),l.xp6(2),l.Q6J("data",l.lcZ(60,26,e.userSearches$)))},directives:[g.e,yt,pt.j,i.O5,z.VK,z.OP,C.P,n.Fj,n.JJ,n.oH,i.sg,Qe.s,Ne.SP,Ne.uX,$,et.U,tt,Be.K,De.N,q.Hw,z.p6,ut.lW],pipes:[G.R,i.Ov],styles:["user-profile{display:block;width:100%;height:100%;background-color:var(--be-background-alternative)}user-profile .content{display:flex;padding:25px;width:100%;height:calc(100vh - 70px);overflow:hidden}user-profile .sidebar{flex:0 0 320px;width:320px;margin-right:15px;height:100%;overflow:auto}user-profile .sidebar .panel{margin-bottom:15px;background-color:var(--be-background);border:1px solid var(--be-divider-default);padding:10px}user-profile .sidebar .panel .panel-header{padding:5px}user-profile .sidebar .user-info{display:flex;align-items:center;border-bottom:1px solid var(--be-divider-default);margin-bottom:15px;padding-bottom:15px}user-profile .sidebar .user-info .avatar-container{width:65px;height:65px;position:relative}user-profile .sidebar .user-info .avatar-container:hover .hover-overlay{display:flex}user-profile .sidebar .user-info .avatar-container.disabled{cursor:default}user-profile .sidebar .user-info .avatar-container.disabled>.hover-overlay{display:none}user-profile .sidebar .user-info .avatar-container .hover-overlay{display:none;position:absolute;top:0;bottom:0;width:100%;height:100%;background-color:rgba(255,255,255,.502);justify-content:center;align-items:center;cursor:pointer}user-profile .sidebar .user-info .avatar-container .hover-overlay>mat-icon{width:34px;height:34px;color:var(--be-secondary-text)}user-profile .sidebar .user-info .avatar-container>img{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}user-profile .sidebar .user-info>.names{margin-left:10px}user-profile .sidebar .user-info>.names>.name{font-size:1.5rem}user-profile .sidebar .user-info>.names>.email{color:var(--be-secondary-text)}user-profile .sidebar .user-details{margin-top:15px}user-profile .sidebar .user-details .details-row{display:flex;align-items:center;margin-bottom:15px}user-profile .sidebar .user-details .details-row .name{flex:0 0 30%;max-width:40px;margin-right:20px}user-profile .sidebar .user-details .details-row .value{flex:1 1 auto}user-profile .sidebar .user-details .details-row .value.input-container{height:auto}user-profile .sidebar .user-details .details-row .value.input-container>textarea{height:auto;padding:5px;border-radius:3px}user-profile .sidebar .user-details .emails .primary-email{font-weight:500}user-profile .sidebar .user-details .emails .secondary-email{margin-top:8px}user-profile .mat-tab-group{flex:1 1 auto;height:100%;border:1px solid var(--be-divider-default);min-width:0}user-profile .mat-tab-body-wrapper,user-profile .tickets,user-profile search-report-table{height:100%}user-profile search-report-table .material-panel{border:none}\n"],encapsulation:2}),t})(),ze=(()=>{class t{constructor(t,e,a){this.tickets=t,this.users=e,this.router=a}resolve(t,e){return this.users.get(t.params.id,{with:["tags","purchase_codes","secondary_emails","details"]}).pipe((0,o.U)(t=>{if(t.user)return t.user;this.router.navigate(["/mailbox"])}))}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(v.g),l.LFG(Oe.Q),l.LFG(s.F0))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Ve=a(42690),Ge=a(9141),Xe=a(82192),We=a(48350),Ke=a(91241);function ta(t,e){if(1&t&&(l.TgZ(0,"div",26),l._uU(1),l.qZA()),2&t){const t=l.oxw().ngIf;l.xp6(1),l.Oqu(t.user_id)}}function ea(t,e){if(1&t&&(l.TgZ(0,"mat-option",27),l.TgZ(1,"div",28),l._UZ(2,"img",29),l.TgZ(3,"div",30),l.TgZ(4,"div",31),l._uU(5),l.qZA(),l.TgZ(6,"div",32),l._uU(7),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t),l.xp6(2),l.Q6J("src",t.avatar,l.LSH),l.xp6(3),l.Oqu(t.display_name),l.xp6(2),l.Oqu(t.email)}}function aa(t,e){if(1&t&&(l.TgZ(0,"div",33),l._uU(1),l.qZA()),2&t){const t=l.oxw().ngIf;l.xp6(1),l.Oqu(t.subject)}}function ia(t,e){if(1&t&&(l.TgZ(0,"option",34),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("ngValue",t.id),l.xp6(1),l.Oqu(t.display_name)}}function na(t,e){if(1&t&&(l.TgZ(0,"div",35),l._uU(1),l.qZA()),2&t){const t=l.oxw().ngIf;l.xp6(1),l.Oqu(t.category)}}function sa(t,e){if(1&t&&(l.TgZ(0,"option",36),l._uU(1),l.qZA()),2&t){const t=e.$implicit;l.Q6J("ngValue",t.name),l.xp6(1),l.Oqu(t.display_name)}}function ra(t,e){if(1&t&&(l.TgZ(0,"div",37),l._uU(1),l.qZA()),2&t){const t=l.oxw().ngIf;l.xp6(1),l.Oqu(t.status)}}function oa(t,e){if(1&t&&(l.TgZ(0,"div",38),l._uU(1),l.qZA()),2&t){const t=l.oxw().ngIf;l.xp6(1),l.Oqu(t.body)}}function ca(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"form",1),l.NdJ("ngSubmit",function(){return l.CHM(t),l.oxw().createTicket()}),l.TgZ(1,"div",2),l.TgZ(2,"label",3),l._uU(3,"Customer"),l.qZA(),l._UZ(4,"input",4),l.YNc(5,ta,2,1,"div",5),l.qZA(),l.TgZ(6,"mat-autocomplete",6,7),l.YNc(8,ea,8,4,"mat-option",8),l.ALo(9,"async"),l.qZA(),l.TgZ(10,"div",2),l.TgZ(11,"label",9),l._uU(12,"Subject"),l.qZA(),l._UZ(13,"input",10),l.YNc(14,aa,2,1,"div",11),l.qZA(),l.TgZ(15,"div",2),l.TgZ(16,"label",12),l._uU(17,"Category"),l.qZA(),l.TgZ(18,"select",13),l.YNc(19,ia,2,2,"option",14),l.qZA(),l.YNc(20,na,2,1,"div",15),l.qZA(),l.TgZ(21,"div",2),l.TgZ(22,"label",16),l._uU(23,"Status"),l.qZA(),l.TgZ(24,"select",17),l.YNc(25,sa,2,2,"option",18),l.qZA(),l.YNc(26,ra,2,1,"div",19),l.qZA(),l.TgZ(27,"div",20),l.TgZ(28,"label",21),l._uU(29,"Ticket Body"),l.qZA(),l.TgZ(30,"text-editor",22),l.NdJ("onFileUpload",function(e){return l.CHM(t),l.oxw().uploadFiles(e)})("onChange",function(e){return l.CHM(t),l.oxw().setBody(e)}),l.qZA(),l._UZ(31,"upload-progress-bar"),l.YNc(32,oa,2,1,"div",23),l.qZA(),l.TgZ(33,"reply-attachment-list",24),l.NdJ("detached",function(e){return l.CHM(t),l.oxw().removeAttachment(e)}),l.ALo(34,"async"),l.qZA(),l.TgZ(35,"button",25),l.ALo(36,"async"),l._uU(37,"Create"),l.qZA(),l.qZA()}if(2&t){const t=e.ngIf,a=l.MAs(7),i=l.oxw();l.Q6J("formGroup",i.ticketForm),l.xp6(4),l.Q6J("matAutocomplete",a),l.xp6(1),l.Q6J("ngIf",t.user_id),l.xp6(1),l.Q6J("displayWith",i.displayUserFn),l.xp6(2),l.Q6J("ngForOf",l.lcZ(9,14,i.users$)),l.xp6(6),l.Q6J("ngIf",t.subject),l.xp6(5),l.Q6J("ngForOf",i.ticketCategories),l.xp6(1),l.Q6J("ngIf",t.category),l.xp6(5),l.Q6J("ngForOf",i.mailboxTags.statusTags),l.xp6(1),l.Q6J("ngIf",t.status),l.xp6(4),l.Q6J("minHeight",230),l.xp6(2),l.Q6J("ngIf",t.body),l.xp6(1),l.Q6J("attachments",l.lcZ(34,16,i.attachments$)),l.xp6(2),l.Q6J("disabled",l.lcZ(36,18,i.loading$))}}let la=(()=>{class t{constructor(t,e,a,i,n,s,r,o,c,l){this.fb=t,this.settings=e,this.uploadQueue=a,this.users=i,this.tickets=n,this.toast=s,this.router=r,this.route=o,this.mailboxTags=c,this.cd=l,this.errors$=new Se.X({}),this.attachments$=new Se.X([]),this.users$=new Se.X([]),this.loading$=new Se.X(!1),this.ticketCategories=[],this.ticketForm=this.fb.group({customer:[""],subject:[""],category:[""],body:[""],status:[""]})}ngOnInit(){this.bindToCustomerControl(),this.mailboxTags.allTags$.pipe((0,Ft.h)(t=>!!t.length),(0,Nt.q)(1)).subscribe(()=>{this.ticketForm.patchValue({status:this.mailboxTags.statusTags[0].name}),this.cd.markForCheck()}),this.route.data.subscribe(t=>{this.ticketCategories=t.categories,t.categories.length&&this.ticketForm.patchValue({category:this.ticketCategories[0].id})})}createTicket(){this.loading$.next(!0),this.tickets.create(this.getPayload()).pipe((0,x.x)(()=>this.loading$.next(!1))).subscribe(()=>{this.toast.open("Ticket created"),this.mailboxTags.refresh(),this.router.navigateByUrl("/mailbox/tickets")},t=>this.errors$.next(t.errors))}getPayload(){const t=this.ticketForm.value;return t.user_id=t.customer.id,t.uploads=this.uploadQueue.getAllCompleted().map(t=>t.id),t.created_by_agent=!0,t}setBody(t){this.ticketForm.patchValue({body:t})}uploadFiles(t){this.uploadQueue.start(t).subscribe(t=>{this.attachments$.next([...this.attachments$.value,t.fileEntry])})}removeAttachment(t){const e=this.attachments$.value.slice();for(let a=0;a<e.length;a++)e[a].id===t.id&&e.splice(a,1);this.attachments$.next(e)}bindToCustomerControl(){this.ticketForm.get("customer").valueChanges.pipe((0,m.b)(250),(0,c.x)(),(0,b.w)(t=>this.searchUsers(t)),(0,f.K)(()=>(0,lt.of)([]))).subscribe(t=>{this.users$.next(t)})}searchUsers(t){return t&&"string"==typeof t?this.users.getAll({query:t}):(0,lt.of)([])}displayUserFn(t){return t?t.email:void 0}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(n.qu),l.Y36(Pe.Z),l.Y36(Ge.A),l.Y36(Oe.Q),l.Y36(v.g),l.Y36(R.F),l.Y36(s.F0),l.Y36(s.gz),l.Y36(d.N),l.Y36(l.sBO))},t.\u0275cmp=l.Xpm({type:t,selectors:[["create-ticket"]],features:[l._Bn([v.g,Ge.A])],decls:2,vars:3,consts:[["class","many-inputs","ngNativeValidate","",3,"formGroup","ngSubmit",4,"ngIf"],["ngNativeValidate","",1,"many-inputs",3,"formGroup","ngSubmit"],[1,"input-container"],["for","user","trans",""],["type","text","id","user","formControlName","customer","required","",3,"matAutocomplete"],["class","error user-error",4,"ngIf"],[1,"create-ticket-user-autocomplete",3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","subject","trans",""],["type","text","id","subject","formControlName","subject","required",""],["class","error subject-error",4,"ngIf"],["for","category-select","trans",""],["name","category","id","category-select","formControlName","category","required",""],[3,"ngValue",4,"ngFor","ngForOf"],["class","error category-error",4,"ngIf"],["for","status-select","trans",""],["name","status","id","status-select","formControlName","status","required",""],["class","status-tag-option",3,"ngValue",4,"ngFor","ngForOf"],["class","error status-error",4,"ngIf"],[1,"input-container","body-input-container"],["for","description","trans",""],["id","description","inlineUploadPrefix","ticket_images",3,"minHeight","onFileUpload","onChange"],["class","error body-error",4,"ngIf"],[3,"attachments","detached"],["mat-raised-button","","color","accent","type","submit","trans","",3,"disabled"],[1,"error","user-error"],[3,"value"],[1,"create-ticket-user-option"],[3,"src"],[1,"meta"],[1,"name"],[1,"email"],[1,"error","subject-error"],[3,"ngValue"],[1,"error","category-error"],[1,"status-tag-option",3,"ngValue"],[1,"error","status-error"],[1,"error","body-error"]],template:function(t,e){1&t&&(l.YNc(0,ca,38,20,"form",0),l.ALo(1,"async")),2&t&&l.Q6J("ngIf",l.lcZ(1,1,e.errors$))},directives:[i.O5,n.JL,n.sg,C.P,n.Fj,dt.ZL,n.JJ,n.u,n.Q7,dt.XC,i.sg,n.EJ,Xe.d,We.o,Ke.G,ut.lW,gt.ey,n.YN,n.Kr],pipes:[i.Ov],styles:["create-ticket{display:block;padding:25px;overflow:auto;height:calc(100vh - 70px)}create-ticket form{max-width:800px}create-ticket .error{margin-top:7px;color:#f44336}create-ticket select,create-ticket option{text-transform:capitalize}.create-ticket-user-autocomplete .mat-option{height:auto;line-height:normal;line-height:initial}.create-ticket-user-option{display:flex;padding:8px 0}.create-ticket-user-option img{width:40px;height:40px;flex-shrink:0;margin-right:10px;border-radius:4px;overflow:hidden}.create-ticket-user-option .name{color:var(--be-text);font-size:1.5rem}.create-ticket-user-option .email{color:var(--be-secondary-text);font-size:1.4rem}\n"],encapsulation:2,changeDetection:0}),t})();var da=a(19773),ua=a(59193),pa=a(99981);let ga=(()=>{class t{constructor(t,e){this.router=t,this.http=e}resolve(t){return this.http.get("new-ticket/categories").pipe((0,f.K)(()=>(this.router.navigateByUrl("/"),ua.E)),(0,da.zg)(t=>(0,lt.of)(t.tags)))}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(s.F0),l.LFG(pa.F))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ha=a(20765);const ma=s.Bz.forChild([{path:"",canActivate:[Ve.a,ha.d],canActivateChild:[Ve.a,ha.d],data:{permissions:["tickets.view","tickets.create"]},children:[{path:"",redirectTo:"tickets",pathMatch:"full"},{path:"tickets/new",component:Ze,resolve:{categories:ga},data:{permissions:["tickets.create"]},children:[{path:"",component:la}]},{path:"tickets",component:Ze,data:{permissions:["tickets.view"]},children:[{path:"",component:Te},{path:":ticket_id",component:ye.S,resolve:{ticket:Ae.V}}]},{path:"users/:id",component:He,resolve:{user:ze},data:{permissions:["users.view","tickets.view","tags.view"]}}]}]);var ba=a(8574),fa=a(5259),va=a(18295),xa=a(49866),_a=a(95217),Za=a(13202),ka=a(58193);let wa=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[i.ez,ka.x,xa.N,s.Bz,gt.si,Q.Cv,P.Hi]]}),t})();var Ta=a(66705),ya=a(16450),Aa=a(19807),Ca=a(6008),qa=a(31330),Oa=a(87446),Ia=a(6253);let Ma=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({providers:[v.g,ze],imports:[[i.ez,n.u5,n.UX,s.Bz,ba.m,fa.y,va.l,xa.N,_a.u,Za.R,qa.X,wa,Ta.z,ya.m,Aa.o,Ca.b,Oa.m,ma,q.Ps,ut.ot,H.AV,dt.Bb,z.Tx,_.Is,de,Ne.Nh,Ia.B]]}),t})()},99051:function(t,e,a){a.d(e,{i:function(){return s}});var i=a(37716),n=a(90299);let s=(()=>{class t{constructor(t){this.http=t}index(e){return this.http.get(t.BASE_URI,e)}create(e){return this.http.post(t.BASE_URI,e)}update(e,a){return this.http.put(`${t.BASE_URI}/${e}`,a)}delete(e){return this.http.delete(`${t.BASE_URI}/${e}`)}}return t.BASE_URI="tags",t.\u0275fac=function(e){return new(e||t)(i.LFG(n.r))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);