!function(){"use strict";function t(e,n,i){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(e,n,i||e)}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=a(t);if(e){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return o(this,n)}}function o(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}(self.webpackChunkbedesk=self.webpackChunkbedesk||[]).push([[574],{5970:function(t,e,n){n.d(e,{G:function(){return g}});var i,o=n(37716),a=n(24668),r=n(35718),s=n(69958),u=n(34673),d=n(87291),p=n(90962),g=((i=function(){function t(e,n,i,o,a,r){c(this,t),this.router=e,this.toast=n,this.tickets=i,this.settings=o,this.mailboxTags=a,this.localStorage=r,this.defaultAction=this.settings.get("replies.after_reply_action","next_active_ticket")}return l(t,[{key:"perform",value:function(){if(this.router.url.indexOf("help-center")>-1)this.navigateToCustomerTicketsList();else{switch(this.get()){case"next_active_ticket":this.navigateToNextActiveTicket();break;case"back_to_folder":this.navigateToAgentTicketsList()}this.mailboxTags.refresh()}}},{key:"get",value:function(){return this.localStorage.get("after_reply_action",this.defaultAction)}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.defaultAction=t,this.localStorage.set("after_reply_action",t)}},{key:"setTicketId",value:function(t){this.activeTicketId=t}},{key:"navigateToNextActiveTicket",value:function(){var t=this,e=this.mailboxTags.activeTagId$.value;this.tickets.nextActiveTicket(e).subscribe(function(n){n.ticket&&n.ticket.id!==t.activeTicketId?t.router.navigate(["/mailbox/tickets/",n.ticket.id],{queryParams:{tagId:e}}):t.navigateToAgentTicketsList()})}},{key:"navigateToAgentTicketsList",value:function(){this.router.navigate(["/mailbox/tickets"],{queryParams:{tagId:this.mailboxTags.activeTagId$.value}})}},{key:"navigateToCustomerTicketsList",value:function(t){this.router.navigate(["/help-center/tickets"]),this.toast.open(t||"Your reply was submitted successfully.")}}]),t}()).\u0275fac=function(t){return new(t||i)(o.LFG(a.F0),o.LFG(r.F),o.LFG(s.g),o.LFG(u.Z),o.LFG(d.N),o.LFG(p.m))},i.\u0275prov=o.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)},38433:function(t,e,n){n.d(e,{y:function(){return g}});var i,o=n(22238),a=n(37716),r=n(34673),s=n(15515),u=n(51095),d=n(76627),p=n(63297),g=((i=function(){function t(e,n,i){c(this,t),this.dialogRef=e,this.data=n,this.settings=i,this.type=this.getDisplayType(n.reply.type)}return l(t,[{key:"close",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.dialogRef.close(t)}},{key:"confirm",value:function(){this.close(!0)}},{key:"getDisplayType",value:function(t){switch(t){case"replies":return"reply";case"notes":return"note";case"drafts":return"draft"}}}]),t}()).\u0275fac=function(t){return new(t||i)(a.Y36(o.so),a.Y36(o.WI),a.Y36(r.Z))},i.\u0275cmp=a.Xpm({type:i,selectors:[["confirm-reply-delete-modal"]],decls:18,vars:5,consts:[[1,"modal-header",2,"margin","0"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["trans",""],["mat-button","","type","button","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","trans","",1,"submit-button",3,"color","click"]],template:function(t,e){1&t&&(a.TgZ(0,"div",0),a.TgZ(1,"h2",1),a._uU(2),a.qZA(),a.TgZ(3,"button",2),a.NdJ("click",function(){return e.close()}),a._UZ(4,"mat-icon",3),a.qZA(),a.qZA(),a.TgZ(5,"mat-dialog-content"),a.TgZ(6,"p"),a.TgZ(7,"span",4),a._uU(8,"Are you sure you want to delete this"),a.qZA(),a._uU(9," "),a.TgZ(10,"span"),a._uU(11),a.ALo(12,"trans"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(13,"mat-dialog-actions"),a.TgZ(14,"button",5),a.NdJ("click",function(){return e.close()}),a._uU(15,"Close"),a.qZA(),a.TgZ(16,"button",6),a.NdJ("click",function(){return e.confirm()}),a._uU(17,"Delete"),a.qZA(),a.qZA()),2&t&&(a.xp6(2),a.hij("Delete ",e.type,""),a.xp6(9),a.hij("",a.lcZ(12,3,e.type),"?"),a.xp6(5),a.Q6J("color",e.settings.get("vebto.auth.color")))},directives:[o.uh,s.P,u.lW,d.Hw,o.xY,o.H8],pipes:[p.R],encapsulation:2}),i)},30587:function(t,e,n){n.d(e,{M:function(){return x}});var i=n(37716),o=n(69958),a=n(24688),r=n(87291),s=n(66010),u=n(58341),d=n(38583),p=n(76627),g=n(11436),f=n(63297);function h(t,e){1&t&&i._UZ(0,"mat-icon",12)}function v(t,e){if(1&t){var n=i.EpF();i.TgZ(0,"mat-chip",10),i.NdJ("removed",function(){i.CHM(n);var t=i.oxw().$implicit;return i.oxw().removeTag(t)}),i._uU(1),i.YNc(2,h,1,0,"mat-icon",11),i.qZA()}if(2&t){var o=i.oxw().$implicit,a=i.oxw();i.Q6J("removable",a.currentUser.hasPermission("tickets.update")),i.xp6(1),i.hij(" ",o.display_name," "),i.xp6(1),i.Q6J("ngIf",a.currentUser.hasPermission("tickets.update"))}}function m(t,e){if(1&t&&(i.ynx(0),i.YNc(1,v,3,3,"mat-chip",9),i.BQk()),2&t){var n=e.$implicit;i.xp6(1),i.Q6J("ngIf","status"!==n.type)}}function b(t,e){if(1&t){var n=i.EpF();i.TgZ(0,"button",13),i.NdJ("click",function(){return i.CHM(n),i.oxw().conversation.openEditor()}),i.ALo(1,"trans"),i._UZ(2,"mat-icon",14),i.qZA()}2&t&&i.Q6J("matTooltip",i.lcZ(1,1,"Reply (r)"))}var y,x=((y=function(){function t(e,n,i,o){c(this,t),this.tickets=e,this.currentUser=n,this.mailboxTags=i,this.conversation=o}return l(t,[{key:"removeTag",value:function(t){var e=this;this.tickets.removeTag(t,[this.conversation.get().id]).subscribe(function(){e.conversation.get().tags=e.conversation.get().tags.filter(function(e){return e.id!==t.id}),e.mailboxTags.refresh()})}}]),t}()).\u0275fac=function(t){return new(t||y)(i.Y36(o.g),i.Y36(a.I),i.Y36(r.N),i.Y36(s.r))},y.\u0275cmp=i.Xpm({type:y,selectors:[["conversation-header"]],decls:11,vars:6,consts:[[1,"title-container"],[1,"ticket-subject"],[1,"tags"],[3,"selectable"],[4,"ngFor","ngForOf"],[1,"title-meta"],[1,"ticket-created-at-date"],[1,"actions"],["class","button reply-button",3,"matTooltip","click",4,"ngIf"],["class","mat-compact-chip",3,"removable","removed",4,"ngIf"],[1,"mat-compact-chip",3,"removable","removed"],["matChipRemove","","svgIcon","cancel",4,"ngIf"],["matChipRemove","","svgIcon","cancel"],[1,"button","reply-button",3,"matTooltip","click"],["svgIcon","reply"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"h2",1),i._uU(2),i.qZA(),i.TgZ(3,"div",2),i.TgZ(4,"mat-chip-list",3),i.YNc(5,m,2,1,"ng-container",4),i.qZA(),i.qZA(),i.qZA(),i.TgZ(6,"div",5),i.TgZ(7,"div",6),i._uU(8),i.qZA(),i.TgZ(9,"div",7),i.YNc(10,b,3,3,"button",8),i.qZA(),i.qZA()),2&t&&(i.xp6(2),i.Oqu(e.conversation.get().subject),i.xp6(2),i.Q6J("selectable",!1),i.xp6(1),i.Q6J("ngForOf",e.conversation.model.tags),i.xp6(3),i.AsE(" ",e.conversation.get().created_at_formatted," (",e.conversation.get().created_at_month,") "),i.xp6(2),i.Q6J("ngIf","locked"!==e.conversation.status.name))},directives:[u.qn,d.sg,d.O5,u.HS,p.Hw,u.qH,g.gM],pipes:[f.R],styles:["conversation-header{display:flex;align-items:center;flex:none;width:100%}conversation-header .title-container{flex:1 1 auto;display:flex;flex-wrap:wrap;align-items:center;padding:5px 10px 5px 25px;margin:15px 0}conversation-header .title-container h2{color:var(--be-help-center-title-text);font-weight:400;font-size:2.5rem;margin:0 15px 0 0}conversation-header .title-container .tags{display:inline-block}conversation-header .title-container .tags .tag-name{display:inline-block;max-width:50px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;vertical-align:sub}conversation-header .title-meta{flex:0 0 100px;white-space:nowrap;font-size:1.6rem;color:var(--be-secondary-text);text-align:right;padding-right:26px}conversation-header .title-meta .ticket-created-at-date,conversation-header .title-meta .actions{display:inline-block;vertical-align:middle}conversation-header .title-meta .reply-button{min-width:0;border:1px solid var(--be-divider-default);border-radius:4px;color:var(--be-secondary-text);margin-left:10px;padding:5px 12px 6px;background-color:var(--be-background-alternative);cursor:pointer}conversation-header .title-meta .reply-button mat-icon{width:19px;height:19px}@media only screen and (max-width: 768px){conversation-header{margin-bottom:15px}conversation-header .title-meta .ticket-created-at-date{display:none}}\n"],encapsulation:2}),y)},74180:function(t,e,n){n.d(e,{D:function(){return b}});var i=n(66010),o=n(69958),a=n(6350),r=n(35177),s=n(5970),u=n(8208),d=n(22238),p=n(37716),g=n(15381),f=n(87291),h=n(24668);function v(t,e){if(1&t){var n=p.EpF();p.TgZ(0,"button",4),p.NdJ("click",function(){return p.CHM(n),p.oxw().mergeTickets()}),p._uU(1,"Merge"),p.qZA()}}var m,b=((m=function(){function t(e,n,i,o,a,r,s){c(this,t),this.dialogRef=e,this.data=n,this.tickets=i,this.modal=o,this.conversation=a,this.tags=r,this.router=s,this.hydrate()}return l(t,[{key:"close",value:function(t){this.dialogRef.close(t)}},{key:"openTicket",value:function(){this.modal.closeAll(),this.router.navigate(["/mailbox/tickets",this.conversation.get().id],{queryParams:{tagId:this.conversation.getStatus().id}})}},{key:"mergeTickets",value:function(){var t=this;this.modal.show(u.z,{title:"Merge Tickets",body:"Are you sure you want merge this ticket with the original one behind the pop-ups?",bodyBold:"Merged tickets can not be unmerged.",ok:"Merge"}).afterClosed().subscribe(function(e){!e||t.tickets.merge(t.activeTicketId,t.conversation.get().id).subscribe(function(e){t.close(e.ticket),t.tags.refresh()})})}},{key:"hydrate",value:function(){var t=this;this.activeTicketId=this.data.activeTicketId,this.tickets.get(this.data.ticketId).subscribe(function(e){t.conversation.init(e.ticket)})}}]),t}()).\u0275fac=function(t){return new(t||m)(p.Y36(d.so),p.Y36(d.WI),p.Y36(o.g),p.Y36(g.u),p.Y36(i.r),p.Y36(f.N),p.Y36(h.F0))},m.\u0275cmp=p.Xpm({type:m,selectors:[["conversation-modal"]],features:[p._Bn([o.g,i.r,a.n,r.I,s.G])],decls:5,vars:3,consts:[[3,"hideSidebar","hideBackButton"],["toolbar-content","",1,"no-style","icon-button","action",3,"click"],["svgIcon","open-in-browser-custom"],["class","merge-button","mat-raised-button","","color","accent","trans","",3,"click",4,"ngIf"],["mat-raised-button","","color","accent","trans","",1,"merge-button",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"mat-dialog-content"),p.TgZ(1,"conversation",0),p.TgZ(2,"button",1),p.NdJ("click",function(){return e.openTicket()}),p._UZ(3,"mat-icon",2),p.qZA(),p.qZA(),p.YNc(4,v,2,0,"button",3),p.qZA()),2&t&&(p.xp6(1),p.Q6J("hideSidebar",!0)("hideBackButton",!0),p.xp6(3),p.Q6J("ngIf",e.activeTicketId))},styles:[".conversation-modal-container{width:80%;height:calc(100% - 50px)}.conversation-modal-container conversation-modal,.conversation-modal-container .mat-dialog-content,.conversation-modal-container .mat-dialog-container{height:100%;max-height:100%;margin:0;padding:0}.conversation-modal-container .merge-button{position:absolute;top:10px;left:300px}\n"],encapsulation:2}),m)},35177:function(t,e,n){n.d(e,{I:function(){return s}});var i,o=n(37716),a=n(69958),r=n(35718),s=((i=function(){function t(e,n){c(this,t),this.tickets=e,this.toast=n,this.replies=[],this.currentPage=1,this.lastPage=2,this.isLoading=!1}return l(t,[{key:"get",value:function(){return this.replies}},{key:"add",value:function(t){!t||!t.id||this.replies.find(function(e){return e.id===t.id})||this.replies.unshift(t)}},{key:"replace",value:function(t){var e=this.replies.findIndex(function(e){return e.id===t.id});this.replies[e]=t}},{key:"remove",value:function(t){this.replies=this.replies.filter(function(e){return e.id!==t})}},{key:"delete",value:function(t){var e=this;this.tickets.deleteReply(t.id).subscribe(function(){e.remove(t.id),e.toast.open("Deleted successfully")})}},{key:"loadMore",value:function(){var t=this;this.isLoading||(this.isLoading=!0,this.tickets.getTicketReplies(this.ticketId,this.currentPage+1).subscribe(function(e){t.replies=t.replies.concat(e.pagination.data),t.currentPage=e.pagination.current_page,t.lastPage=e.pagination.last_page,t.isLoading=!1},function(){t.isLoading=!1}))}},{key:"canLoadMore",value:function(){return this.currentPage<this.lastPage}},{key:"init",value:function(t,e){this.replies=t.slice(),this.currentPage=1,this.lastPage=2,this.ticketId=e}}]),t}()).\u0275fac=function(t){return new(t||i)(o.LFG(a.g),o.LFG(r.F))},i.\u0275prov=o.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)},61693:function(t,e,n){n.d(e,{Q:function(){return D}});var i=n(22238),o=n(37716),a=n(15515),s=n(51095),u=n(76627),d=n(38583);function p(t,e){if(1&t&&(o.TgZ(0,"div",11),o.TgZ(1,"div",12),o._uU(2),o.qZA(),o.TgZ(3,"div",13),o._uU(4),o.qZA(),o.qZA()),2&t){var n=e.$implicit,i=o.oxw();o.xp6(2),o.Oqu(n),o.xp6(2),o.Oqu(i.originalEmail.headers[n])}}function g(t,e){1&t&&(o.TgZ(0,"span",14),o._uU(1,"Could not find original email for this reply."),o.qZA())}function f(t,e){if(1&t&&(o.TgZ(0,"pre",15),o._uU(1),o.qZA()),2&t){var n=o.oxw();o.xp6(1),o.Oqu(n.originalEmail.body.plain)}}function h(t,e){if(1&t&&(o.TgZ(0,"pre",16),o._uU(1),o.qZA()),2&t){var n=o.oxw();o.xp6(1),o.Oqu(n.originalEmail.body.html)}}var v,m=((v=function(){function t(e,n){c(this,t),this.dialogRef=e,this.data=n,this.headerNames=[],this.hydrate()}return l(t,[{key:"close",value:function(){this.dialogRef.close()}},{key:"hydrate",value:function(){this.originalEmail=this.data.original,this.originalEmail&&this.originalEmail.headers&&(this.headerNames=Object.keys(this.originalEmail.headers))}}]),t}()).\u0275fac=function(t){return new(t||v)(o.Y36(i.so),o.Y36(i.WI))},v.\u0275cmp=o.Xpm({type:v,selectors:[["show-original-reply-modal"]],decls:15,vars:4,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],[1,"headers"],["class","header",4,"ngFor","ngForOf"],[1,"email-content"],["trans","",4,"ngIf"],["class","body-plain",4,"ngIf"],["class","body-html",4,"ngIf"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"click"],[1,"header"],[1,"name"],[1,"value"],["trans",""],[1,"body-plain"],[1,"body-html"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"h2",1),o._uU(2,"Original Message"),o.qZA(),o.TgZ(3,"button",2),o.NdJ("click",function(){return e.close()}),o._UZ(4,"mat-icon",3),o.qZA(),o.qZA(),o.TgZ(5,"mat-dialog-content"),o.TgZ(6,"div",4),o.YNc(7,p,5,2,"div",5),o.qZA(),o.TgZ(8,"div",6),o.YNc(9,g,2,0,"span",7),o.YNc(10,f,2,1,"pre",8),o.YNc(11,h,2,1,"pre",9),o.qZA(),o.qZA(),o.TgZ(12,"mat-dialog-actions"),o.TgZ(13,"button",10),o.NdJ("click",function(){return e.close()}),o._uU(14,"Done"),o.qZA(),o.qZA()),2&t&&(o.xp6(7),o.Q6J("ngForOf",e.headerNames),o.xp6(2),o.Q6J("ngIf",!e.originalEmail),o.xp6(1),o.Q6J("ngIf",e.originalEmail&&e.originalEmail.body.plain),o.xp6(1),o.Q6J("ngIf",e.originalEmail&&e.originalEmail.body.html))},directives:[i.uh,a.P,s.lW,u.Hw,i.xY,d.sg,d.O5,i.H8],styles:['.show-original-reply-modal-container{width:90%;height:90%}.show-original-reply-modal-container .mat-dialog-title{margin-bottom:25px}.show-original-reply-modal-container .mat-dialog-content{max-height:none}.show-original-reply-modal-container .headers{border:1px solid var(--be-divider-default)}.show-original-reply-modal-container .headers>.header{display:flex;padding:10px;border-bottom:1px solid var(--be-divider-default)}.show-original-reply-modal-container .headers>.header>.name{flex:1 1 30%;font-weight:500;max-width:200px}.show-original-reply-modal-container .headers>.header>.value{flex:1 1 65%;margin-left:auto}.show-original-reply-modal-container .email-content{margin-top:40px}.show-original-reply-modal-container .email-content>pre{font-size:1.4rem;font-family:Roboto,"Helvetica Neue",sans-serif;word-wrap:break-word;white-space:pre-wrap}.show-original-reply-modal-container .email-content>.body-plain{margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--be-divider-default)}\n'],encapsulation:2,changeDetection:0}),v),b=n(82192),y=n(9141),x=n(69958),k=n(48350),Z=n(91241);function T(t,e){if(1&t&&(o.TgZ(0,"div",11),o._uU(1),o.qZA()),2&t){var n=o.oxw();o.xp6(1),o.Oqu(n.errors.body)}}function w(t,e){if(1&t&&(o.TgZ(0,"div",11),o._uU(1),o.qZA()),2&t){var n=o.oxw();o.xp6(1),o.Oqu(n.errors.attachments)}}function A(t,e){if(1&t){var n=o.EpF();o.TgZ(0,"reply-attachment-list",12),o.NdJ("detached",function(t){return o.CHM(n),o.oxw().removeAttachment(t)}),o.qZA()}if(2&t){var i=o.oxw();o.Q6J("attachments",i.attachments)}}var q=function(){var t=function(){function t(e,n,i,o){c(this,t),this.dialogRef=e,this.data=n,this.tickets=i,this.uploadQueue=o,this.attachments=[],this.errors={},this.hydrate()}return l(t,[{key:"ngAfterViewInit",value:function(){this.textEditor.focus(),this.textEditor.setContents(this.reply.body)}},{key:"hydrate",value:function(){this.reply=Object.assign({},this.data.reply),this.attachments=this.reply.uploads.slice()}},{key:"close",value:function(t){this.dialogRef.close(t),this.textEditor.destroyEditor()}},{key:"confirm",value:function(){var t=this,e={body:this.textEditor.getContents(),uploads:this.attachments.map(function(t){return t.id})};this.tickets.updateReply(this.reply.id,e).subscribe(function(e){t.close(e.reply)},function(e){return t.errors=e.errors})}},{key:"uploadFiles",value:function(t){var e=this;this.uploadQueue.start(t).subscribe(function(t){e.attachments=[].concat(r(e.attachments),[t.fileEntry])})}},{key:"removeAttachment",value:function(t){for(var e=0;e<this.attachments.length;e++)this.attachments[e].id===t.id&&this.attachments.splice(e,1)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(o.Y36(i.so),o.Y36(i.WI),o.Y36(x.g),o.Y36(y.A))},t.\u0275cmp=o.Xpm({type:t,selectors:[["update-reply-modal"]],viewQuery:function(t,e){var n;(1&t&&o.Gf(b.d,7),2&t)&&(o.iGM(n=o.CRH())&&(e.textEditor=n.first))},features:[o._Bn([y.A])],decls:17,vars:4,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],[1,"many-inputs"],[1,"input-container"],["inlineUploadPrefix","ticket_images",3,"minHeight","onFileUpload"],["class","error",4,"ngIf"],[3,"attachments","detached",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"click"],[1,"error"],[3,"attachments","detached"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"h2",1),o._uU(2,"Update Reply"),o.qZA(),o.TgZ(3,"button",2),o.NdJ("click",function(){return e.close()}),o._UZ(4,"mat-icon",3),o.qZA(),o.qZA(),o.TgZ(5,"mat-dialog-content",4),o.TgZ(6,"div",5),o.TgZ(7,"text-editor",6),o.NdJ("onFileUpload",function(t){return e.uploadFiles(t)}),o.qZA(),o._UZ(8,"upload-progress-bar"),o.YNc(9,T,2,1,"div",7),o.YNc(10,w,2,1,"div",7),o.YNc(11,A,1,1,"reply-attachment-list",8),o.qZA(),o.qZA(),o.TgZ(12,"mat-dialog-actions"),o.TgZ(13,"button",9),o.NdJ("click",function(){return e.close()}),o._uU(14,"Cancel"),o.qZA(),o.TgZ(15,"button",10),o.NdJ("click",function(){return e.confirm()}),o._uU(16,"Update"),o.qZA(),o.qZA()),2&t&&(o.xp6(7),o.Q6J("minHeight",300),o.xp6(2),o.Q6J("ngIf",e.errors.body),o.xp6(1),o.Q6J("ngIf",e.errors.attachments),o.xp6(1),o.Q6J("ngIf",e.attachments.length))},directives:[i.uh,a.P,s.lW,u.Hw,i.xY,b.d,k.o,d.O5,i.H8,Z.G],styles:[".update-reply-modal-container{width:600px}.update-reply-modal-container reply-attachment-list{margin-top:15px}\n"],encapsulation:2}),t}(),_=n(38433),I=n(64278),J=(n(1011),n(27119),n(71209),n(98556),n(14714),n(15381)),C=n(24688),U=n(66010),O=n(3093),Q=n(24668),Y=n(33935);function M(t,e){if(1&t&&o._UZ(0,"img",22),2&t){var n=o.oxw(2).$implicit;o.s9C("src",n.user.avatar,o.LSH),o.s9C("alt",n.user.email)}}function N(t,e){1&t&&(o.TgZ(0,"span",23),o._uU(1,"You"),o.qZA())}function F(t,e){if(1&t&&(o.TgZ(0,"span"),o._uU(1),o.qZA()),2&t){var n=o.oxw(2).$implicit;o.xp6(1),o.Oqu(n.user.display_name)}}function P(t,e){1&t&&(o.TgZ(0,"span",24),o._uU(1,"replied"),o.qZA())}function S(t,e){1&t&&(o.TgZ(0,"span",24),o._uU(1,"started the conversation"),o.qZA())}function R(t,e){1&t&&(o.TgZ(0,"span",24),o._uU(1,"left a note"),o.qZA())}function E(t,e){1&t&&(o.TgZ(0,"span",24),o._uU(1,"created a draft"),o.qZA())}function L(t,e){if(1&t){var n=o.EpF();o.TgZ(0,"span",25),o.TgZ(1,"button",26),o.NdJ("click",function(){o.CHM(n);var t=o.oxw(2).$implicit;return o.oxw().editDraft(t)}),o._uU(2," Edit "),o.qZA(),o.TgZ(3,"button",27),o.NdJ("click",function(){o.CHM(n);var t=o.oxw(2).$implicit;return o.oxw().maybeDeleteReply(t)}),o._uU(4," Discard "),o.qZA(),o.qZA()}}function H(t,e){if(1&t&&(o.ynx(0),o.TgZ(1,"button",28),o._UZ(2,"mat-icon",29),o.qZA(),o.BQk()),2&t){o.oxw();var n=o.MAs(19);o.xp6(1),o.Q6J("matMenuTriggerFor",n)}}function $(t,e){if(1&t){var n=o.EpF();o.TgZ(0,"reply-attachment-list",30),o.NdJ("detached",function(t){o.CHM(n);var e=o.oxw(2).$implicit;return o.oxw().removeAttachment(e,t)}),o.qZA()}if(2&t){var i=o.oxw(2).$implicit;o.Q6J("attachments",i.uploads)}}function j(t,e){if(1&t){var n=o.EpF();o.TgZ(0,"div",3),o.YNc(1,M,1,2,"img",4),o.TgZ(2,"div",5),o.TgZ(3,"div",6),o.TgZ(4,"div",7),o.TgZ(5,"span",8),o.YNc(6,N,2,0,"span",9),o.YNc(7,F,2,1,"span",10),o.qZA(),o._uU(8," "),o.YNc(9,P,2,0,"span",11),o.YNc(10,S,2,0,"span",11),o.YNc(11,R,2,0,"span",11),o.YNc(12,E,2,0,"span",11),o.YNc(13,L,5,0,"span",12),o.qZA(),o.TgZ(14,"div",13),o.TgZ(15,"span",14),o._uU(16),o.qZA(),o.YNc(17,H,3,1,"ng-container",10),o.TgZ(18,"mat-menu",15,16),o.TgZ(20,"div",17),o.NdJ("click",function(){o.CHM(n);var t=o.oxw().$implicit;return o.oxw().update(t)}),o._uU(21," Edit "),o.qZA(),o.TgZ(22,"div",18),o.NdJ("click",function(){o.CHM(n);var t=o.oxw().$implicit;return o.oxw().maybeDeleteReply(t)}),o._uU(23," Delete "),o.qZA(),o.TgZ(24,"div",19),o.NdJ("click",function(){o.CHM(n);var t=o.oxw().$implicit;return o.oxw().showOriginalEmail(t)}),o._uU(25," Show Original "),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o._UZ(26,"div",20),o.YNc(27,$,1,1,"reply-attachment-list",21),o.qZA(),o.qZA()}if(2&t){var i=o.oxw(),a=i.$implicit,r=i.last,s=o.oxw();o.ekj("bounce",a.animated)("my-reply",a.user_id==s.currentUser.get("id")),o.s9C("ngClass",a.type),o.uIk("data-reply-id",a.id),o.xp6(1),o.Q6J("ngIf",a.user.avatar),o.xp6(5),o.Q6J("ngIf",s.currentUser.get("id")==a.user.id),o.xp6(1),o.Q6J("ngIf",s.currentUser.get("id")!=a.user.id),o.xp6(2),o.Q6J("ngIf",!r&&"replies"===a.type),o.xp6(1),o.Q6J("ngIf",r&&"replies"===a.type),o.xp6(1),o.Q6J("ngIf","notes"==a.type),o.xp6(1),o.Q6J("ngIf","drafts"==a.type),o.xp6(1),o.Q6J("ngIf","drafts"===a.type),o.xp6(3),o.Oqu(a.created_at_formatted),o.xp6(1),o.Q6J("ngIf",s.currentUser.hasPermission("replies.update")&&"drafts"!==a.type),o.xp6(9),o.Q6J("innerHTML",a.body,o.oJD),o.xp6(1),o.Q6J("ngIf",a.uploads.length)}}function B(t,e){if(1&t&&o.YNc(0,j,28,18,"div",2),2&t){var n=e.$implicit,i=o.oxw();o.Q6J("ngIf",i.currentUser.hasPermission("tickets.update")||"notes"!==n.type)}}var D=function(){var t=function(){function t(e,n,i,o,a,r,s){c(this,t),this.modal=e,this.currentUser=n,this.tickets=i,this.conversation=o,this.backendEvents=a,this.route=r,this.el=s}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.subscription=this.backendEvents.ticketReplyCreated.subscribe(function(e){t.conversation.get().id===e.ticket_id&&(e.animated=!0,t.conversation.replies.add(e))})}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"ngAfterViewInit",value:function(){I&&I.highlightAll();var t=this.route.snapshot.queryParams.replyId;t&&this.el.nativeElement.querySelector("[data-reply-id-".concat(t,"}]")).scrollIntoView({behavior:"smooth"})}},{key:"update",value:function(t){var e=this;this.modal.open(q,{reply:t},{panelClass:"update-reply-modal-container"}).afterClosed().subscribe(function(t){!t||e.conversation.replies.replace(t)})}},{key:"maybeDeleteReply",value:function(t){var e=this;this.modal.show(_.y,{reply:t}).afterClosed().subscribe(function(n){!n||e.conversation.replies.delete(t)})}},{key:"editDraft",value:function(t){this.conversation.setDraft(t),this.conversation.openEditor(),this.conversation.replies.remove(t.id)}},{key:"showOriginalEmail",value:function(t){var e=this,n="show-original-reply-modal-container";this.tickets.getOriginalEmailForReply(t.id).subscribe(function(t){e.modal.open(m,{original:t.email},{panelClass:n})},function(){e.modal.open(m,null,{panelClass:n})})}},{key:"removeAttachment",value:function(t,e){t.uploads=t.uploads.filter(function(t){return t.id!==e.id}),this.tickets.updateReply(t.id,{uploads:t.uploads.map(function(t){return t.id})}).subscribe()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(o.Y36(J.u),o.Y36(C.I),o.Y36(x.g),o.Y36(U.r),o.Y36(O.O),o.Y36(Q.gz),o.Y36(o.SBq))},t.\u0275cmp=o.Xpm({type:t,selectors:[["conversation-replies"]],inputs:{textEditor:"textEditor"},decls:2,vars:1,consts:[[1,"thread"],["ngFor","",3,"ngForOf"],["class","reply animated",3,"bounce","ngClass","my-reply",4,"ngIf"],[1,"reply","animated",3,"ngClass"],["class","user-avatar",3,"src","alt",4,"ngIf"],[1,"reply-body"],[1,"message-header"],[1,"customer"],[1,"customer-name"],["trans","",4,"ngIf"],[4,"ngIf"],["class","text-gray action-text","trans","",4,"ngIf"],["class","draft-actions",4,"ngIf"],[1,"meta"],[1,"date"],[1,"reply-actions-menu"],["replyActionsMenu","matMenu"],["mat-menu-item","","trans","",1,"update-reply-button",3,"click"],["mat-menu-item","","trans","",1,"delete-reply-button",3,"click"],["mat-menu-item","","trans","",1,"show-original-reply-button",3,"click"],[1,"message-body",3,"innerHTML"],[3,"attachments","detached",4,"ngIf"],[1,"user-avatar",3,"src","alt"],["trans",""],["trans","",1,"text-gray","action-text"],[1,"draft-actions"],["type","button","trans","",1,"no-style","edit-draft-button",3,"click"],["type","button","trans","",1,"no-style","delete-draft-button",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","more-vert"],[3,"attachments","detached"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.YNc(1,B,1,1,"ng-template",1),o.qZA()),2&t&&(o.xp6(1),o.Q6J("ngForOf",e.conversation.replies.get()))},directives:[d.sg,d.O5,d.mk,Y.VK,Y.OP,a.P,s.lW,Y.p6,u.Hw,Z.G],styles:["conversation-replies{display:block;width:100%}conversation-replies .reply{display:flex;padding:25px;border-top:1px solid var(--be-divider-default)}conversation-replies .reply.notes{background-color:#fffcea;color:#836f60;border-left:3px solid #c8bcb4}conversation-replies .reply.drafts{border-left:3px solid var(--be-accent-default)}conversation-replies .reply.drafts .customer .text-gray{color:var(--be-accent-default)}conversation-replies .reply:last-of-type{border-bottom:1px solid var(--be-divider-default)}conversation-replies .reply .user-avatar{flex:0 0 50px;display:block;width:50px;height:50px;margin-right:20px;-o-object-fit:cover;object-fit:cover;border-radius:4px}conversation-replies .reply .reply-body{flex:1 1 auto;max-width:calc(100% - 70px)}conversation-replies .reply reply-attachment-list{border-top:1px dotted var(--be-divider-default);margin:20px 0 0;padding-top:20px;display:inline-flex}conversation-replies .reply reply-attachment-list>.attachments-list-item:last-of-type{margin-right:0}conversation-replies .message-header{font-size:1.65rem;margin-bottom:15px;display:flex}conversation-replies .message-header .customer{flex:1 1 auto}conversation-replies .message-header .customer .draft-actions{margin-left:10px;vertical-align:text-bottom}conversation-replies .message-header .customer .draft-actions button{border:1px solid var(--be-divider-default);padding:5px 8px;font-size:1.2rem;border-radius:3px;margin-right:6px}conversation-replies .message-header .customer .draft-actions button:hover{background-color:#f7f7f7}conversation-replies .message-header .meta{flex:0 0 100px;color:var(--be-secondary-text);font-size:1.2rem;font-weight:500;margin-right:5px;text-align:right;white-space:nowrap;line-height:23px}conversation-replies .message-header .customer-name{text-transform:capitalize;font-weight:500;color:var(--be-help-center-title-text)}conversation-replies .message-header .text-gray{color:var(--be-secondary-text)}conversation-replies .message-body{max-width:90%;word-wrap:break-word;overflow-x:hidden}conversation-replies .message-body a:hover{text-decoration:underline}conversation-replies .message-body img{max-width:100%}\n"],encapsulation:2}),t}()},20964:function(t,e,n){n.d(e,{V:function(){return f}});var i,o=n(59193),a=n(25917),r=n(5304),s=n(19773),u=n(37716),d=n(69958),p=n(24668),g="/help-center/tickets",f=((i=function(){function t(e,n){c(this,t),this.tickets=e,this.router=n}return l(t,[{key:"resolve",value:function(t,e){var n=this;return this.tickets.get(+(t.params.ticket_id||t.params.id)).pipe((0,r.K)(function(){return n.router.navigate([g]),o.E}),(0,s.zg)(function(t){return t.ticket?(0,a.of)(t.ticket):(n.router.navigate([g]),o.E)}))}}]),t}()).\u0275fac=function(t){return new(t||i)(u.LFG(d.g),u.LFG(p.F0))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)},35976:function(t,e,n){n.d(e,{B:function(){return it}});var i=n(38433),o=n(98115),a=n(95414),r=n(36461),s=n(26979),u=n(45435),d=n(15257),p=n(37716),g=n(15381),f=n(24688),h=n(66010),v=n(87291),m=n(4928),b=n(34673),y=n(90962),x=n(38583),k=n(91241),Z=n(48350),T=n(82192),w=n(11436),A=n(76627),q=n(51095),_=n(3679),I=n(14506),J=n(26558),C=n(54395),U=n(87519),O=n(43190),Q=n(5304),Y=n(93342),M=n(33935),N=n(80970),F=n(25917),P=n(16403),S=n(35778),R=n(35718),E=n(15515),L=["input"];function H(t,e){if(1&t){var n=p.EpF();p.TgZ(0,"button",10),p.NdJ("click",function(){return p.CHM(n),p.oxw().showNewCannedReplyModal()}),p.TgZ(1,"strong",11),p._uU(2,"Create new canned reply"),p.qZA(),p.qZA()}}function $(t,e){if(1&t){var n=p.EpF();p.TgZ(0,"button",12),p.NdJ("click",function(){var t=p.CHM(n).$implicit;return p.oxw().selectCannedReply(t)}),p._uU(1),p.qZA()}if(2&t){var i=e.$implicit;p.xp6(1),p.hij(" ",i.name," ")}}function j(t,e){if(1&t&&(p.TgZ(0,"div",13),p.NdJ("click",function(t){return t.stopPropagation()}),p.TgZ(1,"div"),p.TgZ(2,"span",11),p._uU(3,"No results found for"),p.qZA(),p._uU(4," "),p.TgZ(5,"strong"),p._uU(6),p.qZA(),p.qZA(),p.qZA()),2&t){var n=p.oxw();p.xp6(6),p.Oqu(n.searchQuery.value)}}var B,D=((B=function(){function t(e,n,i,o,a){c(this,t),this.cannedRepliesService=e,this.currentUser=n,this.modal=i,this.conversation=o,this.toast=a,this.searchQuery=new _.NI,this.onReplySelect=new p.vpe,this.loadedResultsAtLeastOnce=!1,this.cannedReplies=[]}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.searchQuery.valueChanges.pipe((0,C.b)(250),(0,U.x)(),(0,O.w)(function(e){return t.getCannedReplies(e)}),(0,Q.K)(function(){return(0,F.of)(P.p)})).subscribe(),this.trigger.menuOpened.subscribe(function(){t.loadedResultsAtLeastOnce||t.getCannedReplies(null,!0).subscribe()})}},{key:"selectCannedReply",value:function(t){var e=this,n=t.body.replace(/{{([\w.\-]+?)}}/,function(t,n){return N.pick(n.toLowerCase(),{ticket:e.conversation.get()})||t});this.onReplySelect.emit(Object.assign(Object.assign({},t),{body:n}))}},{key:"showNewCannedReplyModal",value:function(){var t=this,e=new I.V({body:this.conversation.draft.get().body,uploads:this.conversation.draft.get().uploads});this.modal.open(J.w,{cannedReply:e},{panelClass:"crupdate-canned-reply-modal-container"}).afterClosed().subscribe(function(e){!e||(t.toast.open("Canned reply created."),t.cannedReplies.unshift(e))})}},{key:"getCannedReplies",value:function(t,e){var n=this;if(!t&&!e)return(0,F.of)(P.p);var i={query:t,userId:this.currentUser.get("id"),perPage:20,shared:!0};return this.cannedRepliesService.getReplies(i).pipe((0,Y.b)(function(t){n.loadedResultsAtLeastOnce=!0,n.cannedReplies=t.pagination.data}))}}]),t}()).\u0275fac=function(t){return new(t||B)(p.Y36(S.U),p.Y36(f.I),p.Y36(g.u),p.Y36(h.r),p.Y36(R.F))},B.\u0275cmp=p.Xpm({type:B,selectors:[["canned-replies-dropdown"]],viewQuery:function(t,e){var n;1&t&&(p.Gf(M.p6,7),p.Gf(L,7)),2&t&&(p.iGM(n=p.CRH())&&(e.trigger=n.first),p.iGM(n=p.CRH())&&(e.input=n.first))},inputs:{searchQuery:"searchQuery"},outputs:{onReplySelect:"onReplySelect"},decls:10,vars:6,consts:[["mat-icon-button","",1,"no-style","editor-button",3,"matMenuTriggerFor"],["svgIcon","comment",1,"dropdown-icon"],[1,"canned-reply-menu",3,"overlapTrigger"],["cannedReplyMenu","matMenu"],[1,"input-container",3,"click"],["type","text","mat-menu-item","",1,"canned-reply-search-input",3,"formControl"],["input",""],["class","new-canned-reply","mat-menu-item","","trans","",3,"click",4,"ngIf"],["class","canned-reply","mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","no-results",3,"click",4,"ngIf"],["mat-menu-item","","trans","",1,"new-canned-reply",3,"click"],["trans",""],["mat-menu-item","",1,"canned-reply",3,"click"],[1,"no-results",3,"click"]],template:function(t,e){if(1&t&&(p.TgZ(0,"button",0),p._UZ(1,"mat-icon",1),p.qZA(),p.TgZ(2,"mat-menu",2,3),p.TgZ(4,"div",4),p.NdJ("click",function(t){return t.stopPropagation()}),p._UZ(5,"input",5,6),p.qZA(),p.YNc(7,H,3,0,"button",7),p.YNc(8,$,2,1,"button",8),p.YNc(9,j,7,1,"div",9),p.qZA()),2&t){var n=p.MAs(3);p.Q6J("matMenuTriggerFor",n),p.xp6(2),p.Q6J("overlapTrigger",!1),p.xp6(3),p.Q6J("formControl",e.searchQuery),p.xp6(2),p.Q6J("ngIf",!e.searchQuery.value),p.xp6(1),p.Q6J("ngForOf",e.cannedReplies),p.xp6(1),p.Q6J("ngIf",!e.cannedReplies.length&&e.loadedResultsAtLeastOnce&&e.searchQuery.value)}},directives:[q.lW,M.p6,A.Hw,M.VK,_.Fj,M.OP,_.JJ,_.oH,x.O5,x.sg,E.P],styles:["canned-replies-dropdown{display:block}.canned-reply-menu{width:300px}.canned-reply-menu strong{font-weight:500}.canned-reply-menu .input-container{padding:0 10px 10px;border-bottom:1px solid var(--be-divider-default)}.canned-reply-menu .no-results{padding:10px 10px 0;font-size:1.6rem;text-align:center}\n"],encapsulation:2}),B),G=n(63297),V=["textEditor"];function z(t,e){if(1&t){var n=p.EpF();p.TgZ(0,"suggested-articles-dropdown",16),p.NdJ("articleSelected",function(t){return p.CHM(n),p.oxw().insertArticleLink(t)}),p.qZA()}if(2&t){var i=p.oxw();p.Q6J("category",i.conversation.getCategory())}}function K(t,e){if(1&t){var n=p.EpF();p.TgZ(0,"div",17),p.TgZ(1,"canned-replies-dropdown",18),p.NdJ("onReplySelect",function(t){return p.CHM(n),p.oxw().applyCannedReply(t)}),p.qZA(),p.qZA()}}function X(t,e){if(1&t){var n=p.EpF();p.TgZ(0,"button",24),p.NdJ("click",function(){var t=p.CHM(n).$implicit;return p.oxw(2).setSelectedStatus(t)}),p._uU(1),p.qZA()}if(2&t){var i=e.$implicit;p.Q6J("ngClass",i.name),p.xp6(1),p.hij(" ",i.display_name," ")}}function W(t,e){if(1&t&&(p.ynx(0),p.TgZ(1,"button",19),p.TgZ(2,"span"),p._uU(3),p.ALo(4,"trans"),p.qZA(),p._UZ(5,"mat-icon",20),p.qZA(),p.TgZ(6,"mat-menu",21,22),p.YNc(8,X,2,2,"button",23),p.qZA(),p.BQk()),2&t){var n=p.MAs(7),i=p.oxw();p.xp6(1),p.Q6J("matMenuTriggerFor",n),p.xp6(2),p.Oqu(p.lcZ(4,4,null==i.selectedStatus?null:i.selectedStatus.display_name)),p.xp6(3),p.Q6J("overlapTrigger",!1),p.xp6(2),p.Q6J("ngForOf",i.mailboxTags.statusTags)}}function tt(t,e){1&t&&(p.TgZ(0,"span",25),p._uU(1,"Send Reply"),p.qZA())}function et(t,e){1&t&&(p.TgZ(0,"span",25),p._uU(1,"Sending..."),p.qZA())}function nt(t,e){if(1&t){var n=p.EpF();p.ynx(0),p.TgZ(1,"button",26),p._UZ(2,"mat-icon",27),p.qZA(),p.TgZ(3,"mat-menu",28,29),p.TgZ(5,"button",30),p.NdJ("click",function(){return p.CHM(n),p.oxw().conversation.afterReplyAction.set("stay_on_page")}),p._uU(6," Send and stay on page "),p.qZA(),p.TgZ(7,"button",31),p.NdJ("click",function(){return p.CHM(n),p.oxw().conversation.afterReplyAction.set("next_active_ticket")}),p._uU(8," Send and next ticket "),p.qZA(),p.TgZ(9,"button",32),p.NdJ("click",function(){return p.CHM(n),p.oxw().conversation.afterReplyAction.set("back_to_folder")}),p._uU(10," Send and back to folder "),p.qZA(),p.qZA(),p.BQk()}if(2&t){var i=p.MAs(4),o=p.oxw();p.xp6(1),p.Q6J("disabled",o.conversation.replySaving)("matMenuTriggerFor",i),p.xp6(2),p.Q6J("overlapTrigger",!1),p.xp6(2),p.ekj("selected","stay_on_page"===o.conversation.afterReplyAction.get()),p.xp6(2),p.ekj("selected","next_active_ticket"===o.conversation.afterReplyAction.get()),p.xp6(2),p.ekj("selected","back_to_folder"===o.conversation.afterReplyAction.get())}}var it=function(){var t=function(){function t(e,n,i,o,a,r,u,l){c(this,t),this.modal=e,this.currentUser=n,this.conversation=i,this.browserEvents=o,this.mailboxTags=a,this.urls=r,this.settings=u,this.localStorage=l,this.selectedStatus=new s.V,this.subscriptions=[]}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.mailboxTags.allTags$.pipe((0,u.h)(function(t){return!!t.length}),(0,d.q)(1)).subscribe(function(){t.setSelectedStatus()}),this.initKeybinds(),this.conversation.setEditor(this.textEditor)}},{key:"submitReply",value:function(){var t=this,e={body:this.textEditor.getContents(),status:this.selectedStatus};this.conversation.submitReply(e).subscribe(function(){t.closeEditor()},function(){})}},{key:"saveDraft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.conversation.draft.save(t)}},{key:"closeEditor",value:function(){this.conversation.closeEditor(),this.conversation.draft.reset(),this.textEditor.reset()}},{key:"saveDraftAndAddToReplies",value:function(){var t=this;this.conversation.draft.isEmpty()?this.closeEditor():this.saveDraft().subscribe(function(e){t.conversation.replies.add(e.reply),t.closeEditor()})}},{key:"maybeDeleteDraft",value:function(){var t=this,e=this.conversation.draft.get();e.id?this.modal.show(i.y,{reply:e}).afterClosed().subscribe(function(e){!e||(t.conversation.draft.delete(),t.closeEditor())}):this.closeEditor()}},{key:"applyCannedReply",value:function(t){var e=this;this.textEditor.insertContents(t.body),setTimeout(function(){var n;e.saveDraft({uploads:null===(n=t.uploads)||void 0===n?void 0:n.map(function(t){return t.id})})})}},{key:"setSelectedStatus",value:function(t){if(t)this.localStorage.set("default_status_tag",t.name);else{var e=this.localStorage.get("default_status_tag");t=e?this.mailboxTags.getTagByIdOrName(e):this.currentUser.hasPermission("tickets.update")?this.mailboxTags.getTagByIdOrName("closed"):this.mailboxTags.getTagByIdOrName("open")}this.selectedStatus=t}},{key:"initKeybinds",value:function(){var t=this,e=this.browserEvents.globalKeyDown$.subscribe(function(e){t.modal.anyDialogOpen()||o.J.userIsTyping()||(e.keyCode===r.R&&"locked"!==t.conversation.status.name&&(t.conversation.openEditor(),t.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})),e.keyCode===r.hn&&(e.ctrlKey||e.metaKey)&&(t.articleDropdown.focus(),t.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})))});this.subscriptions.push(e),this.textEditor.editor.waitForEditor().then(function(e){e.shortcuts.add(["ctrl+191","meta+191"],"Search docs",function(){t.articleDropdown.focus(),t.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})})})}},{key:"ngOnDestroy",value:function(){this.saveDraft(),this.closeEditor(),this.subscriptions.forEach(function(t){t&&t.unsubscribe()})}},{key:"insertArticleLink",value:function(t){var e=this.urls.article(t);this.textEditor.insertLink({target:"blank",href:this.settings.getBaseUrl()+e,text:t.title})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(p.Y36(g.u),p.Y36(f.I),p.Y36(h.r),p.Y36(o.J),p.Y36(v.N),p.Y36(m.X),p.Y36(b.Z),p.Y36(y.m))},t.\u0275cmp=p.Xpm({type:t,selectors:[["conversation-text-editor"]],viewQuery:function(t,e){var n;(1&t&&(p.Gf(V,7),p.Gf(a.B,5)),2&t)&&(p.iGM(n=p.CRH())&&(e.textEditor=n.first),p.iGM(n=p.CRH())&&(e.articleDropdown=n.first))},decls:21,vars:18,consts:[[1,"text-editor-container"],["placeholder","Search docs... (ctrl + /)",3,"category","articleSelected",4,"ngIf"],[3,"attachments","detached"],["inlineUploadPrefix","ticket_images",3,"onChange","onFileUpload","onCtrlEnter"],["textEditor",""],["class","header-actions","customButtons","",4,"ngIf"],["header","",1,"header-actions","last","right"],["type","button",1,"no-style","editor-button","save-draft-button",3,"matTooltip","click"],["svgIcon","check-circle"],["type","button",1,"no-style","editor-button","delete-draft-button",3,"matTooltip","click"],["svgIcon","delete"],["footer","",1,"editor-footer"],[1,"right"],[4,"ngIf"],["type","button","mat-flat-button","","color","accent",1,"submit-button",3,"disabled","click"],["trans","",4,"ngIf"],["placeholder","Search docs... (ctrl + /)",3,"category","articleSelected"],["customButtons","",1,"header-actions"],[3,"onReplySelect"],["type","button","mat-button","",1,"change-status-button",3,"matMenuTriggerFor"],["svgIcon","keyboard-arrow-down",1,"dropdown-icon"],[1,"status-menu",3,"overlapTrigger"],["statusMenu","matMenu"],["mat-menu-item","","trans","",3,"ngClass","click",4,"ngFor","ngForOf"],["mat-menu-item","","trans","",3,"ngClass","click"],["trans",""],["mat-flat-button","","color","accent",1,"dropdown-left","submit-button-addon",3,"disabled","matMenuTriggerFor"],["svgIcon","arrow-drop-down",1,"caret","align-middle"],[1,"default-redirect-menu",3,"overlapTrigger"],["defaultRedirectMenu","matMenu"],["mat-menu-item","","trans","",1,"stay-on-page",3,"click"],["mat-menu-item","","trans","",1,"next-active-ticket",3,"click"],["mat-menu-item","","trans","",1,"back_to_folder",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"section",0),p.YNc(1,z,1,1,"suggested-articles-dropdown",1),p.TgZ(2,"reply-attachment-list",2),p.NdJ("detached",function(t){return e.conversation.draft.detachUpload(t)}),p.qZA(),p._UZ(3,"upload-progress-bar"),p.TgZ(4,"text-editor",3,4),p.NdJ("onChange",function(t){return e.conversation.draft.setBody(t)})("onFileUpload",function(t){return e.conversation.draft.uploadFiles(t)})("onCtrlEnter",function(){return e.submitReply()}),p.YNc(6,K,2,0,"div",5),p.TgZ(7,"div",6),p.TgZ(8,"button",7),p.NdJ("click",function(){return e.saveDraftAndAddToReplies()}),p.ALo(9,"trans"),p._UZ(10,"mat-icon",8),p.qZA(),p.TgZ(11,"button",9),p.NdJ("click",function(){return e.maybeDeleteDraft()}),p.ALo(12,"trans"),p._UZ(13,"mat-icon",10),p.qZA(),p.qZA(),p.TgZ(14,"div",11),p.TgZ(15,"div",12),p.YNc(16,W,9,6,"ng-container",13),p.TgZ(17,"button",14),p.NdJ("click",function(){return e.submitReply()}),p.YNc(18,tt,2,0,"span",15),p.YNc(19,et,2,0,"span",15),p.qZA(),p.YNc(20,nt,11,9,"ng-container",13),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.ekj("hidden",!e.conversation.isEditorOpen()),p.xp6(1),p.Q6J("ngIf",e.currentUser.hasPermission("tickets.update")),p.xp6(1),p.Q6J("attachments",e.conversation.draft.get().uploads),p.xp6(4),p.Q6J("ngIf",e.currentUser.hasPermission("canned_replies.view")),p.xp6(2),p.ekj("success",e.conversation.draft.get().id),p.Q6J("matTooltip",p.lcZ(9,14,"Save Draft")),p.xp6(3),p.Q6J("matTooltip",p.lcZ(12,16,"Discard (Esc)")),p.xp6(5),p.Q6J("ngIf",e.currentUser.hasPermission("tickets.update")),p.xp6(1),p.Q6J("disabled",e.conversation.replySaving),p.xp6(1),p.Q6J("ngIf",!e.conversation.replySaving),p.xp6(1),p.Q6J("ngIf",e.conversation.replySaving),p.xp6(1),p.Q6J("ngIf",e.currentUser.hasPermission("settings.update")))},directives:[x.O5,k.G,Z.o,T.d,w.gM,A.Hw,q.lW,a.B,D,M.p6,M.VK,x.sg,M.OP,E.P,x.mk],pipes:[G.R],styles:["conversation-text-editor{display:block;width:100%}conversation-text-editor suggested-articles-dropdown .input-container{position:relative;margin-bottom:10px}conversation-text-editor suggested-articles-dropdown .input-container .search-icon{position:absolute;right:0;top:3px;color:var(--be-secondary-text)}conversation-text-editor .text-editor-container{margin:0 25px 25px}conversation-text-editor .attachments-list{border-bottom:1px dotted var(--be-divider-default);padding-bottom:10px}conversation-text-editor .attachments-list .attachments-list-item{background-color:var(--be-background-alternative)}conversation-text-editor .editor-footer .right{height:100%;display:flex;position:absolute;right:0;top:0}conversation-text-editor .editor-footer .right .change-status-button{height:100%;color:var(--be-secondary-text);font-weight:500;text-transform:capitalize}conversation-text-editor .editor-footer .right .change-status-button .mat-icon{width:20px;height:20px;vertical-align:text-bottom}conversation-text-editor .editor-footer .right .submit-button,conversation-text-editor .editor-footer .right .submit-button-addon{height:38px;border-radius:0;font-weight:400;position:relative;top:-1px}conversation-text-editor .editor-footer .right .submit-button-addon{border-left:1px solid var(--be-accent-emphasis);padding:0 7px;min-width:45px}.default-redirect-menu .selected{background-color:var(--be-accent-emphasis)}.status-menu .mat-menu-item{text-transform:capitalize}\n"],encapsulation:2}),t}()},61:function(n,o,s){s.d(o,{S:function(){return $t}});var u=s(37716),d=s(24668),p=s(97312),g=s(24688),f=s(66010),h=s(22238),v=s(9141),m=s(68939),b=s(69958),y=s(15515),x=s(51095),k=s(76627),Z=s(3679),T=s(82192),w=s(48350),A=s(38583),q=s(91241),_=["textEditor"];function I(t,e){if(1&t&&(u.TgZ(0,"div",13),u._uU(1),u.qZA()),2&t){var n=u.oxw();u.xp6(1),u.Oqu(n.errors.body)}}function J(t,e){if(1&t&&(u.TgZ(0,"div",13),u._uU(1),u.qZA()),2&t){var n=u.oxw();u.xp6(1),u.Oqu(n.errors.file)}}function C(t,e){if(1&t&&(u.TgZ(0,"div",13),u._uU(1),u.qZA()),2&t){var n=u.oxw();u.xp6(1),u.Oqu(n.errors.attachments)}}function U(t,e){if(1&t){var n=u.EpF();u.TgZ(0,"reply-attachment-list",14),u.NdJ("detached",function(t){return u.CHM(n),u.oxw().removeAttachment(t)}),u.qZA()}if(2&t){var i=u.oxw();u.Q6J("attachments",i.attachments)}}var O,Q=((O=function(){function t(e,n,i,o,a){c(this,t),this.dialogRef=e,this.data=n,this.ticketService=i,this.uploads=o,this.uploadQueue=a,this.errors={},this.attachments=[],this.loading=!1}return l(t,[{key:"ngOnInit",value:function(){this.textEditor.focus()}},{key:"close",value:function(t){this.textEditor.destroyEditor(),this.dialogRef.close(t)}},{key:"confirm",value:function(){var t=this;this.loading=!0;var e={body:this.textEditor.getContents(),uploads:this.attachments.map(function(t){return t.id})};this.ticketService.addNote(this.data.ticketId,e).pipe((0,m.x)(function(){return t.loading=!1})).subscribe(function(e){t.close(e.reply)},function(e){return t.errors=e.errors})}},{key:"uploadFiles",value:function(t){var e=this;this.uploadQueue.start(t).subscribe(function(t){e.attachments=[].concat(r(e.attachments),[t.fileEntry])})}},{key:"removeAttachment",value:function(t){for(var e=0;e<this.attachments.length;e++)this.attachments[e].id===t.id&&this.attachments.splice(e,1)}}]),t}()).\u0275fac=function(t){return new(t||O)(u.Y36(h.so),u.Y36(h.WI),u.Y36(b.g),u.Y36(p.f),u.Y36(v.A))},O.\u0275cmp=u.Xpm({type:O,selectors:[["add-note-modal"]],viewQuery:function(t,e){var n;1&t&&u.Gf(_,7),2&t&&u.iGM(n=u.CRH())&&(e.textEditor=n.first)},features:[u._Bn([f.r,v.A])],decls:20,vars:6,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["ngNativeValidate","",3,"ngSubmit"],[1,"many-inputs"],[1,"input-container"],["inlineUploadPrefix","ticket_images",1,"text-editor",3,"minHeight","onFileUpload"],["textEditor",""],["class","error",4,"ngIf"],[3,"attachments","detached",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"error"],[3,"attachments","detached"]],template:function(t,e){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"h2",1),u._uU(2,"Add Note"),u.qZA(),u.TgZ(3,"button",2),u.NdJ("click",function(){return e.close()}),u._UZ(4,"mat-icon",3),u.qZA(),u.qZA(),u.TgZ(5,"form",4),u.NdJ("ngSubmit",function(){return e.confirm()}),u.TgZ(6,"mat-dialog-content",5),u.TgZ(7,"div",6),u.TgZ(8,"text-editor",7,8),u.NdJ("onFileUpload",function(t){return e.uploadFiles(t)}),u.qZA(),u._UZ(10,"upload-progress-bar"),u.YNc(11,I,2,1,"div",9),u.YNc(12,J,2,1,"div",9),u.YNc(13,C,2,1,"div",9),u.YNc(14,U,1,1,"reply-attachment-list",10),u.qZA(),u.qZA(),u.TgZ(15,"mat-dialog-actions"),u.TgZ(16,"button",11),u.NdJ("click",function(){return e.close()}),u._uU(17,"Cancel"),u.qZA(),u.TgZ(18,"button",12),u._uU(19,"Add Note"),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(8),u.Q6J("minHeight",300),u.xp6(3),u.Q6J("ngIf",e.errors.body),u.xp6(1),u.Q6J("ngIf",e.errors.file),u.xp6(1),u.Q6J("ngIf",e.errors.attachments),u.xp6(1),u.Q6J("ngIf",e.attachments.length),u.xp6(4),u.Q6J("disabled",e.loading))},directives:[h.uh,y.P,x.lW,k.Hw,Z.JL,Z.F,h.xY,T.d,w.o,A.O5,h.H8,q.G],styles:[".add-note-modal-container{width:600px}.add-note-modal-container reply-attachment-list{margin-top:15px}\n"],encapsulation:2}),O),Y=s(44625),M=s(4075),N=s(98115),F=s(33935),P=s(36461),S=s(15381),R=s(87291),E=s(45435),L=function(){var t=function(){function t(e){c(this,t),this.router=e,this.history=[],this.limit=15}return l(t,[{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.history[t]||null}},{key:"getPrevious",value:function(){return this.get(1)}},{key:"back",value:function(){var t=this.getPrevious();return t?this.router.navigate([t.url],{queryParams:t.queryParams}):new Promise(function(t){return t(!1)})}},{key:"addHistoryItem",value:function(t){var e=t.split("?"),n={};e[1]&&(n=this.parseQueryParams(e[1])),this.history.length>=this.limit&&this.history.splice(1,this.history.length-1),this.history.unshift({url:e[0],queryParams:n})}},{key:"parseQueryParams",value:function(t){return new URLSearchParams(t),{}}},{key:"init",value:function(){var t=this;this.router.events.pipe((0,E.h)(function(t){return t instanceof d.m2})).subscribe(function(e){t.addHistoryItem(e.urlAfterRedirects)})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(u.LFG(d.F0))},t.\u0275prov=u.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),H=s(11436),$=s(63297),j=["ticketStatusMenuTrigger"];function B(t,e){1&t&&(u.TgZ(0,"a",16),u.ALo(1,"trans"),u._UZ(2,"mat-icon",17),u.qZA()),2&t&&u.Q6J("matTooltip",u.lcZ(1,1,"Back (b)"))}function D(t,e){if(1&t){var n=u.EpF();u.TgZ(0,"button",18),u.NdJ("click",function(){var t=u.CHM(n).$implicit;return u.oxw(2).changeTicketStatus(t)}),u._uU(1),u.qZA()}if(2&t){var i=e.$implicit,o=u.oxw(2);u.ekj("active",(null==o.conversation.status?null:o.conversation.status.name)===i.name),u.Q6J("ngClass",i.name),u.xp6(1),u.hij(" ",i.display_name||i.name," ")}}var G=function(t){return[t]};function V(t,e){if(1&t){var n=u.EpF();u.ynx(0),u.YNc(1,B,3,3,"a",5),u.TgZ(2,"assign-ticket-dropdown",6),u.NdJ("assigned",function(){return u.CHM(n),u.oxw().refreshMailboxTags()}),u.ALo(3,"trans"),u.qZA(),u.TgZ(4,"button",7),u.NdJ("click",function(){return u.CHM(n),u.oxw().showNoteModal()}),u.ALo(5,"trans"),u._UZ(6,"mat-icon",8),u.qZA(),u.TgZ(7,"add-tag-dropdown",9),u.NdJ("tagAdded",function(t){return u.CHM(n),u.oxw().addTag(t)}),u.ALo(8,"trans"),u.qZA(),u.TgZ(9,"button",10,11),u.ALo(11,"trans"),u._UZ(12,"mat-icon",12),u.qZA(),u.TgZ(13,"mat-menu",13,14),u.YNc(15,D,2,4,"button",15),u.qZA(),u.Hsn(16),u.BQk()}if(2&t){var i=u.MAs(14),o=u.oxw();u.xp6(1),u.Q6J("ngIf",!o.hideBackButton),u.xp6(1),u.Q6J("ticket",o.conversation.get())("matTooltip",u.lcZ(3,10,"Assign (a)")),u.xp6(2),u.Q6J("matTooltip",u.lcZ(5,12,"Note (n)")),u.xp6(3),u.Q6J("ticketIds",u.VKq(18,G,o.conversation.get().id))("matTooltip",u.lcZ(8,14,"Tag (t)")),u.xp6(2),u.Q6J("matMenuTriggerFor",i)("matTooltip",u.lcZ(11,16,"Status (s)")),u.xp6(4),u.Q6J("overlapTrigger",!1),u.xp6(2),u.Q6J("ngForOf",o.mailboxTags.statusTags)}}var z=function(){return["tickets.update"]},K=["*"],X=function(){var t=function(){function t(e,n,i,o,a,r,s,u,l,d){c(this,t),this.router=e,this.injector=n,this.modals=i,this.route=o,this.currentUser=a,this.tickets=r,this.conversation=s,this.browserEvents=u,this.mailboxTags=l,this.routerHistory=d,this.hideBackButton=!1,this.subscriptions=[]}return l(t,[{key:"ngOnInit",value:function(){this.initKeybinds()}},{key:"changeTicketStatus",value:function(t){var e=this;!t||this.tickets.changeTicketStatus(this.conversation.get().id,t.name).subscribe(function(){e.conversation.performAfterReplyAction(),e.conversation.setStatus(t)})}},{key:"showNoteModal",value:function(){var t=this;this.modals.open(Q,{ticketId:this.conversation.get().id},{panelClass:"add-note-modal-container"}).afterClosed().subscribe(function(e){!e||t.addNewNote(e)})}},{key:"addTag",value:function(t){this.conversation.addTag(t),this.refreshMailboxTags()}},{key:"addNewNote",value:function(t){!t||this.conversation.replies.add(t)}},{key:"refreshMailboxTags",value:function(){this.mailboxTags.refresh()}},{key:"initKeybinds",value:function(){var t=this,e=this.browserEvents.globalKeyDown$.subscribe(function(e){var n=!0;if(!(t.modals.anyDialogOpen()||N.J.userIsTyping()||e.ctrlKey||e.metaKey)){switch(e.keyCode){case P.B:t.closeAllMenus(),t.router.navigate(["../"],{relativeTo:t.route});break;case P.A:t.assignTicketDropdown.open();break;case P.N:t.closeAllMenus(),t.showNoteModal();break;case P.T:t.addTagDropdown.open();break;case P.S:t.ticketStatusTrigger.menuOpen?t.handleTicketStatusChangeKeybind("spam"):t.ticketStatusTrigger.openMenu();break;case P.O:t.handleTicketStatusChangeKeybind("open");break;case P.C:t.handleTicketStatusChangeKeybind("closed");break;case P.P:t.handleTicketStatusChangeKeybind("pending");break;case P.L:t.handleTicketStatusChangeKeybind("locked");break;default:n=!1}n&&(e.preventDefault(),e.stopPropagation())}});this.subscriptions.push(e)}},{key:"closeAllMenus",value:function(){this.addTagDropdown.close(),this.assignTicketDropdown.close(),this.ticketStatusTrigger.closeMenu()}},{key:"handleTicketStatusChangeKeybind",value:function(t){!this.ticketStatusTrigger.menuOpen||(this.changeTicketStatus(this.mailboxTags.getTagByIdOrName(t)),this.ticketStatusTrigger.closeMenu())}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(t){t&&t.unsubscribe()})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(u.Y36(d.F0),u.Y36(u.zs3),u.Y36(S.u),u.Y36(d.gz),u.Y36(g.I),u.Y36(b.g),u.Y36(f.r),u.Y36(N.J),u.Y36(R.N),u.Y36(L))},t.\u0275cmp=u.Xpm({type:t,selectors:[["conversation-toolbar"]],viewQuery:function(t,e){var n;(1&t&&(u.Gf(Y.H,5),u.Gf(M.$,5),u.Gf(j,5,F.p6)),2&t)&&(u.iGM(n=u.CRH())&&(e.assignTicketDropdown=n.first),u.iGM(n=u.CRH())&&(e.addTagDropdown=n.first),u.iGM(n=u.CRH())&&(e.ticketStatusTrigger=n.first))},inputs:{hideBackButton:"hideBackButton"},ngContentSelectors:K,decls:7,vars:5,consts:[[1,"left","toolbar-actions"],[4,"ngIf"],[1,"right","ticket-info"],[1,"ticket-number"],[1,"ticket-status",3,"ngClass"],["class","no-style action back-button","routerLink","../","queryParamsHandling","preserve",3,"matTooltip",4,"ngIf"],[1,"action",3,"ticket","matTooltip","assigned"],[1,"action","no-style","add-note-button",3,"matTooltip","click"],["svgIcon","note-custom"],[1,"action",3,"ticketIds","matTooltip","tagAdded"],[1,"no-style","change-ticket-status-button","action",3,"matMenuTriggerFor","matTooltip"],["ticketStatusMenuTrigger",""],["svgIcon","flag-custom"],[1,"ticket-status-menu",3,"overlapTrigger"],["ticketStatusMenu","matMenu"],["mat-menu-item","",3,"active","ngClass","click",4,"ngFor","ngForOf"],["routerLink","../","queryParamsHandling","preserve",1,"no-style","action","back-button",3,"matTooltip"],["svgIcon","return-custom"],["mat-menu-item","",3,"ngClass","click"]],template:function(t,e){1&t&&(u.F$t(),u.TgZ(0,"div",0),u.YNc(1,V,17,20,"ng-container",1),u.qZA(),u.TgZ(2,"div",2),u.TgZ(3,"div",3),u._uU(4),u.qZA(),u.TgZ(5,"div",4),u._uU(6),u.qZA(),u.qZA()),2&t&&(u.xp6(1),u.Q6J("ngIf",e.currentUser.hasPermissions(u.DdM(4,z))),u.xp6(3),u.hij("#",e.conversation.get().id,""),u.xp6(1),u.Q6J("ngClass",e.conversation.getStatus().name),u.xp6(1),u.Oqu(e.conversation.getStatus().display_name))},directives:[A.O5,A.mk,Y.H,H.gM,k.Hw,M.$,F.p6,F.VK,A.sg,d.yS,F.OP],pipes:[$.R],styles:["conversation-toolbar{display:block;width:100%;border-bottom:1px solid var(--be-divider-default);height:57px;padding:0 35px 0 10px;white-space:nowrap;color:var(--be-help-center-title-text)}conversation-toolbar .left,conversation-toolbar .right{width:50%;height:100%;display:inline-flex;align-items:center;padding:15px 0}conversation-toolbar .toolbar-actions .action{margin:0 15px;height:26px;width:26px;position:relative;transition:color .2s ease-in-out;color:inherit}conversation-toolbar .toolbar-actions .action:hover{color:var(--be-text)}conversation-toolbar .toolbar-actions .action mat-icon{height:26px;width:26px}conversation-toolbar .ticket-info{justify-content:flex-end;vertical-align:top}conversation-toolbar .ticket-info .ticket-number{font-size:3rem}conversation-toolbar .ticket-info .ticket-status{border:1px solid var(--be-divider-default);border-radius:2px;background-color:var(--be-background-alternative);padding:4px 12px;margin-left:10px;text-transform:uppercase;font-weight:500;font-size:1.1rem;letter-spacing:.02em}conversation-toolbar .ticket-info .ticket-status.open{background-color:var(--be-accent-default);color:var(--be-accent-contrast);border-color:transparent}@media only screen and (max-width: 768px){conversation-toolbar{padding:0 10px}conversation-toolbar .ticket-number{display:none}}.ticket-status-menu .mat-menu-item{text-transform:capitalize}.ticket-status-menu .mat-menu-item.active{background-color:var(--be-accent-emphasis)}\n"],encapsulation:2}),t}(),W=s(19867),tt=s(30587),et=s(35976),nt=s(61693),it=s(20616),ot=s(74180),at=s(35866),rt=s(35718),st=s(34673),ct=s(26215),ut=s(99183),lt=s(18256),dt=function(){var t=function(){function t(e,n,i,o,a){c(this,t),this.dialogRef=e,this.data=n,this.envato=i,this.toast=o,this.cd=a,this.searchFormControl=new Z.NI,this.loading$=new ct.X(!1)}return l(t,[{key:"close",value:function(){this.dialogRef.close(this.syncedPurchases)}},{key:"syncPurchases",value:function(){var t=this;this.loading$.next(!0),this.envato.syncPurchases(this.data.purchase.user_id).pipe((0,m.x)(function(){return t.loading$.next(!1)})).subscribe(function(e){t.toast.open("Purchases synced"),t.data.purchase=e.purchases.find(function(e){return e.code===t.data.purchase.code}),t.syncedPurchases=e.purchases,t.cd.markForCheck()})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(u.Y36(h.so),u.Y36(h.WI),u.Y36(ut.q),u.Y36(rt.F),u.Y36(u.sBO))},t.\u0275cmp=u.Xpm({type:t,selectors:[["envato-purchase-details-modal"]],decls:32,vars:15,consts:[[1,"purchase"],["alt","",1,"purchase-img",3,"src"],[1,"details"],["target","_blank",1,"item-name",3,"href"],[1,"purchase-code"],[1,"detail-list"],[1,"detail-line"],["trans","",1,"detail-name"],["target","_blank",1,"detail-value",3,"href"],[1,"detail-value"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","button","cdkFocusInitial","","mat-raised-button","","color","accent","trans","",3,"disabled","click"]],template:function(t,e){1&t&&(u.TgZ(0,"mat-dialog-content"),u.TgZ(1,"div",0),u._UZ(2,"img",1),u.TgZ(3,"div",2),u.TgZ(4,"a",3),u._uU(5),u.qZA(),u.TgZ(6,"div",4),u._uU(7),u.qZA(),u.TgZ(8,"div",5),u.TgZ(9,"div",6),u.TgZ(10,"div",7),u._uU(11,"Customer:"),u.qZA(),u.TgZ(12,"a",8),u._uU(13),u.qZA(),u.qZA(),u.TgZ(14,"div",6),u.TgZ(15,"div",7),u._uU(16,"Purchased:"),u.qZA(),u.TgZ(17,"div",9),u._uU(18),u.ALo(19,"formattedDate"),u.qZA(),u.qZA(),u.TgZ(20,"div",6),u.TgZ(21,"div",7),u._uU(22,"Supported Until:"),u.qZA(),u.TgZ(23,"div",9),u._uU(24),u.ALo(25,"formattedDate"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(26,"mat-dialog-actions"),u.TgZ(27,"button",10),u.NdJ("click",function(){return e.close()}),u._uU(28,"Close"),u.qZA(),u.TgZ(29,"button",11),u.NdJ("click",function(){return e.syncPurchases()}),u.ALo(30,"async"),u._uU(31," Sync Purchases "),u.qZA(),u.qZA()),2&t&&(u.xp6(2),u.Q6J("src",e.data.purchase.image,u.LSH),u.xp6(2),u.Q6J("href",e.data.purchase.url,u.LSH),u.xp6(1),u.Oqu(e.data.purchase.item_name),u.xp6(2),u.Oqu(e.data.purchase.code),u.xp6(5),u.Q6J("href","https://codecanyon.net/user/"+e.data.purchase.envato_username,u.LSH),u.xp6(1),u.Oqu(e.data.purchase.envato_username),u.xp6(5),u.Oqu(u.lcZ(19,9,e.data.purchase.purchased_at)),u.xp6(6),u.hij(" ",e.data.purchase.supported_until?u.lcZ(25,11,e.data.purchase.supported_until):"Support expired"," "),u.xp6(5),u.Q6J("disabled",u.lcZ(30,13,e.loading$)))},directives:[h.xY,y.P,h.H8,x.lW],pipes:[lt.l,A.Ov],styles:["[_nghost-%COMP%]{display:block;width:400px;max-width:100%}.purchase[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.purchase-img[_ngcontent-%COMP%]{flex-shrink:0;width:80px;height:80px;border-radius:4px;margin-right:15px}.item-name[_ngcontent-%COMP%]{display:block;margin-bottom:5px}.purchase-code[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--be-secondary-text)}.detail-list[_ngcontent-%COMP%]{margin:15px 0}.detail-line[_ngcontent-%COMP%]{display:flex;padding:4px 0}.detail-value[_ngcontent-%COMP%]{display:block;padding-left:15px;color:var(--be-secondary-text)}"],changeDetection:0}),t}();function pt(t,e){if(1&t&&(u.TgZ(0,"div",9),u._UZ(1,"mat-icon",10),u.TgZ(2,"a",11),u._uU(3),u.qZA(),u.qZA()),2&t){var n=u.oxw(2);u.xp6(2),u.Q6J("href","https://codecanyon.net/user/"+n.envatoPurchase.envato_username,u.LSH)("title",n.envatoPurchase.envato_username),u.xp6(1),u.Oqu(n.envatoPurchase.envato_username)}}function gt(t,e){if(1&t){var n=u.EpF();u.TgZ(0,"div",12),u.NdJ("click",function(){return u.CHM(n),u.oxw(2).openPurchaseDetailsModal()}),u._UZ(1,"img",13),u.TgZ(2,"div",14),u.TgZ(3,"div",15),u._uU(4),u.qZA(),u.TgZ(5,"div",16),u._uU(6),u.ALo(7,"formattedDate"),u.qZA(),u.qZA(),u.qZA()}if(2&t){var i=e.$implicit,o=u.oxw(2);u.ekj("current-purchase",o.envatoPurchase.code===i.code),u.xp6(1),u.Q6J("src",i.image,u.LSH),u.xp6(3),u.Oqu(i.item_name),u.xp6(1),u.ekj("expired",i.support_expired),u.xp6(1),u.hij(" ",i.supported_until?u.lcZ(7,7,i.supported_until):"Support Expired"," ")}}function ft(t,e){if(1&t){var n=u.EpF();u.TgZ(0,"div"),u.ALo(1,"async"),u.TgZ(2,"div",1),u.NdJ("click",function(){return u.CHM(n),u.oxw().toggleVisibility()}),u.TgZ(3,"div",2),u._uU(4,"Envato"),u.qZA(),u.TgZ(5,"button",3),u._UZ(6,"mat-icon",4),u.qZA(),u.qZA(),u.TgZ(7,"div",5),u.YNc(8,pt,4,3,"div",6),u.TgZ(9,"div",7),u.YNc(10,gt,8,9,"div",8),u.qZA(),u.qZA(),u.qZA()}if(2&t){var i=u.oxw();u.ekj("panel-content-visible",u.lcZ(1,4,i.contentVisible$)),u.xp6(8),u.Q6J("ngIf",i.envatoPurchase.envato_username),u.xp6(2),u.Q6J("ngForOf",i.customer.purchase_codes)}}var ht=function(){var t=function(){function t(e,n){c(this,t),this.conversation=e,this.modal=n,this.contentVisible$=new ct.X(!0)}return l(t,[{key:"noPurchaseCode",get:function(){return!this.envatoPurchase}},{key:"ngOnChanges",value:function(){this.customer&&this.setEnvatoPurchase()}},{key:"setEnvatoPurchase",value:function(){var t=this.conversation.getCategory();if(this.customer.purchase_codes.length){var e;if(t){var n=t.name.toLowerCase();e=this.customer.purchase_codes.find(function(t){return t.item_name.toLowerCase().indexOf(n)>-1})}this.envatoPurchase=e||this.customer.purchase_codes[0]}}},{key:"openPurchaseDetailsModal",value:function(){var t=this;this.modal.open(dt,{purchase:this.envatoPurchase}).afterClosed().subscribe(function(e){e&&(t.customer.purchase_codes=e,t.envatoPurchase=e.find(function(e){return e.code===t.envatoPurchase.code}))})}},{key:"toggleVisibility",value:function(){this.contentVisible$.next(!this.contentVisible$.value)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(u.Y36(f.r),u.Y36(S.u))},t.\u0275cmp=u.Xpm({type:t,selectors:[["envato-purchases"]],hostVars:2,hostBindings:function(t,e){2&t&&u.ekj("hidden",e.noPurchaseCode)},inputs:{customer:"customer"},features:[u.TTD],decls:1,vars:1,consts:[[3,"panel-content-visible",4,"ngIf"],[1,"sidebar-header",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],[1,"panel-content"],["class","info-line",4,"ngIf"],[1,"envato-purchases"],["class","purchase-item",3,"current-purchase","click",4,"ngFor","ngForOf"],[1,"info-line"],["svgIcon","person"],["target","_blank",3,"href","title"],[1,"purchase-item",3,"click"],["alt","Purchase image",3,"src"],[1,"purchase-info"],[1,"purchase-name"],[1,"purchase-support"]],template:function(t,e){1&t&&u.YNc(0,ft,11,6,"div",0),2&t&&u.Q6J("ngIf",e.envatoPurchase)},directives:[A.O5,y.P,k.Hw,A.sg],pipes:[A.Ov,lt.l],styles:["[_nghost-%COMP%]{display:block}.purchase-item[_ngcontent-%COMP%]{display:flex;align-items:center;white-space:nowrap;padding:6px 15px;margin:0 -15px;cursor:pointer}.purchase-item[_ngcontent-%COMP%]:hover{background-color:var(--be-hover)}.purchase-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px;flex-shrink:0;margin-right:8px;border-radius:4px}.current-purchase[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis)}.purchase-info[_ngcontent-%COMP%]{overflow:hidden}.purchase-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.purchase-support[_ngcontent-%COMP%]{color:var(--be-secondary-text);font-size:1.2rem}.purchase-support.expired[_ngcontent-%COMP%]{text-decoration:line-through}"],changeDetection:0}),t}(),vt=s(58341),mt=s(86911),bt=s(90299),yt=s(4928);function xt(t,e){if(1&t&&(u.ynx(0),u.TgZ(1,"span",14),u._uU(2,"Viewed article"),u.qZA(),u._uU(3,": "),u.TgZ(4,"a",15),u._uU(5),u.qZA(),u.BQk()),2&t){var n=u.oxw().$implicit,i=u.oxw();u.xp6(4),u.Q6J("routerLink",i.urls.article(n.subject)),u.xp6(1),u.Oqu(n.subject.title)}}function kt(t,e){1&t&&(u.TgZ(0,"span",14),u._uU(1,"Replied via email:"),u.qZA())}function Zt(t,e){1&t&&(u.TgZ(0,"span",14),u._uU(1,"Replied via site:"),u.qZA())}var Tt=function(t){return{replyId:t}};function wt(t,e){if(1&t&&(u.ynx(0),u.YNc(1,kt,2,0,"span",17),u.YNc(2,Zt,2,0,"span",17),u._uU(3," "),u.TgZ(4,"a",18),u._uU(5),u.qZA(),u.BQk()),2&t){var n=u.oxw(2).$implicit,i=u.oxw();u.xp6(1),u.Q6J("ngIf","email"===(null==n.properties?null:n.properties.source)),u.xp6(1),u.Q6J("ngIf","email"!==(null==n.properties?null:n.properties.source)),u.xp6(2),u.Q6J("routerLink",i.urls.agentMailboxTicket(n.subject.id))("queryParams",u.VKq(5,Tt,null==n.properties?null:n.properties.replyId)),u.xp6(1),u.Oqu(n.subject.subject)}}function At(t,e){if(1&t&&(u.ynx(0),u.TgZ(1,"span",14),u._uU(2,"Created ticket"),u.qZA(),u._uU(3,": "),u.TgZ(4,"a",15),u._uU(5),u.qZA(),u.BQk()),2&t){var n=u.oxw(2).$implicit,i=u.oxw();u.xp6(4),u.Q6J("routerLink",i.urls.agentMailboxTicket(n.subject.id)),u.xp6(1),u.Oqu(n.subject.subject)}}var qt=function(t){return{count:t}};function _t(t,e){if(1&t&&(u.ynx(0),u.TgZ(1,"span",19),u._uU(2,"Suggested :count articles for"),u.qZA(),u._uU(3,' "'),u.TgZ(4,"span",20),u._uU(5),u.qZA(),u._uU(6,'" '),u.BQk()),2&t){var n=u.oxw(2).$implicit;u.xp6(1),u.Q6J("transValues",u.VKq(2,qt,null==n.properties?null:n.properties.articleIds.length)),u.xp6(4),u.Oqu(null==n.properties?null:n.properties.query)}}function It(t,e){if(1&t&&(u.ynx(0),u.YNc(1,wt,6,7,"ng-container",16),u.YNc(2,At,6,2,"ng-container",16),u.YNc(3,_t,7,4,"ng-container",16),u.BQk()),2&t){var n=u.oxw().$implicit;u.xp6(1),u.Q6J("ngIf","replied"===n.event),u.xp6(1),u.Q6J("ngIf","created"===n.event),u.xp6(1),u.Q6J("ngIf","articlesSuggested"===n.event)}}function Jt(t,e){if(1&t&&(u.ynx(0),u._uU(1,'Searched for "'),u.TgZ(2,"a",15),u._uU(3),u.qZA(),u._uU(4,'"'),u.BQk()),2&t){var n=u.oxw().$implicit,i=u.oxw();u.xp6(2),u.Q6J("routerLink",i.urls.searchPage(n.subject.term)),u.xp6(1),u.Oqu(n.subject.term)}}function Ct(t,e){if(1&t&&(u.TgZ(0,"div",6),u.TgZ(1,"div",7),u.ynx(2,8),u.YNc(3,xt,6,2,"ng-container",9),u.YNc(4,It,4,3,"ng-container",9),u.YNc(5,Jt,5,2,"ng-container",9),u.BQk(),u.qZA(),u.TgZ(6,"div",10),u._uU(7),u.qZA(),u.TgZ(8,"div",11),u._UZ(9,"div",12),u._UZ(10,"div",13),u.qZA(),u.qZA()),2&t){var n=e.$implicit,i=e.last,o=u.oxw();u.ekj("highlight","created"===n.event&&(null==n.subject?null:n.subject.id)===o.conversation.get().id)("last",i),u.xp6(2),u.Q6J("ngSwitch",n.subject.model_type),u.xp6(1),u.Q6J("ngSwitchCase","article"),u.xp6(1),u.Q6J("ngSwitchCase","ticket"),u.xp6(1),u.Q6J("ngSwitchCase","searchTerm"),u.xp6(1),u.Q6J("title",n.created_at),u.xp6(1),u.hij(" ",n.created_at_human," ")}}var Ut=function(){var n=function(n){e(s,n);var o=i(s);function s(t,e,n,i,a){var r;return c(this,s),(r=o.call(this)).http=t,r.urls=e,r.zone=n,r.el=i,r.conversation=a,r.pagination$=new ct.X(null),r.logVisible$=new ct.X(!0),r.loading$=new ct.X(!1),r}return l(s,[{key:"ngOnInit",value:function(){t(a(s.prototype),"ngOnInit",this).call(this)}},{key:"ngOnChanges",value:function(t){var e,n;(null===(e=t.user.previousValue)||void 0===e?void 0:e.id)!==(null===(n=t.user.currentValue)||void 0===n?void 0:n.id)&&this.loadActivity()}},{key:"loadActivity",value:function(t){var e=this;this.loading$.next(!0),this.http.get("activity-log",{userId:this.user.id,page:t||1}).pipe((0,m.x)(function(){return e.loading$.next(!1)})).subscribe(function(n){e.pagination$.next(t?Object.assign(Object.assign({},n.pagination),{data:[].concat(r(e.pagination$.value.data),r(n.pagination.data))}):n.pagination)})}},{key:"toggleVisibility",value:function(){this.logVisible$.next(!this.logVisible$.value)}},{key:"loadMoreItems",value:function(){this.loadActivity(this.pagination$.value.current_page+1)}},{key:"canLoadMore",value:function(){return this.pagination$.value.last_page>this.pagination$.value.current_page}},{key:"isLoading",value:function(){return this.loading$.value}}]),s}(mt.v);return n.\u0275fac=function(t){return new(t||n)(u.Y36(bt.r),u.Y36(yt.X),u.Y36(u.R0b),u.Y36(u.SBq),u.Y36(f.r))},n.\u0275cmp=u.Xpm({type:n,selectors:[["activity-panel"]],inputs:{user:"user"},features:[u.qOj,u.TTD],decls:10,vars:7,consts:[[1,"sidebar-header",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],[1,"panel-content"],["class","activity",3,"highlight","last",4,"ngFor","ngForOf"],[1,"activity"],[1,"header"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"time",3,"title"],[1,"sideline"],[1,"line"],[1,"circle"],["trans",""],["target","_blank",1,"bold",3,"routerLink"],[4,"ngIf"],["trans","",4,"ngIf"],["target","_blank",1,"bold",3,"routerLink","queryParams"],["trans","",3,"transValues"],[1,"bold"]],template:function(t,e){var n;(1&t&&(u.TgZ(0,"div"),u.ALo(1,"async"),u.TgZ(2,"div",0),u.NdJ("click",function(){return e.toggleVisibility()}),u.TgZ(3,"div",1),u._uU(4,"Interactions"),u.qZA(),u.TgZ(5,"button",2),u._UZ(6,"mat-icon",3),u.qZA(),u.qZA(),u.TgZ(7,"div",4),u.YNc(8,Ct,11,10,"div",5),u.ALo(9,"async"),u.qZA(),u.qZA()),2&t)&&(u.ekj("panel-content-visible",u.lcZ(1,3,e.logVisible$)),u.xp6(8),u.Q6J("ngForOf",null==(n=u.lcZ(9,5,e.pagination$))?null:n.data))},directives:[y.P,k.Hw,A.sg,A.RF,A.n9,d.yS,A.O5],pipes:[A.Ov],styles:["[_nghost-%COMP%]{display:block}.activity[_ngcontent-%COMP%]{position:relative;margin:0 -15px;padding:6px 15px 6px 38px}.activity.highlight[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis)}.activity.last[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:none}.time[_ngcontent-%COMP%]{color:var(--be-secondary-text);text-transform:capitalize}.bold[_ngcontent-%COMP%]{font-weight:500;color:currentColor}.sideline[_ngcontent-%COMP%]{position:absolute;top:10px;bottom:0;left:16px}.line[_ngcontent-%COMP%]{width:1px;height:calc(100% + 10px);background:var(--be-divider-default)}.circle[_ngcontent-%COMP%]{position:absolute;left:-6px;top:0;width:12px;height:12px;border-radius:50%;border:1px solid var(--be-divider-default);background-color:var(--be-background-alternative)}"],changeDetection:0}),n}();function Ot(t,e){if(1&t&&(u.TgZ(0,"mat-chip",27),u._uU(1),u.qZA()),2&t){var n=e.$implicit;u.xp6(1),u.Oqu(n.display_name)}}function Qt(t,e){if(1&t&&(u.TgZ(0,"div",24),u.TgZ(1,"mat-chip-list",25),u.YNc(2,Ot,2,1,"mat-chip",26),u.qZA(),u.qZA()),2&t){var n=u.oxw(2);u.xp6(1),u.Q6J("selectable",!1),u.xp6(1),u.Q6J("ngForOf",n.requester.tags)}}var Yt=function(t){return["/mailbox/users",t]};function Mt(t,e){if(1&t){var n=u.EpF();u.TgZ(0,"div",9),u.TgZ(1,"a",10),u._UZ(2,"img",11),u.qZA(),u.TgZ(3,"div",12),u.TgZ(4,"div",13),u.TgZ(5,"div",14),u._uU(6),u.qZA(),u.TgZ(7,"button",15),u._UZ(8,"mat-icon",16),u.qZA(),u.qZA(),u.TgZ(9,"div",17),u._UZ(10,"mat-icon",18),u.TgZ(11,"span",19),u._uU(12),u.qZA(),u.qZA(),u.TgZ(13,"mat-menu",null,20),u.TgZ(15,"a",21),u._uU(16,"Edit Profile"),u.qZA(),u.TgZ(17,"button",22),u.NdJ("click",function(){return u.CHM(n),u.oxw().changeCustomer()}),u._uU(18,"Change Customer"),u.qZA(),u.qZA(),u.YNc(19,Qt,3,2,"div",23),u.qZA(),u.qZA()}if(2&t){var i=u.MAs(14),o=u.oxw();u.xp6(1),u.Q6J("routerLink",u.VKq(9,Yt,o.requester.id)),u.xp6(1),u.Q6J("src",o.requester.avatar,u.LSH),u.xp6(3),u.Q6J("title",o.requester.display_name),u.xp6(1),u.Oqu(o.requester.display_name),u.xp6(1),u.Q6J("matMenuTriggerFor",i),u.xp6(4),u.Q6J("title",o.requester.email),u.xp6(1),u.Oqu(o.requester.email),u.xp6(3),u.Q6J("routerLink",u.VKq(11,Yt,o.requester.id)),u.xp6(4),u.Q6J("ngIf",o.requester.tags.length)}}function Nt(t,e){if(1&t){var n=u.EpF();u.TgZ(0,"div",30),u.NdJ("click",function(){var t=u.CHM(n).$implicit;return u.oxw(2).openTicketModal(t.id)}),u._UZ(1,"mat-icon",18),u.TgZ(2,"span"),u._uU(3),u.qZA(),u.qZA()}if(2&t){var i=e.$implicit;u.ekj("last",e.last)("open",!i.closed_at),u.xp6(3),u.Oqu(i.subject)}}function Ft(t,e){if(1&t&&(u.TgZ(0,"div",28),u.YNc(1,Nt,4,5,"div",29),u.qZA()),2&t){var n=u.oxw();u.xp6(1),u.Q6J("ngForOf",n.otherTickets)}}function Pt(t,e){if(1&t&&u._UZ(0,"activity-panel",31),2&t){var n=u.oxw();u.Q6J("user",n.requester)}}var St=function(){var t=function(){function t(e,n,i,o,a,r){c(this,t),this.modal=e,this.tickets=n,this.conversation=i,this.route=o,this.toast=a,this.settings=r,this.previousTicketsVisible=!0}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe(function(e){t.activeTicket=e.ticket,t.loadUserData()})}},{key:"openTicketModal",value:function(t){var e=this,n={ticketId:t,activeTicketId:this.conversation.get().id};this.modal.open(ot.D,n,{panelClass:"conversation-modal-container"}).afterClosed().subscribe(function(n){!n||(e.otherTickets=e.otherTickets.filter(function(e){return e.id!==t}),e.conversation.init(n))})}},{key:"getUserTicketsExceptCurrent",value:function(){var t=this;!this.requester||this.tickets.getTickets({userId:this.requester.id,perPage:6}).subscribe(function(e){t.otherTickets=e.pagination.data.filter(function(e){return e.id!==t.activeTicket.id})})}},{key:"changeCustomer",value:function(){var t=this;this.modal.open(at.y).beforeClosed().subscribe(function(e){!e||t.tickets.update(t.activeTicket.id,{user_id:e.id}).subscribe(function(){t.requester=e,t.loadUserData(),t.toast.open("Customer changed.")})})}},{key:"loadUserData",value:function(){this.requester=this.activeTicket.user,this.getUserTicketsExceptCurrent()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(u.Y36(S.u),u.Y36(b.g),u.Y36(f.r),u.Y36(d.gz),u.Y36(rt.F),u.Y36(st.Z))},t.\u0275cmp=u.Xpm({type:t,selectors:[["conversation-sidebar"]],decls:10,vars:6,consts:[["class","user-info sidebar-panel",4,"ngIf"],[1,"sidebar-panel",3,"customer"],[1,"sidebar-panel"],[1,"sidebar-header",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],["class","tickets-list panel-content",4,"ngIf"],["class","sidebar-panel last",3,"user",4,"ngIf"],[1,"user-info","sidebar-panel"],[1,"avatar",3,"routerLink"],["alt","Avatar",3,"src"],[1,"user-details"],[1,"name"],[1,"text",3,"title"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","settings"],[1,"info-line"],["svgIcon","mail"],[3,"title"],["editCustomerMenu","matMenu"],["mat-menu-item","","trans","",3,"routerLink"],["mat-menu-item","","trans","",3,"click"],["class","user-tags",4,"ngIf"],[1,"user-tags"],[3,"selectable"],["class","mat-compact-chip",4,"ngFor","ngForOf"],[1,"mat-compact-chip"],[1,"tickets-list","panel-content"],["class","ticket",3,"last","open","click",4,"ngFor","ngForOf"],[1,"ticket",3,"click"],[1,"sidebar-panel","last",3,"user"]],template:function(t,e){1&t&&(u.YNc(0,Mt,20,13,"div",0),u._UZ(1,"envato-purchases",1),u.TgZ(2,"div",2),u.TgZ(3,"div",3),u.NdJ("click",function(){return e.previousTicketsVisible=!e.previousTicketsVisible}),u.TgZ(4,"div",4),u._uU(5,"Previous conversations"),u.qZA(),u.TgZ(6,"button",5),u._UZ(7,"mat-icon",6),u.qZA(),u.qZA(),u.YNc(8,Ft,2,1,"div",7),u.qZA(),u.YNc(9,Pt,1,1,"activity-panel",8)),2&t&&(u.Q6J("ngIf",e.requester),u.xp6(1),u.Q6J("customer",e.requester),u.xp6(1),u.ekj("panel-content-visible",e.previousTicketsVisible),u.xp6(6),u.Q6J("ngIf",e.otherTickets),u.xp6(1),u.Q6J("ngIf",e.settings.get("tickets.log_activity")))},directives:[A.O5,ht,y.P,k.Hw,d.yS,x.lW,F.p6,F.VK,F.OP,vt.qn,A.sg,vt.HS,Ut],styles:["conversation-sidebar{display:flex;flex-direction:column;flex-shrink:0;width:240px;background-color:var(--be-background-alternative);border-left:1px solid var(--be-divider-default)}@media screen and (max-width: 768px){conversation-sidebar{display:none}}conversation-sidebar .user-tags{margin-top:10px}conversation-sidebar .user-info{margin:15px 0 10px;border-bottom:1px solid var(--be-divider-default);padding-bottom:10px}conversation-sidebar .user-info .avatar{display:block;width:100%;text-align:center;margin-bottom:10px}conversation-sidebar .user-info .avatar img{max-width:55px;max-height:65px;margin:0 auto;border-radius:4px}conversation-sidebar .user-info .user-details{color:var(--be-secondary-text)}conversation-sidebar .user-info .user-details a{color:inherit}conversation-sidebar .user-info .user-details .name{display:flex;align-items:center;font-size:1.7rem;max-height:24px}conversation-sidebar .user-info .user-details .name .text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}conversation-sidebar .user-info .user-details .name .mat-icon-button{margin-left:auto;color:var(--be-secondary-text);flex-shrink:0}conversation-sidebar .user-info .user-details .name .mat-icon{width:18px;height:18px}conversation-sidebar .info-line{display:flex;align-items:center;padding:3px 0;overflow:hidden;text-overflow:ellipsis}conversation-sidebar .info-line a{color:inherit}conversation-sidebar .info-line .mat-icon{width:18px;height:18px;margin-right:5px}conversation-sidebar .sidebar-header{position:relative;display:flex;align-items:center;margin-bottom:15px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}conversation-sidebar .sidebar-header .text{margin-right:auto;font-weight:500}conversation-sidebar .sidebar-header .toggle-button{flex-shrink:0;width:24px;height:24px;color:var(--be-secondary-text)}conversation-sidebar .sidebar-header .toggle-button .mat-icon{transition:all .3s ease}conversation-sidebar .sidebar-panel{padding:0 15px;margin-bottom:15px}conversation-sidebar .sidebar-panel:not(.last){padding-bottom:15px;border-bottom:1px solid var(--be-divider-lighter)}conversation-sidebar .panel-content{display:none}conversation-sidebar .panel-content-visible .panel-content{display:block}conversation-sidebar .panel-content-visible .toggle-button .mat-icon{display:inline-block;transform:rotate(180deg)}conversation-sidebar activity-panel{height:100px;flex:1 1 auto;overflow:auto}conversation-sidebar .ticket{color:var(--be-secondary-text);cursor:pointer}conversation-sidebar .ticket:not(.last){margin-bottom:15px}conversation-sidebar .ticket .mat-icon{color:var(--be-secondary-text);width:17px;height:17px;vertical-align:middle;margin-right:3px}conversation-sidebar .ticket:hover{text-decoration:underline;color:var(--be-text)}conversation-sidebar .ticket.open{color:var(--be-text)}\n"],encapsulation:2}),t}(),Rt=["scrollContainer"];function Et(t,e){1&t&&u._UZ(0,"conversation-sidebar")}var Lt=[[["","toolbar-content",""]]],Ht=["[toolbar-content]"],$t=function(){var t=function(){function t(e,n,i,o,a){c(this,t),this.route=e,this.uploads=n,this.currentUser=i,this.conversation=o,this.el=a,this.hideBackButton=!1,this.hideSidebar=!1}return l(t,[{key:"ngAfterViewInit",value:function(){this.conversation.scrollContainer=this.scrollContainer.nativeElement}},{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe(function(e){t.conversation.init(e.ticket),t.el.nativeElement.focus()})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(u.Y36(d.gz),u.Y36(p.f),u.Y36(g.I),u.Y36(f.r),u.Y36(u.SBq))},t.\u0275cmp=u.Xpm({type:t,selectors:[["conversation"]],viewQuery:function(t,e){var n;(1&t&&u.Gf(Rt,5),2&t)&&(u.iGM(n=u.CRH())&&(e.scrollContainer=n.first))},inputs:{hideBackButton:"hideBackButton",hideSidebar:"hideSidebar"},ngContentSelectors:Ht,decls:11,vars:3,consts:[[1,"conversation-container"],[3,"hideBackButton"],["conversationInfiniteScroll","",1,"ticket-container"],["scrollContainer",""],[4,"ngIf"],[1,"overlay",3,"isVisible"]],template:function(t,e){1&t&&(u.F$t(Lt),u.ynx(0),u.TgZ(1,"div",0),u.TgZ(2,"conversation-toolbar",1),u.Hsn(3),u.qZA(),u.TgZ(4,"div",2,3),u._UZ(6,"conversation-header"),u._UZ(7,"conversation-text-editor"),u._UZ(8,"conversation-replies"),u.qZA(),u.qZA(),u.YNc(9,Et,1,0,"conversation-sidebar",4),u.BQk(),u._UZ(10,"loading-indicator",5)),2&t&&(u.xp6(2),u.Q6J("hideBackButton",e.hideBackButton),u.xp6(7),u.Q6J("ngIf",!e.hideSidebar),u.xp6(1),u.Q6J("isVisible",e.conversation.replies.isLoading||e.conversation.isLoading))},directives:[X,W.b,tt.M,et.B,nt.Q,A.O5,it.Q,St],styles:["conversation{display:flex;position:relative}conversation .conversation-container{flex:1 1 auto;min-width:0;height:calc(100vh - 70px);overflow:auto}conversation .conversation-container.invisible{visibility:hidden}conversation .ticket-container{display:flex;flex-direction:column;height:calc(100% - 60px);overflow:auto}\n"],encapsulation:2}),t}()},8574:function(t,e,n){n.d(e,{m:function(){return M}});var i,o=n(38583),a=n(3679),r=n(24668),s=n(74180),u=n(61),l=n(35778),d=n(66010),p=n(20964),g=n(69958),f=n(20082),h=n(6350),v=n(35177),m=n(5970),b=n(5259),y=n(76435),x=n(22238),k=n(75892),Z=n(18295),T=n(76627),w=n(33935),A=n(51095),q=n(49866),_=n(98097),I=n(11436),J=n(43389),C=n(13202),U=n(66705),O=n(58341),Q=n(37716),Y=n(15515),M=((i=function t(){c(this,t)}).\u0275fac=function(t){return new(t||i)},i.\u0275mod=Q.oAB({type:i}),i.\u0275inj=Q.cJS({providers:[l.U,d.r,v.I,g.g,p.V,f.c,h.n,m.G],imports:[[o.ez,a.u5,a.UX,r.Bz,b.y,y.q,Z.l,q.N,_.X,J.p,C.R,U.z,k.t,I.AV,x.Is,T.Ps,w.Tx,A.ot,O.Hi]]}),i);Q.B6R(s.D,[x.xY,u.S,T.Hw,o.O5,A.lW,Y.P],[])},66010:function(t,e,n){n.d(e,{r:function(){return h}});var i,o=n(37716),a=n(76590),r=n(26979),s=n(93342),u=n(6350),d=n(35718),p=n(69958),g=n(35177),f=n(5970),h=((i=function(){function t(e,n,i,s,u){c(this,t),this.draft=e,this.toast=n,this.tickets=i,this.replies=s,this.afterReplyAction=u,this.isLoading=!1,this.model=new a.Sj({tags:[]}),this.status=new r.V,this.replySaving=!1,this.editorIsOpen=!1,this.afterInit=new o.vpe}return l(t,[{key:"get",value:function(){return this.model}},{key:"getStatus",value:function(){return this.status||new r.V}},{key:"getCategory",value:function(){var t=this.model.tags.find(function(t){return"status"!==t.type});return t&&t.categories?t.categories[0]:null}},{key:"setStatus",value:function(t){!t||(this.status=t)}},{key:"openEditor",value:function(){var t=this;this.editorIsOpen=!0,setTimeout(function(){return t.editor&&t.editor.focus()})}},{key:"closeEditor",value:function(){this.editorIsOpen=!1}},{key:"isEditorOpen",value:function(){return this.editorIsOpen}},{key:"setEditor",value:function(t){this.editor=t}},{key:"setDraft",value:function(t){this.draft.set(t),this.editor.setContents(t.body)}},{key:"addTag",value:function(t){this.model.tags.find(function(e){return e.id===t.id})||this.model.tags.unshift(t)}},{key:"submitReply",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.replySaving=!0,this.tickets.saveReply(this.model.id,this.draft.getPayload(e)).pipe((0,s.b)(function(n){t.replySaving=!1,t.draft.delete(),t.performAfterReplyAction(),t.setStatus(e.status),t.replies.add(n.reply)},function(e){t.toast.open(e.message||"There was an issue submitting this reply."),t.replySaving=!1,t.isLoading=!1}))}},{key:"performAfterReplyAction",value:function(){this.afterReplyAction.get()&&"stay_on_page"!==this.afterReplyAction.get()&&(this.isLoading=!0),this.afterReplyAction.perform()}},{key:"init",value:function(t){!t||(this.model=t,this.status=t.tags.find(function(t){return"status"===t.type}),this.replies.init(this.model.replies,this.model.id),this.draft.setTicketId(this.model.id),this.afterReplyAction.setTicketId(this.model.id),this.isLoading=!1,this.afterInit.emit())}}]),t}()).\u0275fac=function(t){return new(t||i)(o.LFG(u.n),o.LFG(d.F),o.LFG(p.g),o.LFG(g.I),o.LFG(f.G))},i.\u0275prov=o.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)},6350:function(t,e,n){n.d(e,{n:function(){return v}});var i,o=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var n in c(this,t),this.type="replies",e)this[n]=e[n]},a=n(25917),s=n(42145),u=n(12627),d=n(5304),p=n(18819),g=n(37716),f=n(69958),h=n(9141),v=((i=function(){function t(e,n){c(this,t),this.tickets=e,this.uploadQueue=n,this.reset()}return l(t,[{key:"get",value:function(){return this.model}},{key:"set",value:function(t){this.model=t}},{key:"setBody",value:function(t){this.model.body=t}},{key:"setTicketId",value:function(t){this.ticketId=t}},{key:"isEmpty",value:function(){return 0===this.model.body.length&&0===this.model.uploads.length}},{key:"uploadFiles",value:function(t){var e=this;this.uploadQueue.start(t).pipe((0,s.R)(function(t,e){return[].concat(r(t),[e.fileEntry])},[]),(0,u.Z)()).subscribe(function(t){e.model.uploads=[].concat(r(e.model.uploads),r(t)),e.save()})}},{key:"detachUpload",value:function(t){var e=this,n=this.model.uploads.filter(function(e){return e.id!==t.id}).map(function(t){return t.id});this.tickets.updateReply(this.model.id,{uploads:n}).subscribe(function(){var n=e.get().uploads.findIndex(function(e){return e.id===t.id});e.get().uploads.splice(n,1)})}},{key:"save",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isEmpty()){var n=this.tickets.saveDraft(this.ticketId,this.getPayload(e),this.model.id).pipe((0,d.K)(function(){return(0,a.of)({reply:t.get()})}),(0,p.B)());return n.subscribe(function(e){t.set(e.reply)}),n}}},{key:"delete",value:function(){this.model.id&&this.tickets.deleteReply(this.model.id).subscribe(),this.reset()}},{key:"getPayload",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},{body:this.model.body||null,uploads:this.model.uploads.map(function(t){return t.id})},t)}},{key:"reset",value:function(){this.set(new o({uploads:[],body:""}))}}]),t}()).\u0275fac=function(t){return new(t||i)(g.LFG(f.g),g.LFG(h.A))},i.\u0275prov=g.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)},19867:function(n,o,r){r.d(o,{b:function(){return g}});var s,u=r(37716),d=r(86911),p=r(66010),g=((s=function(n){e(r,n);var o=i(r);function r(t,e,n){var i;return c(this,r),(i=o.call(this)).el=t,i.conversation=e,i.zone=n,i.scrollTargetIsDocument=!1,i}return l(r,[{key:"ngOnInit",value:function(){this.scrollTargetIsDocument&&(this.el=new u.SBq(document)),t(a(r.prototype),"ngOnInit",this).call(this)}},{key:"getScrollContainer",value:function(){return document}},{key:"loadMoreItems",value:function(){this.conversation.replies.loadMore()}},{key:"isLoading",value:function(){return this.conversation.replies.isLoading}},{key:"canLoadMore",value:function(){return this.conversation.replies.canLoadMore()}}]),r}(d.v)).\u0275fac=function(t){return new(t||s)(u.Y36(u.SBq),u.Y36(p.r),u.Y36(u.R0b))},s.\u0275dir=u.lG2({type:s,selectors:[["","conversationInfiniteScroll",""]],inputs:{scrollTargetIsDocument:"scrollTargetIsDocument"},features:[u.qOj]}),s)},76590:function(t,e,n){n.d(e,{di:function(){return i},Sj:function(){return o}});var i="tickets.update",o=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var n in c(this,t),e)this[n]=e[n]}},4075:function(t,e,n){n.d(e,{$:function(){return m}});var i=n(37716),o=n(3679),a=n(54395),r=n(87519),s=n(33935),u=n(69958),d=n(20082),p=n(35718),g=n(76627),f=n(38583);function h(t,e){if(1&t){var n=i.EpF();i.TgZ(0,"button",7),i.NdJ("click",function(){var t=i.CHM(n).$implicit;return i.oxw().addTag(t.name)}),i._uU(1),i.qZA()}if(2&t){var o=e.$implicit;i.xp6(1),i.Oqu(o.name)}}var v,m=((v=function(){function t(e,n,a){c(this,t),this.tickets=e,this.tagService=n,this.toast=a,this.ticketIds=[],this.tagAdded=new i.vpe,this.tagQuery=new o.NI,this.searchedOnce=!1,this.trackByFn=function(t,e){return e.id}}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.bindTagQueryInput(),this.trigger.menuOpened.subscribe(function(){t.searchedOnce||t.searchForTags(null,{perPage:5})}),this.trigger.menuClosed.subscribe(function(){t.clearSearchField()})}},{key:"open",value:function(){this.trigger.openMenu()}},{key:"close",value:function(){this.trigger.closeMenu()}},{key:"addTag",value:function(t){var e=this;this.tickets.addTag(t,this.ticketIds).subscribe(function(t){e.clearSearchField(),e.toast.open("Tag added"),e.tagAdded.emit(t.data),e.close()})}},{key:"clearSearchField",value:function(){!this.tagQuery.value||this.tagQuery.setValue(null)}},{key:"bindTagQueryInput",value:function(){var t=this;this.tagQuery.valueChanges.pipe((0,a.b)(300),(0,r.x)()).subscribe(function(e){t.searchForTags(e)})}},{key:"searchForTags",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.tagService.search(t,n).subscribe(function(t){return e.tags=t.pagination.data})}}]),t}()).\u0275fac=function(t){return new(t||v)(i.Y36(u.g),i.Y36(d.c),i.Y36(p.F))},v.\u0275cmp=i.Xpm({type:v,selectors:[["add-tag-dropdown"]],viewQuery:function(t,e){var n;1&t&&i.Gf(s.p6,7),2&t&&i.iGM(n=i.CRH())&&(e.trigger=n.first)},inputs:{ticketIds:"ticketIds"},outputs:{tagAdded:"tagAdded"},decls:7,vars:5,consts:[[1,"no-style","add-tag-button","toolbar-item",3,"matMenuTriggerFor"],["svgIcon","add-tag-custom"],[1,"add-tag-menu",3,"overlapTrigger"],["addTagMenu","matMenu"],[1,"input-container",3,"ngSubmit","click"],["type","text","mat-menu-item","",1,"tag-search-input",3,"formControl"],["mat-menu-item","","class","tag-item",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["mat-menu-item","",1,"tag-item",3,"click"]],template:function(t,e){if(1&t&&(i.TgZ(0,"button",0),i._UZ(1,"mat-icon",1),i.qZA(),i.TgZ(2,"mat-menu",2,3),i.TgZ(4,"form",4),i.NdJ("ngSubmit",function(){return e.addTag(e.tagQuery.value)})("click",function(t){return t.stopPropagation()}),i._UZ(5,"input",5),i.qZA(),i.YNc(6,h,2,1,"button",6),i.qZA()),2&t){var n=i.MAs(3);i.Q6J("matMenuTriggerFor",n),i.xp6(2),i.Q6J("overlapTrigger",!1),i.xp6(3),i.Q6J("formControl",e.tagQuery),i.xp6(1),i.Q6J("ngForOf",e.tags)("ngForTrackBy",e.trackByFn)}},directives:[s.p6,g.Hw,s.VK,o._Y,o.JL,o.F,o.Fj,s.OP,o.JJ,o.oH,f.sg],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.input-container[_ngcontent-%COMP%]{padding:2px 10px 10px}.mat-menu-item[_ngcontent-%COMP%]:first-of-type{border-top:1px solid var(--be-divider-default)}"]}),v)},44625:function(t,e,n){n.d(e,{H:function(){return b}});var i=n(37716),o=n(76590),a=n(33935),r=n(15257),s=n(73429),u=n(24688),d=n(69958),p=n(35718),g=n(76627),f=n(15515),h=n(38583);function v(t,e){if(1&t){var n=i.EpF();i.TgZ(0,"button",7),i.NdJ("click",function(){var t=i.CHM(n).$implicit;return i.oxw().assignTicketsTo(t.id)}),i._uU(1),i.qZA()}if(2&t){var o=e.$implicit,a=i.oxw();i.ekj("active",a.ticket&&a.ticket.assigned_to==o.id),i.xp6(1),i.hij(" ",o.display_name," ")}}var m,b=((m=function(){function t(e,n,o,a){c(this,t),this.users=e,this.currentUser=n,this.tickets=o,this.toast=a,this.agents=[],this.assigned=new i.vpe}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.trigger.menuOpened.pipe((0,r.q)(1)).subscribe(function(){t.fetchAgents()})}},{key:"open",value:function(){this.trigger.openMenu()}},{key:"close",value:function(){this.trigger.closeMenu()}},{key:"assignTicketsTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tickets.assign(this.ticketIds?this.ticketIds:[this.ticket.id],e).subscribe(function(){t.ticket&&(t.ticket.assigned_to=e),t.toast.open("Tickets assigned"),t.assigned.emit()})}},{key:"fetchAgents",value:function(){var t=this;this.users.getAll({permission:o.di,perPage:35}).subscribe(function(e){t.agents=e.filter(function(e){return e.id!==t.currentUser.get("id")})})}}]),t}()).\u0275fac=function(t){return new(t||m)(i.Y36(s.Q),i.Y36(u.I),i.Y36(d.g),i.Y36(p.F))},m.\u0275cmp=i.Xpm({type:m,selectors:[["assign-ticket-dropdown"]],viewQuery:function(t,e){var n;1&t&&i.Gf(a.p6,7),2&t&&i.iGM(n=i.CRH())&&(e.trigger=n.first)},inputs:{ticket:"ticket",ticketIds:"ticketIds"},outputs:{assigned:"assigned"},decls:9,vars:7,consts:[[1,"no-style","toolbar-item",3,"matMenuTriggerFor"],["svgIcon","user-custom"],[1,"assign-ticket-menu",3,"overlapTrigger"],["assignTicketMenu","matMenu"],["mat-menu-item","","trans","",1,"anyone-item",3,"click"],["mat-menu-item","","trans","",1,"me-item",3,"click"],["mat-menu-item","","class","agent-item",3,"active","click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"agent-item",3,"click"]],template:function(t,e){if(1&t&&(i.TgZ(0,"button",0),i._UZ(1,"mat-icon",1),i.qZA(),i.TgZ(2,"mat-menu",2,3),i.TgZ(4,"button",4),i.NdJ("click",function(){return e.assignTicketsTo()}),i._uU(5," Anyone "),i.qZA(),i.TgZ(6,"button",5),i.NdJ("click",function(){return e.assignTicketsTo(e.currentUser.get("id"))}),i._uU(7," Me "),i.qZA(),i.YNc(8,v,2,3,"button",6),i.qZA()),2&t){var n=i.MAs(3);i.Q6J("matMenuTriggerFor",n),i.xp6(2),i.Q6J("overlapTrigger",!1),i.xp6(2),i.ekj("active",e.ticket&&!e.ticket.assigned_to),i.xp6(2),i.ekj("active",e.ticket&&e.ticket.assigned_to===e.currentUser.get("id")),i.xp6(2),i.Q6J("ngForOf",e.agents)}},directives:[a.p6,g.Hw,a.VK,a.OP,f.P,h.sg],styles:["assign-ticket-dropdown{position:relative;display:inline-block}.assign-ticket-menu.mat-menu-panel{max-height:500px}.assign-ticket-menu.mat-menu-panel .mat-menu-item.active{background-color:var(--be-hover)}\n"],encapsulation:2}),m)},87291:function(t,e,n){n.d(e,{N:function(){return u}});var i,o=n(26215),a=n(68939),r=n(37716),s=n(90299),u=((i=function(){function t(e){c(this,t),this.httpClient=e,this.allTags$=new o.X([]),this.categoryTags=[],this.statusTags=[],this.activeTagId$=new o.X(null),this.loading$=new o.X(!1),this.allTags$.value.length||this.refresh()}return l(t,[{key:"setTags",value:function(t){!t||(this.statusTags=t.filter(function(t){return"status"===t.type}),this.categoryTags=t.filter(function(t){return"category"===t.type}),this.viewTags=t.filter(function(t){return"view"===t.type}),this.allTags$.next(t))}},{key:"refresh",value:function(){var t=this;this.loading$.next(!0),this.httpClient.get("tags/agent-mailbox").pipe((0,a.x)(function(){return t.loading$.next(!1)})).subscribe(function(e){t.setTags(e.tags)})}},{key:"setActiveTag",value:function(t){this.activeTagId$.next(t||"unassigned")}},{key:"getTagByIdOrName",value:function(t){return this.allTags$.value.find(function(e){return e.id===+t||e.name===t})}}]),t}()).\u0275fac=function(t){return new(t||i)(r.LFG(s.r))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i)}}])}();