"use strict";(self.webpackChunkbedesk=self.webpackChunkbedesk||[]).push([[574],{5970:function(t,e,i){i.d(e,{G:function(){return d}});var n=i(37716),s=i(24668),o=i(35718),a=i(69958),r=i(34673),c=i(87291),l=i(90962);let d=(()=>{class t{constructor(t,e,i,n,s,o){this.router=t,this.toast=e,this.tickets=i,this.settings=n,this.mailboxTags=s,this.localStorage=o,this.defaultAction=this.settings.get("replies.after_reply_action","next_active_ticket")}perform(){if(this.router.url.indexOf("help-center")>-1)this.navigateToCustomerTicketsList();else{switch(this.get()){case"next_active_ticket":this.navigateToNextActiveTicket();break;case"back_to_folder":this.navigateToAgentTicketsList()}this.mailboxTags.refresh()}}get(){return this.localStorage.get("after_reply_action",this.defaultAction)}set(t=null){this.defaultAction=t,this.localStorage.set("after_reply_action",t)}setTicketId(t){this.activeTicketId=t}navigateToNextActiveTicket(){const t=this.mailboxTags.activeTagId$.value;this.tickets.nextActiveTicket(t).subscribe(e=>{e.ticket&&e.ticket.id!==this.activeTicketId?this.router.navigate(["/mailbox/tickets/",e.ticket.id],{queryParams:{tagId:t}}):this.navigateToAgentTicketsList()})}navigateToAgentTicketsList(){this.router.navigate(["/mailbox/tickets"],{queryParams:{tagId:this.mailboxTags.activeTagId$.value}})}navigateToCustomerTicketsList(t){this.router.navigate(["/help-center/tickets"]),this.toast.open(t||"Your reply was submitted successfully.")}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(s.F0),n.LFG(o.F),n.LFG(a.g),n.LFG(r.Z),n.LFG(c.N),n.LFG(l.m))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},38433:function(t,e,i){i.d(e,{y:function(){return d}});var n=i(22238),s=i(37716),o=i(34673),a=i(15515),r=i(51095),c=i(76627),l=i(63297);let d=(()=>{class t{constructor(t,e,i){this.dialogRef=t,this.data=e,this.settings=i,this.type=this.getDisplayType(e.reply.type)}close(t=!1){this.dialogRef.close(t)}confirm(){this.close(!0)}getDisplayType(t){switch(t){case"replies":return"reply";case"notes":return"note";case"drafts":return"draft"}}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(n.so),s.Y36(n.WI),s.Y36(o.Z))},t.\u0275cmp=s.Xpm({type:t,selectors:[["confirm-reply-delete-modal"]],decls:18,vars:5,consts:[[1,"modal-header",2,"margin","0"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["trans",""],["mat-button","","type","button","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","trans","",1,"submit-button",3,"color","click"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"h2",1),s._uU(2),s.qZA(),s.TgZ(3,"button",2),s.NdJ("click",function(){return e.close()}),s._UZ(4,"mat-icon",3),s.qZA(),s.qZA(),s.TgZ(5,"mat-dialog-content"),s.TgZ(6,"p"),s.TgZ(7,"span",4),s._uU(8,"Are you sure you want to delete this"),s.qZA(),s._uU(9," "),s.TgZ(10,"span"),s._uU(11),s.ALo(12,"trans"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(13,"mat-dialog-actions"),s.TgZ(14,"button",5),s.NdJ("click",function(){return e.close()}),s._uU(15,"Close"),s.qZA(),s.TgZ(16,"button",6),s.NdJ("click",function(){return e.confirm()}),s._uU(17,"Delete"),s.qZA(),s.qZA()),2&t&&(s.xp6(2),s.hij("Delete ",e.type,""),s.xp6(9),s.hij("",s.lcZ(12,3,e.type),"?"),s.xp6(5),s.Q6J("color",e.settings.get("vebto.auth.color")))},directives:[n.uh,a.P,r.lW,c.Hw,n.xY,n.H8],pipes:[l.R],encapsulation:2}),t})()},30587:function(t,e,i){i.d(e,{M:function(){return v}});var n=i(37716),s=i(69958),o=i(24688),a=i(87291),r=i(66010),c=i(58341),l=i(38583),d=i(76627),u=i(11436),p=i(63297);function g(t,e){1&t&&n._UZ(0,"mat-icon",12)}function h(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"mat-chip",10),n.NdJ("removed",function(){n.CHM(t);const e=n.oxw().$implicit;return n.oxw().removeTag(e)}),n._uU(1),n.YNc(2,g,1,0,"mat-icon",11),n.qZA()}if(2&t){const t=n.oxw().$implicit,e=n.oxw();n.Q6J("removable",e.currentUser.hasPermission("tickets.update")),n.xp6(1),n.hij(" ",t.display_name," "),n.xp6(1),n.Q6J("ngIf",e.currentUser.hasPermission("tickets.update"))}}function m(t,e){if(1&t&&(n.ynx(0),n.YNc(1,h,3,3,"mat-chip",9),n.BQk()),2&t){const t=e.$implicit;n.xp6(1),n.Q6J("ngIf","status"!==t.type)}}function f(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"button",13),n.NdJ("click",function(){return n.CHM(t),n.oxw().conversation.openEditor()}),n.ALo(1,"trans"),n._UZ(2,"mat-icon",14),n.qZA()}2&t&&n.Q6J("matTooltip",n.lcZ(1,1,"Reply (r)"))}let v=(()=>{class t{constructor(t,e,i,n){this.tickets=t,this.currentUser=e,this.mailboxTags=i,this.conversation=n}removeTag(t){this.tickets.removeTag(t,[this.conversation.get().id]).subscribe(()=>{this.conversation.get().tags=this.conversation.get().tags.filter(e=>e.id!==t.id),this.mailboxTags.refresh()})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.g),n.Y36(o.I),n.Y36(a.N),n.Y36(r.r))},t.\u0275cmp=n.Xpm({type:t,selectors:[["conversation-header"]],decls:11,vars:6,consts:[[1,"title-container"],[1,"ticket-subject"],[1,"tags"],[3,"selectable"],[4,"ngFor","ngForOf"],[1,"title-meta"],[1,"ticket-created-at-date"],[1,"actions"],["class","button reply-button",3,"matTooltip","click",4,"ngIf"],["class","mat-compact-chip",3,"removable","removed",4,"ngIf"],[1,"mat-compact-chip",3,"removable","removed"],["matChipRemove","","svgIcon","cancel",4,"ngIf"],["matChipRemove","","svgIcon","cancel"],[1,"button","reply-button",3,"matTooltip","click"],["svgIcon","reply"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"h2",1),n._uU(2),n.qZA(),n.TgZ(3,"div",2),n.TgZ(4,"mat-chip-list",3),n.YNc(5,m,2,1,"ng-container",4),n.qZA(),n.qZA(),n.qZA(),n.TgZ(6,"div",5),n.TgZ(7,"div",6),n._uU(8),n.qZA(),n.TgZ(9,"div",7),n.YNc(10,f,3,3,"button",8),n.qZA(),n.qZA()),2&t&&(n.xp6(2),n.Oqu(e.conversation.get().subject),n.xp6(2),n.Q6J("selectable",!1),n.xp6(1),n.Q6J("ngForOf",e.conversation.model.tags),n.xp6(3),n.AsE(" ",e.conversation.get().created_at_formatted," (",e.conversation.get().created_at_month,") "),n.xp6(2),n.Q6J("ngIf","locked"!==e.conversation.status.name))},directives:[c.qn,l.sg,l.O5,c.HS,d.Hw,c.qH,u.gM],pipes:[p.R],styles:["conversation-header{display:flex;align-items:center;flex:none;width:100%}conversation-header .title-container{flex:1 1 auto;display:flex;flex-wrap:wrap;align-items:center;padding:5px 10px 5px 25px;margin:15px 0}conversation-header .title-container h2{color:var(--be-help-center-title-text);font-weight:400;font-size:2.5rem;margin:0 15px 0 0}conversation-header .title-container .tags{display:inline-block}conversation-header .title-container .tags .tag-name{display:inline-block;max-width:50px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;vertical-align:sub}conversation-header .title-meta{flex:0 0 100px;white-space:nowrap;font-size:1.6rem;color:var(--be-secondary-text);text-align:right;padding-right:26px}conversation-header .title-meta .ticket-created-at-date,conversation-header .title-meta .actions{display:inline-block;vertical-align:middle}conversation-header .title-meta .reply-button{min-width:0;border:1px solid var(--be-divider-default);border-radius:4px;color:var(--be-secondary-text);margin-left:10px;padding:5px 12px 6px;background-color:var(--be-background-alternative);cursor:pointer}conversation-header .title-meta .reply-button mat-icon{width:19px;height:19px}@media only screen and (max-width: 768px){conversation-header{margin-bottom:15px}conversation-header .title-meta .ticket-created-at-date{display:none}}\n"],encapsulation:2}),t})()},74180:function(t,e,i){i.d(e,{D:function(){return m}});var n=i(66010),s=i(69958),o=i(6350),a=i(35177),r=i(5970),c=i(8208),l=i(22238),d=i(37716),u=i(15381),p=i(87291),g=i(24668);function h(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"button",4),d.NdJ("click",function(){return d.CHM(t),d.oxw().mergeTickets()}),d._uU(1,"Merge"),d.qZA()}}let m=(()=>{class t{constructor(t,e,i,n,s,o,a){this.dialogRef=t,this.data=e,this.tickets=i,this.modal=n,this.conversation=s,this.tags=o,this.router=a,this.hydrate()}close(t){this.dialogRef.close(t)}openTicket(){this.modal.closeAll(),this.router.navigate(["/mailbox/tickets",this.conversation.get().id],{queryParams:{tagId:this.conversation.getStatus().id}})}mergeTickets(){this.modal.show(c.z,{title:"Merge Tickets",body:"Are you sure you want merge this ticket with the original one behind the pop-ups?",bodyBold:"Merged tickets can not be unmerged.",ok:"Merge"}).afterClosed().subscribe(t=>{!t||this.tickets.merge(this.activeTicketId,this.conversation.get().id).subscribe(t=>{this.close(t.ticket),this.tags.refresh()})})}hydrate(){this.activeTicketId=this.data.activeTicketId,this.tickets.get(this.data.ticketId).subscribe(t=>{this.conversation.init(t.ticket)})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(l.so),d.Y36(l.WI),d.Y36(s.g),d.Y36(u.u),d.Y36(n.r),d.Y36(p.N),d.Y36(g.F0))},t.\u0275cmp=d.Xpm({type:t,selectors:[["conversation-modal"]],features:[d._Bn([s.g,n.r,o.n,a.I,r.G])],decls:5,vars:3,consts:[[3,"hideSidebar","hideBackButton"],["toolbar-content","",1,"no-style","icon-button","action",3,"click"],["svgIcon","open-in-browser-custom"],["class","merge-button","mat-raised-button","","color","accent","trans","",3,"click",4,"ngIf"],["mat-raised-button","","color","accent","trans","",1,"merge-button",3,"click"]],template:function(t,e){1&t&&(d.TgZ(0,"mat-dialog-content"),d.TgZ(1,"conversation",0),d.TgZ(2,"button",1),d.NdJ("click",function(){return e.openTicket()}),d._UZ(3,"mat-icon",2),d.qZA(),d.qZA(),d.YNc(4,h,2,0,"button",3),d.qZA()),2&t&&(d.xp6(1),d.Q6J("hideSidebar",!0)("hideBackButton",!0),d.xp6(3),d.Q6J("ngIf",e.activeTicketId))},styles:[".conversation-modal-container{width:80%;height:calc(100% - 50px)}.conversation-modal-container conversation-modal,.conversation-modal-container .mat-dialog-content,.conversation-modal-container .mat-dialog-container{height:100%;max-height:100%;margin:0;padding:0}.conversation-modal-container .merge-button{position:absolute;top:10px;left:300px}\n"],encapsulation:2}),t})()},35177:function(t,e,i){i.d(e,{I:function(){return a}});var n=i(37716),s=i(69958),o=i(35718);let a=(()=>{class t{constructor(t,e){this.tickets=t,this.toast=e,this.replies=[],this.currentPage=1,this.lastPage=2,this.isLoading=!1}get(){return this.replies}add(t){!t||!t.id||this.replies.find(e=>e.id===t.id)||this.replies.unshift(t)}replace(t){const e=this.replies.findIndex(e=>e.id===t.id);this.replies[e]=t}remove(t){this.replies=this.replies.filter(e=>e.id!==t)}delete(t){this.tickets.deleteReply(t.id).subscribe(()=>{this.remove(t.id),this.toast.open("Deleted successfully")})}loadMore(){this.isLoading||(this.isLoading=!0,this.tickets.getTicketReplies(this.ticketId,this.currentPage+1).subscribe(t=>{this.replies=this.replies.concat(t.pagination.data),this.currentPage=t.pagination.current_page,this.lastPage=t.pagination.last_page,this.isLoading=!1},()=>{this.isLoading=!1}))}canLoadMore(){return this.currentPage<this.lastPage}init(t,e){this.replies=t.slice(),this.currentPage=1,this.lastPage=2,this.ticketId=e}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(s.g),n.LFG(o.F))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},61693:function(t,e,i){i.d(e,{Q:function(){return H}});var n=i(22238),s=i(37716),o=i(15515),a=i(51095),r=i(76627),c=i(38583);function l(t,e){if(1&t&&(s.TgZ(0,"div",11),s.TgZ(1,"div",12),s._uU(2),s.qZA(),s.TgZ(3,"div",13),s._uU(4),s.qZA(),s.qZA()),2&t){const t=e.$implicit,i=s.oxw();s.xp6(2),s.Oqu(t),s.xp6(2),s.Oqu(i.originalEmail.headers[t])}}function d(t,e){1&t&&(s.TgZ(0,"span",14),s._uU(1,"Could not find original email for this reply."),s.qZA())}function u(t,e){if(1&t&&(s.TgZ(0,"pre",15),s._uU(1),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Oqu(t.originalEmail.body.plain)}}function p(t,e){if(1&t&&(s.TgZ(0,"pre",16),s._uU(1),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Oqu(t.originalEmail.body.html)}}let g=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e,this.headerNames=[],this.hydrate()}close(){this.dialogRef.close()}hydrate(){this.originalEmail=this.data.original,this.originalEmail&&this.originalEmail.headers&&(this.headerNames=Object.keys(this.originalEmail.headers))}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(n.so),s.Y36(n.WI))},t.\u0275cmp=s.Xpm({type:t,selectors:[["show-original-reply-modal"]],decls:15,vars:4,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],[1,"headers"],["class","header",4,"ngFor","ngForOf"],[1,"email-content"],["trans","",4,"ngIf"],["class","body-plain",4,"ngIf"],["class","body-html",4,"ngIf"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"click"],[1,"header"],[1,"name"],[1,"value"],["trans",""],[1,"body-plain"],[1,"body-html"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"h2",1),s._uU(2,"Original Message"),s.qZA(),s.TgZ(3,"button",2),s.NdJ("click",function(){return e.close()}),s._UZ(4,"mat-icon",3),s.qZA(),s.qZA(),s.TgZ(5,"mat-dialog-content"),s.TgZ(6,"div",4),s.YNc(7,l,5,2,"div",5),s.qZA(),s.TgZ(8,"div",6),s.YNc(9,d,2,0,"span",7),s.YNc(10,u,2,1,"pre",8),s.YNc(11,p,2,1,"pre",9),s.qZA(),s.qZA(),s.TgZ(12,"mat-dialog-actions"),s.TgZ(13,"button",10),s.NdJ("click",function(){return e.close()}),s._uU(14,"Done"),s.qZA(),s.qZA()),2&t&&(s.xp6(7),s.Q6J("ngForOf",e.headerNames),s.xp6(2),s.Q6J("ngIf",!e.originalEmail),s.xp6(1),s.Q6J("ngIf",e.originalEmail&&e.originalEmail.body.plain),s.xp6(1),s.Q6J("ngIf",e.originalEmail&&e.originalEmail.body.html))},directives:[n.uh,o.P,a.lW,r.Hw,n.xY,c.sg,c.O5,n.H8],styles:['.show-original-reply-modal-container{width:90%;height:90%}.show-original-reply-modal-container .mat-dialog-title{margin-bottom:25px}.show-original-reply-modal-container .mat-dialog-content{max-height:none}.show-original-reply-modal-container .headers{border:1px solid var(--be-divider-default)}.show-original-reply-modal-container .headers>.header{display:flex;padding:10px;border-bottom:1px solid var(--be-divider-default)}.show-original-reply-modal-container .headers>.header>.name{flex:1 1 30%;font-weight:500;max-width:200px}.show-original-reply-modal-container .headers>.header>.value{flex:1 1 65%;margin-left:auto}.show-original-reply-modal-container .email-content{margin-top:40px}.show-original-reply-modal-container .email-content>pre{font-size:1.4rem;font-family:Roboto,"Helvetica Neue",sans-serif;word-wrap:break-word;white-space:pre-wrap}.show-original-reply-modal-container .email-content>.body-plain{margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--be-divider-default)}\n'],encapsulation:2,changeDetection:0}),t})();var h=i(82192),m=i(9141),f=i(69958),v=i(48350),b=i(91241);function x(t,e){if(1&t&&(s.TgZ(0,"div",11),s._uU(1),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Oqu(t.errors.body)}}function y(t,e){if(1&t&&(s.TgZ(0,"div",11),s._uU(1),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Oqu(t.errors.attachments)}}function Z(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"reply-attachment-list",12),s.NdJ("detached",function(e){return s.CHM(t),s.oxw().removeAttachment(e)}),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("attachments",t.attachments)}}let k=(()=>{class t{constructor(t,e,i,n){this.dialogRef=t,this.data=e,this.tickets=i,this.uploadQueue=n,this.attachments=[],this.errors={},this.hydrate()}ngAfterViewInit(){this.textEditor.focus(),this.textEditor.setContents(this.reply.body)}hydrate(){this.reply=Object.assign({},this.data.reply),this.attachments=this.reply.uploads.slice()}close(t){this.dialogRef.close(t),this.textEditor.destroyEditor()}confirm(){const t={body:this.textEditor.getContents(),uploads:this.attachments.map(t=>t.id)};this.tickets.updateReply(this.reply.id,t).subscribe(t=>{this.close(t.reply)},t=>this.errors=t.errors)}uploadFiles(t){this.uploadQueue.start(t).subscribe(t=>{this.attachments=[...this.attachments,t.fileEntry]})}removeAttachment(t){for(let e=0;e<this.attachments.length;e++)this.attachments[e].id===t.id&&this.attachments.splice(e,1)}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(n.so),s.Y36(n.WI),s.Y36(f.g),s.Y36(m.A))},t.\u0275cmp=s.Xpm({type:t,selectors:[["update-reply-modal"]],viewQuery:function(t,e){if(1&t&&s.Gf(h.d,7),2&t){let t;s.iGM(t=s.CRH())&&(e.textEditor=t.first)}},features:[s._Bn([m.A])],decls:17,vars:4,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],[1,"many-inputs"],[1,"input-container"],["inlineUploadPrefix","ticket_images",3,"minHeight","onFileUpload"],["class","error",4,"ngIf"],[3,"attachments","detached",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"click"],[1,"error"],[3,"attachments","detached"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"h2",1),s._uU(2,"Update Reply"),s.qZA(),s.TgZ(3,"button",2),s.NdJ("click",function(){return e.close()}),s._UZ(4,"mat-icon",3),s.qZA(),s.qZA(),s.TgZ(5,"mat-dialog-content",4),s.TgZ(6,"div",5),s.TgZ(7,"text-editor",6),s.NdJ("onFileUpload",function(t){return e.uploadFiles(t)}),s.qZA(),s._UZ(8,"upload-progress-bar"),s.YNc(9,x,2,1,"div",7),s.YNc(10,y,2,1,"div",7),s.YNc(11,Z,1,1,"reply-attachment-list",8),s.qZA(),s.qZA(),s.TgZ(12,"mat-dialog-actions"),s.TgZ(13,"button",9),s.NdJ("click",function(){return e.close()}),s._uU(14,"Cancel"),s.qZA(),s.TgZ(15,"button",10),s.NdJ("click",function(){return e.confirm()}),s._uU(16,"Update"),s.qZA(),s.qZA()),2&t&&(s.xp6(7),s.Q6J("minHeight",300),s.xp6(2),s.Q6J("ngIf",e.errors.body),s.xp6(1),s.Q6J("ngIf",e.errors.attachments),s.xp6(1),s.Q6J("ngIf",e.attachments.length))},directives:[n.uh,o.P,a.lW,r.Hw,n.xY,h.d,v.o,c.O5,n.H8,b.G],styles:[".update-reply-modal-container{width:600px}.update-reply-modal-container reply-attachment-list{margin-top:15px}\n"],encapsulation:2}),t})();var T=i(38433),w=i(64278),A=(i(1011),i(27119),i(71209),i(98556),i(14714),i(15381)),q=i(24688),_=i(66010),I=i(3093),J=i(24668),U=i(33935);function C(t,e){if(1&t&&s._UZ(0,"img",22),2&t){const t=s.oxw(2).$implicit;s.s9C("src",t.user.avatar,s.LSH),s.s9C("alt",t.user.email)}}function Q(t,e){1&t&&(s.TgZ(0,"span",23),s._uU(1,"You"),s.qZA())}function O(t,e){if(1&t&&(s.TgZ(0,"span"),s._uU(1),s.qZA()),2&t){const t=s.oxw(2).$implicit;s.xp6(1),s.Oqu(t.user.display_name)}}function Y(t,e){1&t&&(s.TgZ(0,"span",24),s._uU(1,"replied"),s.qZA())}function M(t,e){1&t&&(s.TgZ(0,"span",24),s._uU(1,"started the conversation"),s.qZA())}function N(t,e){1&t&&(s.TgZ(0,"span",24),s._uU(1,"left a note"),s.qZA())}function F(t,e){1&t&&(s.TgZ(0,"span",24),s._uU(1,"created a draft"),s.qZA())}function S(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"span",25),s.TgZ(1,"button",26),s.NdJ("click",function(){s.CHM(t);const e=s.oxw(2).$implicit;return s.oxw().editDraft(e)}),s._uU(2," Edit "),s.qZA(),s.TgZ(3,"button",27),s.NdJ("click",function(){s.CHM(t);const e=s.oxw(2).$implicit;return s.oxw().maybeDeleteReply(e)}),s._uU(4," Discard "),s.qZA(),s.qZA()}}function P(t,e){if(1&t&&(s.ynx(0),s.TgZ(1,"button",28),s._UZ(2,"mat-icon",29),s.qZA(),s.BQk()),2&t){s.oxw();const t=s.MAs(19);s.xp6(1),s.Q6J("matMenuTriggerFor",t)}}function E(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"reply-attachment-list",30),s.NdJ("detached",function(e){s.CHM(t);const i=s.oxw(2).$implicit;return s.oxw().removeAttachment(i,e)}),s.qZA()}if(2&t){const t=s.oxw(2).$implicit;s.Q6J("attachments",t.uploads)}}function R(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"div",3),s.YNc(1,C,1,2,"img",4),s.TgZ(2,"div",5),s.TgZ(3,"div",6),s.TgZ(4,"div",7),s.TgZ(5,"span",8),s.YNc(6,Q,2,0,"span",9),s.YNc(7,O,2,1,"span",10),s.qZA(),s._uU(8," "),s.YNc(9,Y,2,0,"span",11),s.YNc(10,M,2,0,"span",11),s.YNc(11,N,2,0,"span",11),s.YNc(12,F,2,0,"span",11),s.YNc(13,S,5,0,"span",12),s.qZA(),s.TgZ(14,"div",13),s.TgZ(15,"span",14),s._uU(16),s.qZA(),s.YNc(17,P,3,1,"ng-container",10),s.TgZ(18,"mat-menu",15,16),s.TgZ(20,"div",17),s.NdJ("click",function(){s.CHM(t);const e=s.oxw().$implicit;return s.oxw().update(e)}),s._uU(21," Edit "),s.qZA(),s.TgZ(22,"div",18),s.NdJ("click",function(){s.CHM(t);const e=s.oxw().$implicit;return s.oxw().maybeDeleteReply(e)}),s._uU(23," Delete "),s.qZA(),s.TgZ(24,"div",19),s.NdJ("click",function(){s.CHM(t);const e=s.oxw().$implicit;return s.oxw().showOriginalEmail(e)}),s._uU(25," Show Original "),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s._UZ(26,"div",20),s.YNc(27,E,1,1,"reply-attachment-list",21),s.qZA(),s.qZA()}if(2&t){const t=s.oxw(),e=t.$implicit,i=t.last,n=s.oxw();s.ekj("bounce",e.animated)("my-reply",e.user_id==n.currentUser.get("id")),s.s9C("ngClass",e.type),s.uIk("data-reply-id",e.id),s.xp6(1),s.Q6J("ngIf",e.user.avatar),s.xp6(5),s.Q6J("ngIf",n.currentUser.get("id")==e.user.id),s.xp6(1),s.Q6J("ngIf",n.currentUser.get("id")!=e.user.id),s.xp6(2),s.Q6J("ngIf",!i&&"replies"===e.type),s.xp6(1),s.Q6J("ngIf",i&&"replies"===e.type),s.xp6(1),s.Q6J("ngIf","notes"==e.type),s.xp6(1),s.Q6J("ngIf","drafts"==e.type),s.xp6(1),s.Q6J("ngIf","drafts"===e.type),s.xp6(3),s.Oqu(e.created_at_formatted),s.xp6(1),s.Q6J("ngIf",n.currentUser.hasPermission("replies.update")&&"drafts"!==e.type),s.xp6(9),s.Q6J("innerHTML",e.body,s.oJD),s.xp6(1),s.Q6J("ngIf",e.uploads.length)}}function L(t,e){if(1&t&&s.YNc(0,R,28,18,"div",2),2&t){const t=e.$implicit,i=s.oxw();s.Q6J("ngIf",i.currentUser.hasPermission("tickets.update")||"notes"!==t.type)}}let H=(()=>{class t{constructor(t,e,i,n,s,o,a){this.modal=t,this.currentUser=e,this.tickets=i,this.conversation=n,this.backendEvents=s,this.route=o,this.el=a}ngOnInit(){this.subscription=this.backendEvents.ticketReplyCreated.subscribe(t=>{this.conversation.get().id===t.ticket_id&&(t.animated=!0,this.conversation.replies.add(t))})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}ngAfterViewInit(){w&&w.highlightAll();const t=this.route.snapshot.queryParams.replyId;t&&this.el.nativeElement.querySelector(`[data-reply-id-${t}}]`).scrollIntoView({behavior:"smooth"})}update(t){this.modal.open(k,{reply:t},{panelClass:"update-reply-modal-container"}).afterClosed().subscribe(t=>{!t||this.conversation.replies.replace(t)})}maybeDeleteReply(t){this.modal.show(T.y,{reply:t}).afterClosed().subscribe(e=>{!e||this.conversation.replies.delete(t)})}editDraft(t){this.conversation.setDraft(t),this.conversation.openEditor(),this.conversation.replies.remove(t.id)}showOriginalEmail(t){const e="show-original-reply-modal-container";this.tickets.getOriginalEmailForReply(t.id).subscribe(t=>{this.modal.open(g,{original:t.email},{panelClass:e})},()=>{this.modal.open(g,null,{panelClass:e})})}removeAttachment(t,e){t.uploads=t.uploads.filter(t=>t.id!==e.id),this.tickets.updateReply(t.id,{uploads:t.uploads.map(t=>t.id)}).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(A.u),s.Y36(q.I),s.Y36(f.g),s.Y36(_.r),s.Y36(I.O),s.Y36(J.gz),s.Y36(s.SBq))},t.\u0275cmp=s.Xpm({type:t,selectors:[["conversation-replies"]],inputs:{textEditor:"textEditor"},decls:2,vars:1,consts:[[1,"thread"],["ngFor","",3,"ngForOf"],["class","reply animated",3,"bounce","ngClass","my-reply",4,"ngIf"],[1,"reply","animated",3,"ngClass"],["class","user-avatar",3,"src","alt",4,"ngIf"],[1,"reply-body"],[1,"message-header"],[1,"customer"],[1,"customer-name"],["trans","",4,"ngIf"],[4,"ngIf"],["class","text-gray action-text","trans","",4,"ngIf"],["class","draft-actions",4,"ngIf"],[1,"meta"],[1,"date"],[1,"reply-actions-menu"],["replyActionsMenu","matMenu"],["mat-menu-item","","trans","",1,"update-reply-button",3,"click"],["mat-menu-item","","trans","",1,"delete-reply-button",3,"click"],["mat-menu-item","","trans","",1,"show-original-reply-button",3,"click"],[1,"message-body",3,"innerHTML"],[3,"attachments","detached",4,"ngIf"],[1,"user-avatar",3,"src","alt"],["trans",""],["trans","",1,"text-gray","action-text"],[1,"draft-actions"],["type","button","trans","",1,"no-style","edit-draft-button",3,"click"],["type","button","trans","",1,"no-style","delete-draft-button",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","more-vert"],[3,"attachments","detached"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.YNc(1,L,1,1,"ng-template",1),s.qZA()),2&t&&(s.xp6(1),s.Q6J("ngForOf",e.conversation.replies.get()))},directives:[c.sg,c.O5,c.mk,U.VK,U.OP,o.P,a.lW,U.p6,r.Hw,b.G],styles:["conversation-replies{display:block;width:100%}conversation-replies .reply{display:flex;padding:25px;border-top:1px solid var(--be-divider-default)}conversation-replies .reply.notes{background-color:#fffcea;color:#836f60;border-left:3px solid #c8bcb4}conversation-replies .reply.drafts{border-left:3px solid var(--be-accent-default)}conversation-replies .reply.drafts .customer .text-gray{color:var(--be-accent-default)}conversation-replies .reply:last-of-type{border-bottom:1px solid var(--be-divider-default)}conversation-replies .reply .user-avatar{flex:0 0 50px;display:block;width:50px;height:50px;margin-right:20px;-o-object-fit:cover;object-fit:cover;border-radius:4px}conversation-replies .reply .reply-body{flex:1 1 auto;max-width:calc(100% - 70px)}conversation-replies .reply reply-attachment-list{border-top:1px dotted var(--be-divider-default);margin:20px 0 0;padding-top:20px;display:inline-flex}conversation-replies .reply reply-attachment-list>.attachments-list-item:last-of-type{margin-right:0}conversation-replies .message-header{font-size:1.65rem;margin-bottom:15px;display:flex}conversation-replies .message-header .customer{flex:1 1 auto}conversation-replies .message-header .customer .draft-actions{margin-left:10px;vertical-align:text-bottom}conversation-replies .message-header .customer .draft-actions button{border:1px solid var(--be-divider-default);padding:5px 8px;font-size:1.2rem;border-radius:3px;margin-right:6px}conversation-replies .message-header .customer .draft-actions button:hover{background-color:#f7f7f7}conversation-replies .message-header .meta{flex:0 0 100px;color:var(--be-secondary-text);font-size:1.2rem;font-weight:500;margin-right:5px;text-align:right;white-space:nowrap;line-height:23px}conversation-replies .message-header .customer-name{text-transform:capitalize;font-weight:500;color:var(--be-help-center-title-text)}conversation-replies .message-header .text-gray{color:var(--be-secondary-text)}conversation-replies .message-body{max-width:90%;word-wrap:break-word;overflow-x:hidden}conversation-replies .message-body a:hover{text-decoration:underline}conversation-replies .message-body img{max-width:100%}\n"],encapsulation:2}),t})()},20964:function(t,e,i){i.d(e,{V:function(){return u}});var n=i(59193),s=i(25917),o=i(5304),a=i(19773),r=i(37716),c=i(69958),l=i(24668);const d="/help-center/tickets";let u=(()=>{class t{constructor(t,e){this.tickets=t,this.router=e}resolve(t,e){return this.tickets.get(+(t.params.ticket_id||t.params.id)).pipe((0,o.K)(()=>(this.router.navigate([d]),n.E)),(0,a.zg)(t=>t.ticket?(0,s.of)(t.ticket):(this.router.navigate([d]),n.E)))}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(c.g),r.LFG(l.F0))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},35976:function(t,e,i){i.d(e,{B:function(){return tt}});var n=i(38433),s=i(98115),o=i(95414),a=i(36461),r=i(26979),c=i(45435),l=i(15257),d=i(37716),u=i(15381),p=i(24688),g=i(66010),h=i(87291),m=i(4928),f=i(34673),v=i(90962),b=i(38583),x=i(91241),y=i(48350),Z=i(82192),k=i(11436),T=i(76627),w=i(51095),A=i(3679),q=i(14506),_=i(26558),I=i(54395),J=i(87519),U=i(43190),C=i(5304),Q=i(93342),O=i(33935),Y=i(80970),M=i(25917),N=i(16403),F=i(35778),S=i(35718),P=i(15515);const E=["input"];function R(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"button",10),d.NdJ("click",function(){return d.CHM(t),d.oxw().showNewCannedReplyModal()}),d.TgZ(1,"strong",11),d._uU(2,"Create new canned reply"),d.qZA(),d.qZA()}}function L(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"button",12),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw().selectCannedReply(e)}),d._uU(1),d.qZA()}if(2&t){const t=e.$implicit;d.xp6(1),d.hij(" ",t.name," ")}}function H(t,e){if(1&t&&(d.TgZ(0,"div",13),d.NdJ("click",function(t){return t.stopPropagation()}),d.TgZ(1,"div"),d.TgZ(2,"span",11),d._uU(3,"No results found for"),d.qZA(),d._uU(4," "),d.TgZ(5,"strong"),d._uU(6),d.qZA(),d.qZA(),d.qZA()),2&t){const t=d.oxw();d.xp6(6),d.Oqu(t.searchQuery.value)}}let $=(()=>{class t{constructor(t,e,i,n,s){this.cannedRepliesService=t,this.currentUser=e,this.modal=i,this.conversation=n,this.toast=s,this.searchQuery=new A.NI,this.onReplySelect=new d.vpe,this.loadedResultsAtLeastOnce=!1,this.cannedReplies=[]}ngOnInit(){this.searchQuery.valueChanges.pipe((0,I.b)(250),(0,J.x)(),(0,U.w)(t=>this.getCannedReplies(t)),(0,C.K)(()=>(0,M.of)(N.p))).subscribe(),this.trigger.menuOpened.subscribe(()=>{this.loadedResultsAtLeastOnce||this.getCannedReplies(null,!0).subscribe()})}selectCannedReply(t){const e=t.body.replace(/{{([\w.\-]+?)}}/,(t,e)=>Y.pick(e.toLowerCase(),{ticket:this.conversation.get()})||t);this.onReplySelect.emit(Object.assign(Object.assign({},t),{body:e}))}showNewCannedReplyModal(){const t=new q.V({body:this.conversation.draft.get().body,uploads:this.conversation.draft.get().uploads});this.modal.open(_.w,{cannedReply:t},{panelClass:"crupdate-canned-reply-modal-container"}).afterClosed().subscribe(t=>{!t||(this.toast.open("Canned reply created."),this.cannedReplies.unshift(t))})}getCannedReplies(t,e){if(!t&&!e)return(0,M.of)(N.p);const i={query:t,userId:this.currentUser.get("id"),perPage:20,shared:!0};return this.cannedRepliesService.getReplies(i).pipe((0,Q.b)(t=>{this.loadedResultsAtLeastOnce=!0,this.cannedReplies=t.pagination.data}))}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(F.U),d.Y36(p.I),d.Y36(u.u),d.Y36(g.r),d.Y36(S.F))},t.\u0275cmp=d.Xpm({type:t,selectors:[["canned-replies-dropdown"]],viewQuery:function(t,e){if(1&t&&(d.Gf(O.p6,7),d.Gf(E,7)),2&t){let t;d.iGM(t=d.CRH())&&(e.trigger=t.first),d.iGM(t=d.CRH())&&(e.input=t.first)}},inputs:{searchQuery:"searchQuery"},outputs:{onReplySelect:"onReplySelect"},decls:10,vars:6,consts:[["mat-icon-button","",1,"no-style","editor-button",3,"matMenuTriggerFor"],["svgIcon","comment",1,"dropdown-icon"],[1,"canned-reply-menu",3,"overlapTrigger"],["cannedReplyMenu","matMenu"],[1,"input-container",3,"click"],["type","text","mat-menu-item","",1,"canned-reply-search-input",3,"formControl"],["input",""],["class","new-canned-reply","mat-menu-item","","trans","",3,"click",4,"ngIf"],["class","canned-reply","mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","no-results",3,"click",4,"ngIf"],["mat-menu-item","","trans","",1,"new-canned-reply",3,"click"],["trans",""],["mat-menu-item","",1,"canned-reply",3,"click"],[1,"no-results",3,"click"]],template:function(t,e){if(1&t&&(d.TgZ(0,"button",0),d._UZ(1,"mat-icon",1),d.qZA(),d.TgZ(2,"mat-menu",2,3),d.TgZ(4,"div",4),d.NdJ("click",function(t){return t.stopPropagation()}),d._UZ(5,"input",5,6),d.qZA(),d.YNc(7,R,3,0,"button",7),d.YNc(8,L,2,1,"button",8),d.YNc(9,H,7,1,"div",9),d.qZA()),2&t){const t=d.MAs(3);d.Q6J("matMenuTriggerFor",t),d.xp6(2),d.Q6J("overlapTrigger",!1),d.xp6(3),d.Q6J("formControl",e.searchQuery),d.xp6(2),d.Q6J("ngIf",!e.searchQuery.value),d.xp6(1),d.Q6J("ngForOf",e.cannedReplies),d.xp6(1),d.Q6J("ngIf",!e.cannedReplies.length&&e.loadedResultsAtLeastOnce&&e.searchQuery.value)}},directives:[w.lW,O.p6,T.Hw,O.VK,A.Fj,O.OP,A.JJ,A.oH,b.O5,b.sg,P.P],styles:["canned-replies-dropdown{display:block}.canned-reply-menu{width:300px}.canned-reply-menu strong{font-weight:500}.canned-reply-menu .input-container{padding:0 10px 10px;border-bottom:1px solid var(--be-divider-default)}.canned-reply-menu .no-results{padding:10px 10px 0;font-size:1.6rem;text-align:center}\n"],encapsulation:2}),t})();var B=i(63297);const D=["textEditor"];function j(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"suggested-articles-dropdown",16),d.NdJ("articleSelected",function(e){return d.CHM(t),d.oxw().insertArticleLink(e)}),d.qZA()}if(2&t){const t=d.oxw();d.Q6J("category",t.conversation.getCategory())}}function G(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"div",17),d.TgZ(1,"canned-replies-dropdown",18),d.NdJ("onReplySelect",function(e){return d.CHM(t),d.oxw().applyCannedReply(e)}),d.qZA(),d.qZA()}}function V(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"button",24),d.NdJ("click",function(){const e=d.CHM(t).$implicit;return d.oxw(2).setSelectedStatus(e)}),d._uU(1),d.qZA()}if(2&t){const t=e.$implicit;d.Q6J("ngClass",t.name),d.xp6(1),d.hij(" ",t.display_name," ")}}function z(t,e){if(1&t&&(d.ynx(0),d.TgZ(1,"button",19),d.TgZ(2,"span"),d._uU(3),d.ALo(4,"trans"),d.qZA(),d._UZ(5,"mat-icon",20),d.qZA(),d.TgZ(6,"mat-menu",21,22),d.YNc(8,V,2,2,"button",23),d.qZA(),d.BQk()),2&t){const t=d.MAs(7),e=d.oxw();d.xp6(1),d.Q6J("matMenuTriggerFor",t),d.xp6(2),d.Oqu(d.lcZ(4,4,null==e.selectedStatus?null:e.selectedStatus.display_name)),d.xp6(3),d.Q6J("overlapTrigger",!1),d.xp6(2),d.Q6J("ngForOf",e.mailboxTags.statusTags)}}function K(t,e){1&t&&(d.TgZ(0,"span",25),d._uU(1,"Send Reply"),d.qZA())}function X(t,e){1&t&&(d.TgZ(0,"span",25),d._uU(1,"Sending..."),d.qZA())}function W(t,e){if(1&t){const t=d.EpF();d.ynx(0),d.TgZ(1,"button",26),d._UZ(2,"mat-icon",27),d.qZA(),d.TgZ(3,"mat-menu",28,29),d.TgZ(5,"button",30),d.NdJ("click",function(){return d.CHM(t),d.oxw().conversation.afterReplyAction.set("stay_on_page")}),d._uU(6," Send and stay on page "),d.qZA(),d.TgZ(7,"button",31),d.NdJ("click",function(){return d.CHM(t),d.oxw().conversation.afterReplyAction.set("next_active_ticket")}),d._uU(8," Send and next ticket "),d.qZA(),d.TgZ(9,"button",32),d.NdJ("click",function(){return d.CHM(t),d.oxw().conversation.afterReplyAction.set("back_to_folder")}),d._uU(10," Send and back to folder "),d.qZA(),d.qZA(),d.BQk()}if(2&t){const t=d.MAs(4),e=d.oxw();d.xp6(1),d.Q6J("disabled",e.conversation.replySaving)("matMenuTriggerFor",t),d.xp6(2),d.Q6J("overlapTrigger",!1),d.xp6(2),d.ekj("selected","stay_on_page"===e.conversation.afterReplyAction.get()),d.xp6(2),d.ekj("selected","next_active_ticket"===e.conversation.afterReplyAction.get()),d.xp6(2),d.ekj("selected","back_to_folder"===e.conversation.afterReplyAction.get())}}let tt=(()=>{class t{constructor(t,e,i,n,s,o,a,c){this.modal=t,this.currentUser=e,this.conversation=i,this.browserEvents=n,this.mailboxTags=s,this.urls=o,this.settings=a,this.localStorage=c,this.selectedStatus=new r.V,this.subscriptions=[]}ngOnInit(){this.mailboxTags.allTags$.pipe((0,c.h)(t=>!!t.length),(0,l.q)(1)).subscribe(()=>{this.setSelectedStatus()}),this.initKeybinds(),this.conversation.setEditor(this.textEditor)}submitReply(){const t={body:this.textEditor.getContents(),status:this.selectedStatus};this.conversation.submitReply(t).subscribe(()=>{this.closeEditor()},()=>{})}saveDraft(t={}){return this.conversation.draft.save(t)}closeEditor(){this.conversation.closeEditor(),this.conversation.draft.reset(),this.textEditor.reset()}saveDraftAndAddToReplies(){this.conversation.draft.isEmpty()?this.closeEditor():this.saveDraft().subscribe(t=>{this.conversation.replies.add(t.reply),this.closeEditor()})}maybeDeleteDraft(){const t=this.conversation.draft.get();t.id?this.modal.show(n.y,{reply:t}).afterClosed().subscribe(t=>{!t||(this.conversation.draft.delete(),this.closeEditor())}):this.closeEditor()}applyCannedReply(t){this.textEditor.insertContents(t.body),setTimeout(()=>{var e;this.saveDraft({uploads:null===(e=t.uploads)||void 0===e?void 0:e.map(t=>t.id)})})}setSelectedStatus(t){if(t)this.localStorage.set("default_status_tag",t.name);else{const e=this.localStorage.get("default_status_tag");t=e?this.mailboxTags.getTagByIdOrName(e):this.currentUser.hasPermission("tickets.update")?this.mailboxTags.getTagByIdOrName("closed"):this.mailboxTags.getTagByIdOrName("open")}this.selectedStatus=t}initKeybinds(){const t=this.browserEvents.globalKeyDown$.subscribe(t=>{this.modal.anyDialogOpen()||s.J.userIsTyping()||(t.keyCode===a.R&&"locked"!==this.conversation.status.name&&(this.conversation.openEditor(),this.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})),t.keyCode===a.hn&&(t.ctrlKey||t.metaKey)&&(this.articleDropdown.focus(),this.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})))});this.subscriptions.push(t),this.textEditor.editor.waitForEditor().then(t=>{t.shortcuts.add(["ctrl+191","meta+191"],"Search docs",()=>{this.articleDropdown.focus(),this.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})})})}ngOnDestroy(){this.saveDraft(),this.closeEditor(),this.subscriptions.forEach(t=>{t&&t.unsubscribe()})}insertArticleLink(t){const e=this.urls.article(t);this.textEditor.insertLink({target:"blank",href:this.settings.getBaseUrl()+e,text:t.title})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(u.u),d.Y36(p.I),d.Y36(g.r),d.Y36(s.J),d.Y36(h.N),d.Y36(m.X),d.Y36(f.Z),d.Y36(v.m))},t.\u0275cmp=d.Xpm({type:t,selectors:[["conversation-text-editor"]],viewQuery:function(t,e){if(1&t&&(d.Gf(D,7),d.Gf(o.B,5)),2&t){let t;d.iGM(t=d.CRH())&&(e.textEditor=t.first),d.iGM(t=d.CRH())&&(e.articleDropdown=t.first)}},decls:21,vars:18,consts:[[1,"text-editor-container"],["placeholder","Search docs... (ctrl + /)",3,"category","articleSelected",4,"ngIf"],[3,"attachments","detached"],["inlineUploadPrefix","ticket_images",3,"onChange","onFileUpload","onCtrlEnter"],["textEditor",""],["class","header-actions","customButtons","",4,"ngIf"],["header","",1,"header-actions","last","right"],["type","button",1,"no-style","editor-button","save-draft-button",3,"matTooltip","click"],["svgIcon","check-circle"],["type","button",1,"no-style","editor-button","delete-draft-button",3,"matTooltip","click"],["svgIcon","delete"],["footer","",1,"editor-footer"],[1,"right"],[4,"ngIf"],["type","button","mat-flat-button","","color","accent",1,"submit-button",3,"disabled","click"],["trans","",4,"ngIf"],["placeholder","Search docs... (ctrl + /)",3,"category","articleSelected"],["customButtons","",1,"header-actions"],[3,"onReplySelect"],["type","button","mat-button","",1,"change-status-button",3,"matMenuTriggerFor"],["svgIcon","keyboard-arrow-down",1,"dropdown-icon"],[1,"status-menu",3,"overlapTrigger"],["statusMenu","matMenu"],["mat-menu-item","","trans","",3,"ngClass","click",4,"ngFor","ngForOf"],["mat-menu-item","","trans","",3,"ngClass","click"],["trans",""],["mat-flat-button","","color","accent",1,"dropdown-left","submit-button-addon",3,"disabled","matMenuTriggerFor"],["svgIcon","arrow-drop-down",1,"caret","align-middle"],[1,"default-redirect-menu",3,"overlapTrigger"],["defaultRedirectMenu","matMenu"],["mat-menu-item","","trans","",1,"stay-on-page",3,"click"],["mat-menu-item","","trans","",1,"next-active-ticket",3,"click"],["mat-menu-item","","trans","",1,"back_to_folder",3,"click"]],template:function(t,e){1&t&&(d.TgZ(0,"section",0),d.YNc(1,j,1,1,"suggested-articles-dropdown",1),d.TgZ(2,"reply-attachment-list",2),d.NdJ("detached",function(t){return e.conversation.draft.detachUpload(t)}),d.qZA(),d._UZ(3,"upload-progress-bar"),d.TgZ(4,"text-editor",3,4),d.NdJ("onChange",function(t){return e.conversation.draft.setBody(t)})("onFileUpload",function(t){return e.conversation.draft.uploadFiles(t)})("onCtrlEnter",function(){return e.submitReply()}),d.YNc(6,G,2,0,"div",5),d.TgZ(7,"div",6),d.TgZ(8,"button",7),d.NdJ("click",function(){return e.saveDraftAndAddToReplies()}),d.ALo(9,"trans"),d._UZ(10,"mat-icon",8),d.qZA(),d.TgZ(11,"button",9),d.NdJ("click",function(){return e.maybeDeleteDraft()}),d.ALo(12,"trans"),d._UZ(13,"mat-icon",10),d.qZA(),d.qZA(),d.TgZ(14,"div",11),d.TgZ(15,"div",12),d.YNc(16,z,9,6,"ng-container",13),d.TgZ(17,"button",14),d.NdJ("click",function(){return e.submitReply()}),d.YNc(18,K,2,0,"span",15),d.YNc(19,X,2,0,"span",15),d.qZA(),d.YNc(20,W,11,9,"ng-container",13),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t&&(d.ekj("hidden",!e.conversation.isEditorOpen()),d.xp6(1),d.Q6J("ngIf",e.currentUser.hasPermission("tickets.update")),d.xp6(1),d.Q6J("attachments",e.conversation.draft.get().uploads),d.xp6(4),d.Q6J("ngIf",e.currentUser.hasPermission("canned_replies.view")),d.xp6(2),d.ekj("success",e.conversation.draft.get().id),d.Q6J("matTooltip",d.lcZ(9,14,"Save Draft")),d.xp6(3),d.Q6J("matTooltip",d.lcZ(12,16,"Discard (Esc)")),d.xp6(5),d.Q6J("ngIf",e.currentUser.hasPermission("tickets.update")),d.xp6(1),d.Q6J("disabled",e.conversation.replySaving),d.xp6(1),d.Q6J("ngIf",!e.conversation.replySaving),d.xp6(1),d.Q6J("ngIf",e.conversation.replySaving),d.xp6(1),d.Q6J("ngIf",e.currentUser.hasPermission("settings.update")))},directives:[b.O5,x.G,y.o,Z.d,k.gM,T.Hw,w.lW,o.B,$,O.p6,O.VK,b.sg,O.OP,P.P,b.mk],pipes:[B.R],styles:["conversation-text-editor{display:block;width:100%}conversation-text-editor suggested-articles-dropdown .input-container{position:relative;margin-bottom:10px}conversation-text-editor suggested-articles-dropdown .input-container .search-icon{position:absolute;right:0;top:3px;color:var(--be-secondary-text)}conversation-text-editor .text-editor-container{margin:0 25px 25px}conversation-text-editor .attachments-list{border-bottom:1px dotted var(--be-divider-default);padding-bottom:10px}conversation-text-editor .attachments-list .attachments-list-item{background-color:var(--be-background-alternative)}conversation-text-editor .editor-footer .right{height:100%;display:flex;position:absolute;right:0;top:0}conversation-text-editor .editor-footer .right .change-status-button{height:100%;color:var(--be-secondary-text);font-weight:500;text-transform:capitalize}conversation-text-editor .editor-footer .right .change-status-button .mat-icon{width:20px;height:20px;vertical-align:text-bottom}conversation-text-editor .editor-footer .right .submit-button,conversation-text-editor .editor-footer .right .submit-button-addon{height:38px;border-radius:0;font-weight:400;position:relative;top:-1px}conversation-text-editor .editor-footer .right .submit-button-addon{border-left:1px solid var(--be-accent-emphasis);padding:0 7px;min-width:45px}.default-redirect-menu .selected{background-color:var(--be-accent-emphasis)}.status-menu .mat-menu-item{text-transform:capitalize}\n"],encapsulation:2}),t})()},61:function(t,e,i){i.d(e,{S:function(){return Nt}});var n=i(37716),s=i(24668),o=i(97312),a=i(24688),r=i(66010),c=i(22238),l=i(9141),d=i(68939),u=i(69958),p=i(15515),g=i(51095),h=i(76627),m=i(3679),f=i(82192),v=i(48350),b=i(38583),x=i(91241);const y=["textEditor"];function Z(t,e){if(1&t&&(n.TgZ(0,"div",13),n._uU(1),n.qZA()),2&t){const t=n.oxw();n.xp6(1),n.Oqu(t.errors.body)}}function k(t,e){if(1&t&&(n.TgZ(0,"div",13),n._uU(1),n.qZA()),2&t){const t=n.oxw();n.xp6(1),n.Oqu(t.errors.file)}}function T(t,e){if(1&t&&(n.TgZ(0,"div",13),n._uU(1),n.qZA()),2&t){const t=n.oxw();n.xp6(1),n.Oqu(t.errors.attachments)}}function w(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"reply-attachment-list",14),n.NdJ("detached",function(e){return n.CHM(t),n.oxw().removeAttachment(e)}),n.qZA()}if(2&t){const t=n.oxw();n.Q6J("attachments",t.attachments)}}let A=(()=>{class t{constructor(t,e,i,n,s){this.dialogRef=t,this.data=e,this.ticketService=i,this.uploads=n,this.uploadQueue=s,this.errors={},this.attachments=[],this.loading=!1}ngOnInit(){this.textEditor.focus()}close(t){this.textEditor.destroyEditor(),this.dialogRef.close(t)}confirm(){this.loading=!0;const t={body:this.textEditor.getContents(),uploads:this.attachments.map(t=>t.id)};this.ticketService.addNote(this.data.ticketId,t).pipe((0,d.x)(()=>this.loading=!1)).subscribe(t=>{this.close(t.reply)},t=>this.errors=t.errors)}uploadFiles(t){this.uploadQueue.start(t).subscribe(t=>{this.attachments=[...this.attachments,t.fileEntry]})}removeAttachment(t){for(let e=0;e<this.attachments.length;e++)this.attachments[e].id===t.id&&this.attachments.splice(e,1)}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(c.so),n.Y36(c.WI),n.Y36(u.g),n.Y36(o.f),n.Y36(l.A))},t.\u0275cmp=n.Xpm({type:t,selectors:[["add-note-modal"]],viewQuery:function(t,e){if(1&t&&n.Gf(y,7),2&t){let t;n.iGM(t=n.CRH())&&(e.textEditor=t.first)}},features:[n._Bn([r.r,l.A])],decls:20,vars:6,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["ngNativeValidate","",3,"ngSubmit"],[1,"many-inputs"],[1,"input-container"],["inlineUploadPrefix","ticket_images",1,"text-editor",3,"minHeight","onFileUpload"],["textEditor",""],["class","error",4,"ngIf"],[3,"attachments","detached",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"error"],[3,"attachments","detached"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"h2",1),n._uU(2,"Add Note"),n.qZA(),n.TgZ(3,"button",2),n.NdJ("click",function(){return e.close()}),n._UZ(4,"mat-icon",3),n.qZA(),n.qZA(),n.TgZ(5,"form",4),n.NdJ("ngSubmit",function(){return e.confirm()}),n.TgZ(6,"mat-dialog-content",5),n.TgZ(7,"div",6),n.TgZ(8,"text-editor",7,8),n.NdJ("onFileUpload",function(t){return e.uploadFiles(t)}),n.qZA(),n._UZ(10,"upload-progress-bar"),n.YNc(11,Z,2,1,"div",9),n.YNc(12,k,2,1,"div",9),n.YNc(13,T,2,1,"div",9),n.YNc(14,w,1,1,"reply-attachment-list",10),n.qZA(),n.qZA(),n.TgZ(15,"mat-dialog-actions"),n.TgZ(16,"button",11),n.NdJ("click",function(){return e.close()}),n._uU(17,"Cancel"),n.qZA(),n.TgZ(18,"button",12),n._uU(19,"Add Note"),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(8),n.Q6J("minHeight",300),n.xp6(3),n.Q6J("ngIf",e.errors.body),n.xp6(1),n.Q6J("ngIf",e.errors.file),n.xp6(1),n.Q6J("ngIf",e.errors.attachments),n.xp6(1),n.Q6J("ngIf",e.attachments.length),n.xp6(4),n.Q6J("disabled",e.loading))},directives:[c.uh,p.P,g.lW,h.Hw,m.JL,m.F,c.xY,f.d,v.o,b.O5,c.H8,x.G],styles:[".add-note-modal-container{width:600px}.add-note-modal-container reply-attachment-list{margin-top:15px}\n"],encapsulation:2}),t})();var q=i(44625),_=i(4075),I=i(98115),J=i(33935),U=i(36461),C=i(15381),Q=i(87291),O=i(45435);let Y=(()=>{class t{constructor(t){this.router=t,this.history=[],this.limit=15}get(t=0){return this.history[t]||null}getPrevious(){return this.get(1)}back(){const t=this.getPrevious();return t?this.router.navigate([t.url],{queryParams:t.queryParams}):new Promise(t=>t(!1))}addHistoryItem(t){const e=t.split("?");let i={};e[1]&&(i=this.parseQueryParams(e[1])),this.history.length>=this.limit&&this.history.splice(1,this.history.length-1),this.history.unshift({url:e[0],queryParams:i})}parseQueryParams(t){return new URLSearchParams(t),{}}init(){this.router.events.pipe((0,O.h)(t=>t instanceof s.m2)).subscribe(t=>{this.addHistoryItem(t.urlAfterRedirects)})}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(s.F0))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=i(11436),N=i(63297);const F=["ticketStatusMenuTrigger"];function S(t,e){1&t&&(n.TgZ(0,"a",16),n.ALo(1,"trans"),n._UZ(2,"mat-icon",17),n.qZA()),2&t&&n.Q6J("matTooltip",n.lcZ(1,1,"Back (b)"))}function P(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"button",18),n.NdJ("click",function(){const e=n.CHM(t).$implicit;return n.oxw(2).changeTicketStatus(e)}),n._uU(1),n.qZA()}if(2&t){const t=e.$implicit,i=n.oxw(2);n.ekj("active",(null==i.conversation.status?null:i.conversation.status.name)===t.name),n.Q6J("ngClass",t.name),n.xp6(1),n.hij(" ",t.display_name||t.name," ")}}const E=function(t){return[t]};function R(t,e){if(1&t){const t=n.EpF();n.ynx(0),n.YNc(1,S,3,3,"a",5),n.TgZ(2,"assign-ticket-dropdown",6),n.NdJ("assigned",function(){return n.CHM(t),n.oxw().refreshMailboxTags()}),n.ALo(3,"trans"),n.qZA(),n.TgZ(4,"button",7),n.NdJ("click",function(){return n.CHM(t),n.oxw().showNoteModal()}),n.ALo(5,"trans"),n._UZ(6,"mat-icon",8),n.qZA(),n.TgZ(7,"add-tag-dropdown",9),n.NdJ("tagAdded",function(e){return n.CHM(t),n.oxw().addTag(e)}),n.ALo(8,"trans"),n.qZA(),n.TgZ(9,"button",10,11),n.ALo(11,"trans"),n._UZ(12,"mat-icon",12),n.qZA(),n.TgZ(13,"mat-menu",13,14),n.YNc(15,P,2,4,"button",15),n.qZA(),n.Hsn(16),n.BQk()}if(2&t){const t=n.MAs(14),e=n.oxw();n.xp6(1),n.Q6J("ngIf",!e.hideBackButton),n.xp6(1),n.Q6J("ticket",e.conversation.get())("matTooltip",n.lcZ(3,10,"Assign (a)")),n.xp6(2),n.Q6J("matTooltip",n.lcZ(5,12,"Note (n)")),n.xp6(3),n.Q6J("ticketIds",n.VKq(18,E,e.conversation.get().id))("matTooltip",n.lcZ(8,14,"Tag (t)")),n.xp6(2),n.Q6J("matMenuTriggerFor",t)("matTooltip",n.lcZ(11,16,"Status (s)")),n.xp6(4),n.Q6J("overlapTrigger",!1),n.xp6(2),n.Q6J("ngForOf",e.mailboxTags.statusTags)}}const L=function(){return["tickets.update"]},H=["*"];let $=(()=>{class t{constructor(t,e,i,n,s,o,a,r,c,l){this.router=t,this.injector=e,this.modals=i,this.route=n,this.currentUser=s,this.tickets=o,this.conversation=a,this.browserEvents=r,this.mailboxTags=c,this.routerHistory=l,this.hideBackButton=!1,this.subscriptions=[]}ngOnInit(){this.initKeybinds()}changeTicketStatus(t){!t||this.tickets.changeTicketStatus(this.conversation.get().id,t.name).subscribe(()=>{this.conversation.performAfterReplyAction(),this.conversation.setStatus(t)})}showNoteModal(){this.modals.open(A,{ticketId:this.conversation.get().id},{panelClass:"add-note-modal-container"}).afterClosed().subscribe(t=>{!t||this.addNewNote(t)})}addTag(t){this.conversation.addTag(t),this.refreshMailboxTags()}addNewNote(t){!t||this.conversation.replies.add(t)}refreshMailboxTags(){this.mailboxTags.refresh()}initKeybinds(){const t=this.browserEvents.globalKeyDown$.subscribe(t=>{let e=!0;if(!(this.modals.anyDialogOpen()||I.J.userIsTyping()||t.ctrlKey||t.metaKey)){switch(t.keyCode){case U.B:this.closeAllMenus(),this.router.navigate(["../"],{relativeTo:this.route});break;case U.A:this.assignTicketDropdown.open();break;case U.N:this.closeAllMenus(),this.showNoteModal();break;case U.T:this.addTagDropdown.open();break;case U.S:this.ticketStatusTrigger.menuOpen?this.handleTicketStatusChangeKeybind("spam"):this.ticketStatusTrigger.openMenu();break;case U.O:this.handleTicketStatusChangeKeybind("open");break;case U.C:this.handleTicketStatusChangeKeybind("closed");break;case U.P:this.handleTicketStatusChangeKeybind("pending");break;case U.L:this.handleTicketStatusChangeKeybind("locked");break;default:e=!1}e&&(t.preventDefault(),t.stopPropagation())}});this.subscriptions.push(t)}closeAllMenus(){this.addTagDropdown.close(),this.assignTicketDropdown.close(),this.ticketStatusTrigger.closeMenu()}handleTicketStatusChangeKeybind(t){!this.ticketStatusTrigger.menuOpen||(this.changeTicketStatus(this.mailboxTags.getTagByIdOrName(t)),this.ticketStatusTrigger.closeMenu())}ngOnDestroy(){this.subscriptions.forEach(t=>{t&&t.unsubscribe()})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.F0),n.Y36(n.zs3),n.Y36(C.u),n.Y36(s.gz),n.Y36(a.I),n.Y36(u.g),n.Y36(r.r),n.Y36(I.J),n.Y36(Q.N),n.Y36(Y))},t.\u0275cmp=n.Xpm({type:t,selectors:[["conversation-toolbar"]],viewQuery:function(t,e){if(1&t&&(n.Gf(q.H,5),n.Gf(_.$,5),n.Gf(F,5,J.p6)),2&t){let t;n.iGM(t=n.CRH())&&(e.assignTicketDropdown=t.first),n.iGM(t=n.CRH())&&(e.addTagDropdown=t.first),n.iGM(t=n.CRH())&&(e.ticketStatusTrigger=t.first)}},inputs:{hideBackButton:"hideBackButton"},ngContentSelectors:H,decls:7,vars:5,consts:[[1,"left","toolbar-actions"],[4,"ngIf"],[1,"right","ticket-info"],[1,"ticket-number"],[1,"ticket-status",3,"ngClass"],["class","no-style action back-button","routerLink","../","queryParamsHandling","preserve",3,"matTooltip",4,"ngIf"],[1,"action",3,"ticket","matTooltip","assigned"],[1,"action","no-style","add-note-button",3,"matTooltip","click"],["svgIcon","note-custom"],[1,"action",3,"ticketIds","matTooltip","tagAdded"],[1,"no-style","change-ticket-status-button","action",3,"matMenuTriggerFor","matTooltip"],["ticketStatusMenuTrigger",""],["svgIcon","flag-custom"],[1,"ticket-status-menu",3,"overlapTrigger"],["ticketStatusMenu","matMenu"],["mat-menu-item","",3,"active","ngClass","click",4,"ngFor","ngForOf"],["routerLink","../","queryParamsHandling","preserve",1,"no-style","action","back-button",3,"matTooltip"],["svgIcon","return-custom"],["mat-menu-item","",3,"ngClass","click"]],template:function(t,e){1&t&&(n.F$t(),n.TgZ(0,"div",0),n.YNc(1,R,17,20,"ng-container",1),n.qZA(),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n._uU(4),n.qZA(),n.TgZ(5,"div",4),n._uU(6),n.qZA(),n.qZA()),2&t&&(n.xp6(1),n.Q6J("ngIf",e.currentUser.hasPermissions(n.DdM(4,L))),n.xp6(3),n.hij("#",e.conversation.get().id,""),n.xp6(1),n.Q6J("ngClass",e.conversation.getStatus().name),n.xp6(1),n.Oqu(e.conversation.getStatus().display_name))},directives:[b.O5,b.mk,q.H,M.gM,h.Hw,_.$,J.p6,J.VK,b.sg,s.yS,J.OP],pipes:[N.R],styles:["conversation-toolbar{display:block;width:100%;border-bottom:1px solid var(--be-divider-default);height:57px;padding:0 35px 0 10px;white-space:nowrap;color:var(--be-help-center-title-text)}conversation-toolbar .left,conversation-toolbar .right{width:50%;height:100%;display:inline-flex;align-items:center;padding:15px 0}conversation-toolbar .toolbar-actions .action{margin:0 15px;height:26px;width:26px;position:relative;transition:color .2s ease-in-out;color:inherit}conversation-toolbar .toolbar-actions .action:hover{color:var(--be-text)}conversation-toolbar .toolbar-actions .action mat-icon{height:26px;width:26px}conversation-toolbar .ticket-info{justify-content:flex-end;vertical-align:top}conversation-toolbar .ticket-info .ticket-number{font-size:3rem}conversation-toolbar .ticket-info .ticket-status{border:1px solid var(--be-divider-default);border-radius:2px;background-color:var(--be-background-alternative);padding:4px 12px;margin-left:10px;text-transform:uppercase;font-weight:500;font-size:1.1rem;letter-spacing:.02em}conversation-toolbar .ticket-info .ticket-status.open{background-color:var(--be-accent-default);color:var(--be-accent-contrast);border-color:transparent}@media only screen and (max-width: 768px){conversation-toolbar{padding:0 10px}conversation-toolbar .ticket-number{display:none}}.ticket-status-menu .mat-menu-item{text-transform:capitalize}.ticket-status-menu .mat-menu-item.active{background-color:var(--be-accent-emphasis)}\n"],encapsulation:2}),t})();var B=i(19867),D=i(30587),j=i(35976),G=i(61693),V=i(20616),z=i(74180),K=i(35866),X=i(35718),W=i(34673),tt=i(26215),et=i(99183),it=i(18256);let nt=(()=>{class t{constructor(t,e,i,n,s){this.dialogRef=t,this.data=e,this.envato=i,this.toast=n,this.cd=s,this.searchFormControl=new m.NI,this.loading$=new tt.X(!1)}close(){this.dialogRef.close(this.syncedPurchases)}syncPurchases(){this.loading$.next(!0),this.envato.syncPurchases(this.data.purchase.user_id).pipe((0,d.x)(()=>this.loading$.next(!1))).subscribe(t=>{this.toast.open("Purchases synced"),this.data.purchase=t.purchases.find(t=>t.code===this.data.purchase.code),this.syncedPurchases=t.purchases,this.cd.markForCheck()})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(c.so),n.Y36(c.WI),n.Y36(et.q),n.Y36(X.F),n.Y36(n.sBO))},t.\u0275cmp=n.Xpm({type:t,selectors:[["envato-purchase-details-modal"]],decls:32,vars:15,consts:[[1,"purchase"],["alt","",1,"purchase-img",3,"src"],[1,"details"],["target","_blank",1,"item-name",3,"href"],[1,"purchase-code"],[1,"detail-list"],[1,"detail-line"],["trans","",1,"detail-name"],["target","_blank",1,"detail-value",3,"href"],[1,"detail-value"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","button","cdkFocusInitial","","mat-raised-button","","color","accent","trans","",3,"disabled","click"]],template:function(t,e){1&t&&(n.TgZ(0,"mat-dialog-content"),n.TgZ(1,"div",0),n._UZ(2,"img",1),n.TgZ(3,"div",2),n.TgZ(4,"a",3),n._uU(5),n.qZA(),n.TgZ(6,"div",4),n._uU(7),n.qZA(),n.TgZ(8,"div",5),n.TgZ(9,"div",6),n.TgZ(10,"div",7),n._uU(11,"Customer:"),n.qZA(),n.TgZ(12,"a",8),n._uU(13),n.qZA(),n.qZA(),n.TgZ(14,"div",6),n.TgZ(15,"div",7),n._uU(16,"Purchased:"),n.qZA(),n.TgZ(17,"div",9),n._uU(18),n.ALo(19,"formattedDate"),n.qZA(),n.qZA(),n.TgZ(20,"div",6),n.TgZ(21,"div",7),n._uU(22,"Supported Until:"),n.qZA(),n.TgZ(23,"div",9),n._uU(24),n.ALo(25,"formattedDate"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(26,"mat-dialog-actions"),n.TgZ(27,"button",10),n.NdJ("click",function(){return e.close()}),n._uU(28,"Close"),n.qZA(),n.TgZ(29,"button",11),n.NdJ("click",function(){return e.syncPurchases()}),n.ALo(30,"async"),n._uU(31," Sync Purchases "),n.qZA(),n.qZA()),2&t&&(n.xp6(2),n.Q6J("src",e.data.purchase.image,n.LSH),n.xp6(2),n.Q6J("href",e.data.purchase.url,n.LSH),n.xp6(1),n.Oqu(e.data.purchase.item_name),n.xp6(2),n.Oqu(e.data.purchase.code),n.xp6(5),n.Q6J("href","https://codecanyon.net/user/"+e.data.purchase.envato_username,n.LSH),n.xp6(1),n.Oqu(e.data.purchase.envato_username),n.xp6(5),n.Oqu(n.lcZ(19,9,e.data.purchase.purchased_at)),n.xp6(6),n.hij(" ",e.data.purchase.supported_until?n.lcZ(25,11,e.data.purchase.supported_until):"Support expired"," "),n.xp6(5),n.Q6J("disabled",n.lcZ(30,13,e.loading$)))},directives:[c.xY,p.P,c.H8,g.lW],pipes:[it.l,b.Ov],styles:["[_nghost-%COMP%]{display:block;width:400px;max-width:100%}.purchase[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.purchase-img[_ngcontent-%COMP%]{flex-shrink:0;width:80px;height:80px;border-radius:4px;margin-right:15px}.item-name[_ngcontent-%COMP%]{display:block;margin-bottom:5px}.purchase-code[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--be-secondary-text)}.detail-list[_ngcontent-%COMP%]{margin:15px 0}.detail-line[_ngcontent-%COMP%]{display:flex;padding:4px 0}.detail-value[_ngcontent-%COMP%]{display:block;padding-left:15px;color:var(--be-secondary-text)}"],changeDetection:0}),t})();function st(t,e){if(1&t&&(n.TgZ(0,"div",9),n._UZ(1,"mat-icon",10),n.TgZ(2,"a",11),n._uU(3),n.qZA(),n.qZA()),2&t){const t=n.oxw(2);n.xp6(2),n.Q6J("href","https://codecanyon.net/user/"+t.envatoPurchase.envato_username,n.LSH)("title",t.envatoPurchase.envato_username),n.xp6(1),n.Oqu(t.envatoPurchase.envato_username)}}function ot(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"div",12),n.NdJ("click",function(){return n.CHM(t),n.oxw(2).openPurchaseDetailsModal()}),n._UZ(1,"img",13),n.TgZ(2,"div",14),n.TgZ(3,"div",15),n._uU(4),n.qZA(),n.TgZ(5,"div",16),n._uU(6),n.ALo(7,"formattedDate"),n.qZA(),n.qZA(),n.qZA()}if(2&t){const t=e.$implicit,i=n.oxw(2);n.ekj("current-purchase",i.envatoPurchase.code===t.code),n.xp6(1),n.Q6J("src",t.image,n.LSH),n.xp6(3),n.Oqu(t.item_name),n.xp6(1),n.ekj("expired",t.support_expired),n.xp6(1),n.hij(" ",t.supported_until?n.lcZ(7,7,t.supported_until):"Support Expired"," ")}}function at(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"div"),n.ALo(1,"async"),n.TgZ(2,"div",1),n.NdJ("click",function(){return n.CHM(t),n.oxw().toggleVisibility()}),n.TgZ(3,"div",2),n._uU(4,"Envato"),n.qZA(),n.TgZ(5,"button",3),n._UZ(6,"mat-icon",4),n.qZA(),n.qZA(),n.TgZ(7,"div",5),n.YNc(8,st,4,3,"div",6),n.TgZ(9,"div",7),n.YNc(10,ot,8,9,"div",8),n.qZA(),n.qZA(),n.qZA()}if(2&t){const t=n.oxw();n.ekj("panel-content-visible",n.lcZ(1,4,t.contentVisible$)),n.xp6(8),n.Q6J("ngIf",t.envatoPurchase.envato_username),n.xp6(2),n.Q6J("ngForOf",t.customer.purchase_codes)}}let rt=(()=>{class t{constructor(t,e){this.conversation=t,this.modal=e,this.contentVisible$=new tt.X(!0)}get noPurchaseCode(){return!this.envatoPurchase}ngOnChanges(){this.customer&&this.setEnvatoPurchase()}setEnvatoPurchase(){const t=this.conversation.getCategory();if(!this.customer.purchase_codes.length)return;let e;if(t){const i=t.name.toLowerCase();e=this.customer.purchase_codes.find(t=>t.item_name.toLowerCase().indexOf(i)>-1)}this.envatoPurchase=e||this.customer.purchase_codes[0]}openPurchaseDetailsModal(){this.modal.open(nt,{purchase:this.envatoPurchase}).afterClosed().subscribe(t=>{t&&(this.customer.purchase_codes=t,this.envatoPurchase=t.find(t=>t.code===this.envatoPurchase.code))})}toggleVisibility(){this.contentVisible$.next(!this.contentVisible$.value)}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(r.r),n.Y36(C.u))},t.\u0275cmp=n.Xpm({type:t,selectors:[["envato-purchases"]],hostVars:2,hostBindings:function(t,e){2&t&&n.ekj("hidden",e.noPurchaseCode)},inputs:{customer:"customer"},features:[n.TTD],decls:1,vars:1,consts:[[3,"panel-content-visible",4,"ngIf"],[1,"sidebar-header",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],[1,"panel-content"],["class","info-line",4,"ngIf"],[1,"envato-purchases"],["class","purchase-item",3,"current-purchase","click",4,"ngFor","ngForOf"],[1,"info-line"],["svgIcon","person"],["target","_blank",3,"href","title"],[1,"purchase-item",3,"click"],["alt","Purchase image",3,"src"],[1,"purchase-info"],[1,"purchase-name"],[1,"purchase-support"]],template:function(t,e){1&t&&n.YNc(0,at,11,6,"div",0),2&t&&n.Q6J("ngIf",e.envatoPurchase)},directives:[b.O5,p.P,h.Hw,b.sg],pipes:[b.Ov,it.l],styles:["[_nghost-%COMP%]{display:block}.purchase-item[_ngcontent-%COMP%]{display:flex;align-items:center;white-space:nowrap;padding:6px 15px;margin:0 -15px;cursor:pointer}.purchase-item[_ngcontent-%COMP%]:hover{background-color:var(--be-hover)}.purchase-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px;flex-shrink:0;margin-right:8px;border-radius:4px}.current-purchase[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis)}.purchase-info[_ngcontent-%COMP%]{overflow:hidden}.purchase-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.purchase-support[_ngcontent-%COMP%]{color:var(--be-secondary-text);font-size:1.2rem}.purchase-support.expired[_ngcontent-%COMP%]{text-decoration:line-through}"],changeDetection:0}),t})();var ct=i(58341),lt=i(86911),dt=i(90299),ut=i(4928);function pt(t,e){if(1&t&&(n.ynx(0),n.TgZ(1,"span",14),n._uU(2,"Viewed article"),n.qZA(),n._uU(3,": "),n.TgZ(4,"a",15),n._uU(5),n.qZA(),n.BQk()),2&t){const t=n.oxw().$implicit,e=n.oxw();n.xp6(4),n.Q6J("routerLink",e.urls.article(t.subject)),n.xp6(1),n.Oqu(t.subject.title)}}function gt(t,e){1&t&&(n.TgZ(0,"span",14),n._uU(1,"Replied via email:"),n.qZA())}function ht(t,e){1&t&&(n.TgZ(0,"span",14),n._uU(1,"Replied via site:"),n.qZA())}const mt=function(t){return{replyId:t}};function ft(t,e){if(1&t&&(n.ynx(0),n.YNc(1,gt,2,0,"span",17),n.YNc(2,ht,2,0,"span",17),n._uU(3," "),n.TgZ(4,"a",18),n._uU(5),n.qZA(),n.BQk()),2&t){const t=n.oxw(2).$implicit,e=n.oxw();n.xp6(1),n.Q6J("ngIf","email"===(null==t.properties?null:t.properties.source)),n.xp6(1),n.Q6J("ngIf","email"!==(null==t.properties?null:t.properties.source)),n.xp6(2),n.Q6J("routerLink",e.urls.agentMailboxTicket(t.subject.id))("queryParams",n.VKq(5,mt,null==t.properties?null:t.properties.replyId)),n.xp6(1),n.Oqu(t.subject.subject)}}function vt(t,e){if(1&t&&(n.ynx(0),n.TgZ(1,"span",14),n._uU(2,"Created ticket"),n.qZA(),n._uU(3,": "),n.TgZ(4,"a",15),n._uU(5),n.qZA(),n.BQk()),2&t){const t=n.oxw(2).$implicit,e=n.oxw();n.xp6(4),n.Q6J("routerLink",e.urls.agentMailboxTicket(t.subject.id)),n.xp6(1),n.Oqu(t.subject.subject)}}const bt=function(t){return{count:t}};function xt(t,e){if(1&t&&(n.ynx(0),n.TgZ(1,"span",19),n._uU(2,"Suggested :count articles for"),n.qZA(),n._uU(3,' "'),n.TgZ(4,"span",20),n._uU(5),n.qZA(),n._uU(6,'" '),n.BQk()),2&t){const t=n.oxw(2).$implicit;n.xp6(1),n.Q6J("transValues",n.VKq(2,bt,null==t.properties?null:t.properties.articleIds.length)),n.xp6(4),n.Oqu(null==t.properties?null:t.properties.query)}}function yt(t,e){if(1&t&&(n.ynx(0),n.YNc(1,ft,6,7,"ng-container",16),n.YNc(2,vt,6,2,"ng-container",16),n.YNc(3,xt,7,4,"ng-container",16),n.BQk()),2&t){const t=n.oxw().$implicit;n.xp6(1),n.Q6J("ngIf","replied"===t.event),n.xp6(1),n.Q6J("ngIf","created"===t.event),n.xp6(1),n.Q6J("ngIf","articlesSuggested"===t.event)}}function Zt(t,e){if(1&t&&(n.ynx(0),n._uU(1,'Searched for "'),n.TgZ(2,"a",15),n._uU(3),n.qZA(),n._uU(4,'"'),n.BQk()),2&t){const t=n.oxw().$implicit,e=n.oxw();n.xp6(2),n.Q6J("routerLink",e.urls.searchPage(t.subject.term)),n.xp6(1),n.Oqu(t.subject.term)}}function kt(t,e){if(1&t&&(n.TgZ(0,"div",6),n.TgZ(1,"div",7),n.ynx(2,8),n.YNc(3,pt,6,2,"ng-container",9),n.YNc(4,yt,4,3,"ng-container",9),n.YNc(5,Zt,5,2,"ng-container",9),n.BQk(),n.qZA(),n.TgZ(6,"div",10),n._uU(7),n.qZA(),n.TgZ(8,"div",11),n._UZ(9,"div",12),n._UZ(10,"div",13),n.qZA(),n.qZA()),2&t){const t=e.$implicit,i=e.last,s=n.oxw();n.ekj("highlight","created"===t.event&&(null==t.subject?null:t.subject.id)===s.conversation.get().id)("last",i),n.xp6(2),n.Q6J("ngSwitch",t.subject.model_type),n.xp6(1),n.Q6J("ngSwitchCase","article"),n.xp6(1),n.Q6J("ngSwitchCase","ticket"),n.xp6(1),n.Q6J("ngSwitchCase","searchTerm"),n.xp6(1),n.Q6J("title",t.created_at),n.xp6(1),n.hij(" ",t.created_at_human," ")}}let Tt=(()=>{class t extends lt.v{constructor(t,e,i,n,s){super(),this.http=t,this.urls=e,this.zone=i,this.el=n,this.conversation=s,this.pagination$=new tt.X(null),this.logVisible$=new tt.X(!0),this.loading$=new tt.X(!1)}ngOnInit(){super.ngOnInit()}ngOnChanges(t){var e,i;(null===(e=t.user.previousValue)||void 0===e?void 0:e.id)!==(null===(i=t.user.currentValue)||void 0===i?void 0:i.id)&&this.loadActivity()}loadActivity(t){this.loading$.next(!0),this.http.get("activity-log",{userId:this.user.id,page:t||1}).pipe((0,d.x)(()=>this.loading$.next(!1))).subscribe(e=>{this.pagination$.next(t?Object.assign(Object.assign({},e.pagination),{data:[...this.pagination$.value.data,...e.pagination.data]}):e.pagination)})}toggleVisibility(){this.logVisible$.next(!this.logVisible$.value)}loadMoreItems(){this.loadActivity(this.pagination$.value.current_page+1)}canLoadMore(){return this.pagination$.value.last_page>this.pagination$.value.current_page}isLoading(){return this.loading$.value}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(dt.r),n.Y36(ut.X),n.Y36(n.R0b),n.Y36(n.SBq),n.Y36(r.r))},t.\u0275cmp=n.Xpm({type:t,selectors:[["activity-panel"]],inputs:{user:"user"},features:[n.qOj,n.TTD],decls:10,vars:7,consts:[[1,"sidebar-header",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],[1,"panel-content"],["class","activity",3,"highlight","last",4,"ngFor","ngForOf"],[1,"activity"],[1,"header"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"time",3,"title"],[1,"sideline"],[1,"line"],[1,"circle"],["trans",""],["target","_blank",1,"bold",3,"routerLink"],[4,"ngIf"],["trans","",4,"ngIf"],["target","_blank",1,"bold",3,"routerLink","queryParams"],["trans","",3,"transValues"],[1,"bold"]],template:function(t,e){if(1&t&&(n.TgZ(0,"div"),n.ALo(1,"async"),n.TgZ(2,"div",0),n.NdJ("click",function(){return e.toggleVisibility()}),n.TgZ(3,"div",1),n._uU(4,"Interactions"),n.qZA(),n.TgZ(5,"button",2),n._UZ(6,"mat-icon",3),n.qZA(),n.qZA(),n.TgZ(7,"div",4),n.YNc(8,kt,11,10,"div",5),n.ALo(9,"async"),n.qZA(),n.qZA()),2&t){let t;n.ekj("panel-content-visible",n.lcZ(1,3,e.logVisible$)),n.xp6(8),n.Q6J("ngForOf",null==(t=n.lcZ(9,5,e.pagination$))?null:t.data)}},directives:[p.P,h.Hw,b.sg,b.RF,b.n9,s.yS,b.O5],pipes:[b.Ov],styles:["[_nghost-%COMP%]{display:block}.activity[_ngcontent-%COMP%]{position:relative;margin:0 -15px;padding:6px 15px 6px 38px}.activity.highlight[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis)}.activity.last[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:none}.time[_ngcontent-%COMP%]{color:var(--be-secondary-text);text-transform:capitalize}.bold[_ngcontent-%COMP%]{font-weight:500;color:currentColor}.sideline[_ngcontent-%COMP%]{position:absolute;top:10px;bottom:0;left:16px}.line[_ngcontent-%COMP%]{width:1px;height:calc(100% + 10px);background:var(--be-divider-default)}.circle[_ngcontent-%COMP%]{position:absolute;left:-6px;top:0;width:12px;height:12px;border-radius:50%;border:1px solid var(--be-divider-default);background-color:var(--be-background-alternative)}"],changeDetection:0}),t})();function wt(t,e){if(1&t&&(n.TgZ(0,"mat-chip",27),n._uU(1),n.qZA()),2&t){const t=e.$implicit;n.xp6(1),n.Oqu(t.display_name)}}function At(t,e){if(1&t&&(n.TgZ(0,"div",24),n.TgZ(1,"mat-chip-list",25),n.YNc(2,wt,2,1,"mat-chip",26),n.qZA(),n.qZA()),2&t){const t=n.oxw(2);n.xp6(1),n.Q6J("selectable",!1),n.xp6(1),n.Q6J("ngForOf",t.requester.tags)}}const qt=function(t){return["/mailbox/users",t]};function _t(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"div",9),n.TgZ(1,"a",10),n._UZ(2,"img",11),n.qZA(),n.TgZ(3,"div",12),n.TgZ(4,"div",13),n.TgZ(5,"div",14),n._uU(6),n.qZA(),n.TgZ(7,"button",15),n._UZ(8,"mat-icon",16),n.qZA(),n.qZA(),n.TgZ(9,"div",17),n._UZ(10,"mat-icon",18),n.TgZ(11,"span",19),n._uU(12),n.qZA(),n.qZA(),n.TgZ(13,"mat-menu",null,20),n.TgZ(15,"a",21),n._uU(16,"Edit Profile"),n.qZA(),n.TgZ(17,"button",22),n.NdJ("click",function(){return n.CHM(t),n.oxw().changeCustomer()}),n._uU(18,"Change Customer"),n.qZA(),n.qZA(),n.YNc(19,At,3,2,"div",23),n.qZA(),n.qZA()}if(2&t){const t=n.MAs(14),e=n.oxw();n.xp6(1),n.Q6J("routerLink",n.VKq(9,qt,e.requester.id)),n.xp6(1),n.Q6J("src",e.requester.avatar,n.LSH),n.xp6(3),n.Q6J("title",e.requester.display_name),n.xp6(1),n.Oqu(e.requester.display_name),n.xp6(1),n.Q6J("matMenuTriggerFor",t),n.xp6(4),n.Q6J("title",e.requester.email),n.xp6(1),n.Oqu(e.requester.email),n.xp6(3),n.Q6J("routerLink",n.VKq(11,qt,e.requester.id)),n.xp6(4),n.Q6J("ngIf",e.requester.tags.length)}}function It(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"div",30),n.NdJ("click",function(){const e=n.CHM(t).$implicit;return n.oxw(2).openTicketModal(e.id)}),n._UZ(1,"mat-icon",18),n.TgZ(2,"span"),n._uU(3),n.qZA(),n.qZA()}if(2&t){const t=e.$implicit;n.ekj("last",e.last)("open",!t.closed_at),n.xp6(3),n.Oqu(t.subject)}}function Jt(t,e){if(1&t&&(n.TgZ(0,"div",28),n.YNc(1,It,4,5,"div",29),n.qZA()),2&t){const t=n.oxw();n.xp6(1),n.Q6J("ngForOf",t.otherTickets)}}function Ut(t,e){if(1&t&&n._UZ(0,"activity-panel",31),2&t){const t=n.oxw();n.Q6J("user",t.requester)}}let Ct=(()=>{class t{constructor(t,e,i,n,s,o){this.modal=t,this.tickets=e,this.conversation=i,this.route=n,this.toast=s,this.settings=o,this.previousTicketsVisible=!0}ngOnInit(){this.route.data.subscribe(t=>{this.activeTicket=t.ticket,this.loadUserData()})}openTicketModal(t){const e={ticketId:t,activeTicketId:this.conversation.get().id};this.modal.open(z.D,e,{panelClass:"conversation-modal-container"}).afterClosed().subscribe(e=>{!e||(this.otherTickets=this.otherTickets.filter(e=>e.id!==t),this.conversation.init(e))})}getUserTicketsExceptCurrent(){!this.requester||this.tickets.getTickets({userId:this.requester.id,perPage:6}).subscribe(t=>{this.otherTickets=t.pagination.data.filter(t=>t.id!==this.activeTicket.id)})}changeCustomer(){this.modal.open(K.y).beforeClosed().subscribe(t=>{!t||this.tickets.update(this.activeTicket.id,{user_id:t.id}).subscribe(()=>{this.requester=t,this.loadUserData(),this.toast.open("Customer changed.")})})}loadUserData(){this.requester=this.activeTicket.user,this.getUserTicketsExceptCurrent()}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(C.u),n.Y36(u.g),n.Y36(r.r),n.Y36(s.gz),n.Y36(X.F),n.Y36(W.Z))},t.\u0275cmp=n.Xpm({type:t,selectors:[["conversation-sidebar"]],decls:10,vars:6,consts:[["class","user-info sidebar-panel",4,"ngIf"],[1,"sidebar-panel",3,"customer"],[1,"sidebar-panel"],[1,"sidebar-header",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],["class","tickets-list panel-content",4,"ngIf"],["class","sidebar-panel last",3,"user",4,"ngIf"],[1,"user-info","sidebar-panel"],[1,"avatar",3,"routerLink"],["alt","Avatar",3,"src"],[1,"user-details"],[1,"name"],[1,"text",3,"title"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","settings"],[1,"info-line"],["svgIcon","mail"],[3,"title"],["editCustomerMenu","matMenu"],["mat-menu-item","","trans","",3,"routerLink"],["mat-menu-item","","trans","",3,"click"],["class","user-tags",4,"ngIf"],[1,"user-tags"],[3,"selectable"],["class","mat-compact-chip",4,"ngFor","ngForOf"],[1,"mat-compact-chip"],[1,"tickets-list","panel-content"],["class","ticket",3,"last","open","click",4,"ngFor","ngForOf"],[1,"ticket",3,"click"],[1,"sidebar-panel","last",3,"user"]],template:function(t,e){1&t&&(n.YNc(0,_t,20,13,"div",0),n._UZ(1,"envato-purchases",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.NdJ("click",function(){return e.previousTicketsVisible=!e.previousTicketsVisible}),n.TgZ(4,"div",4),n._uU(5,"Previous conversations"),n.qZA(),n.TgZ(6,"button",5),n._UZ(7,"mat-icon",6),n.qZA(),n.qZA(),n.YNc(8,Jt,2,1,"div",7),n.qZA(),n.YNc(9,Ut,1,1,"activity-panel",8)),2&t&&(n.Q6J("ngIf",e.requester),n.xp6(1),n.Q6J("customer",e.requester),n.xp6(1),n.ekj("panel-content-visible",e.previousTicketsVisible),n.xp6(6),n.Q6J("ngIf",e.otherTickets),n.xp6(1),n.Q6J("ngIf",e.settings.get("tickets.log_activity")))},directives:[b.O5,rt,p.P,h.Hw,s.yS,g.lW,J.p6,J.VK,J.OP,ct.qn,b.sg,ct.HS,Tt],styles:["conversation-sidebar{display:flex;flex-direction:column;flex-shrink:0;width:240px;background-color:var(--be-background-alternative);border-left:1px solid var(--be-divider-default)}@media screen and (max-width: 768px){conversation-sidebar{display:none}}conversation-sidebar .user-tags{margin-top:10px}conversation-sidebar .user-info{margin:15px 0 10px;border-bottom:1px solid var(--be-divider-default);padding-bottom:10px}conversation-sidebar .user-info .avatar{display:block;width:100%;text-align:center;margin-bottom:10px}conversation-sidebar .user-info .avatar img{max-width:55px;max-height:65px;margin:0 auto;border-radius:4px}conversation-sidebar .user-info .user-details{color:var(--be-secondary-text)}conversation-sidebar .user-info .user-details a{color:inherit}conversation-sidebar .user-info .user-details .name{display:flex;align-items:center;font-size:1.7rem;max-height:24px}conversation-sidebar .user-info .user-details .name .text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}conversation-sidebar .user-info .user-details .name .mat-icon-button{margin-left:auto;color:var(--be-secondary-text);flex-shrink:0}conversation-sidebar .user-info .user-details .name .mat-icon{width:18px;height:18px}conversation-sidebar .info-line{display:flex;align-items:center;padding:3px 0;overflow:hidden;text-overflow:ellipsis}conversation-sidebar .info-line a{color:inherit}conversation-sidebar .info-line .mat-icon{width:18px;height:18px;margin-right:5px}conversation-sidebar .sidebar-header{position:relative;display:flex;align-items:center;margin-bottom:15px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}conversation-sidebar .sidebar-header .text{margin-right:auto;font-weight:500}conversation-sidebar .sidebar-header .toggle-button{flex-shrink:0;width:24px;height:24px;color:var(--be-secondary-text)}conversation-sidebar .sidebar-header .toggle-button .mat-icon{transition:all .3s ease}conversation-sidebar .sidebar-panel{padding:0 15px;margin-bottom:15px}conversation-sidebar .sidebar-panel:not(.last){padding-bottom:15px;border-bottom:1px solid var(--be-divider-lighter)}conversation-sidebar .panel-content{display:none}conversation-sidebar .panel-content-visible .panel-content{display:block}conversation-sidebar .panel-content-visible .toggle-button .mat-icon{display:inline-block;transform:rotate(180deg)}conversation-sidebar activity-panel{height:100px;flex:1 1 auto;overflow:auto}conversation-sidebar .ticket{color:var(--be-secondary-text);cursor:pointer}conversation-sidebar .ticket:not(.last){margin-bottom:15px}conversation-sidebar .ticket .mat-icon{color:var(--be-secondary-text);width:17px;height:17px;vertical-align:middle;margin-right:3px}conversation-sidebar .ticket:hover{text-decoration:underline;color:var(--be-text)}conversation-sidebar .ticket.open{color:var(--be-text)}\n"],encapsulation:2}),t})();const Qt=["scrollContainer"];function Ot(t,e){1&t&&n._UZ(0,"conversation-sidebar")}const Yt=[[["","toolbar-content",""]]],Mt=["[toolbar-content]"];let Nt=(()=>{class t{constructor(t,e,i,n,s){this.route=t,this.uploads=e,this.currentUser=i,this.conversation=n,this.el=s,this.hideBackButton=!1,this.hideSidebar=!1}ngAfterViewInit(){this.conversation.scrollContainer=this.scrollContainer.nativeElement}ngOnInit(){this.route.data.subscribe(t=>{this.conversation.init(t.ticket),this.el.nativeElement.focus()})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.gz),n.Y36(o.f),n.Y36(a.I),n.Y36(r.r),n.Y36(n.SBq))},t.\u0275cmp=n.Xpm({type:t,selectors:[["conversation"]],viewQuery:function(t,e){if(1&t&&n.Gf(Qt,5),2&t){let t;n.iGM(t=n.CRH())&&(e.scrollContainer=t.first)}},inputs:{hideBackButton:"hideBackButton",hideSidebar:"hideSidebar"},ngContentSelectors:Mt,decls:11,vars:3,consts:[[1,"conversation-container"],[3,"hideBackButton"],["conversationInfiniteScroll","",1,"ticket-container"],["scrollContainer",""],[4,"ngIf"],[1,"overlay",3,"isVisible"]],template:function(t,e){1&t&&(n.F$t(Yt),n.ynx(0),n.TgZ(1,"div",0),n.TgZ(2,"conversation-toolbar",1),n.Hsn(3),n.qZA(),n.TgZ(4,"div",2,3),n._UZ(6,"conversation-header"),n._UZ(7,"conversation-text-editor"),n._UZ(8,"conversation-replies"),n.qZA(),n.qZA(),n.YNc(9,Ot,1,0,"conversation-sidebar",4),n.BQk(),n._UZ(10,"loading-indicator",5)),2&t&&(n.xp6(2),n.Q6J("hideBackButton",e.hideBackButton),n.xp6(7),n.Q6J("ngIf",!e.hideSidebar),n.xp6(1),n.Q6J("isVisible",e.conversation.replies.isLoading||e.conversation.isLoading))},directives:[$,B.b,D.M,j.B,G.Q,b.O5,V.Q,Ct],styles:["conversation{display:flex;position:relative}conversation .conversation-container{flex:1 1 auto;min-width:0;height:calc(100vh - 70px);overflow:auto}conversation .conversation-container.invisible{visibility:hidden}conversation .ticket-container{display:flex;flex-direction:column;height:calc(100% - 60px);overflow:auto}\n"],encapsulation:2}),t})()},8574:function(t,e,i){i.d(e,{m:function(){return O}});var n=i(38583),s=i(3679),o=i(24668),a=i(74180),r=i(61),c=i(35778),l=i(66010),d=i(20964),u=i(69958),p=i(20082),g=i(6350),h=i(35177),m=i(5970),f=i(5259),v=i(76435),b=i(22238),x=i(75892),y=i(18295),Z=i(76627),k=i(33935),T=i(51095),w=i(49866),A=i(98097),q=i(11436),_=i(43389),I=i(13202),J=i(66705),U=i(58341),C=i(37716),Q=i(15515);let O=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=C.oAB({type:t}),t.\u0275inj=C.cJS({providers:[c.U,l.r,h.I,u.g,d.V,p.c,g.n,m.G],imports:[[n.ez,s.u5,s.UX,o.Bz,f.y,v.q,y.l,w.N,A.X,_.p,I.R,J.z,x.t,q.AV,b.Is,Z.Ps,k.Tx,T.ot,U.Hi]]}),t})();C.B6R(a.D,[b.xY,r.S,Z.Hw,n.O5,T.lW,Q.P],[])},66010:function(t,e,i){i.d(e,{r:function(){return p}});var n=i(37716),s=i(76590),o=i(26979),a=i(93342),r=i(6350),c=i(35718),l=i(69958),d=i(35177),u=i(5970);let p=(()=>{class t{constructor(t,e,i,a,r){this.draft=t,this.toast=e,this.tickets=i,this.replies=a,this.afterReplyAction=r,this.isLoading=!1,this.model=new s.Sj({tags:[]}),this.status=new o.V,this.replySaving=!1,this.editorIsOpen=!1,this.afterInit=new n.vpe}get(){return this.model}getStatus(){return this.status||new o.V}getCategory(){const t=this.model.tags.find(t=>"status"!==t.type);return t&&t.categories?t.categories[0]:null}setStatus(t){!t||(this.status=t)}openEditor(){this.editorIsOpen=!0,setTimeout(()=>this.editor&&this.editor.focus())}closeEditor(){this.editorIsOpen=!1}isEditorOpen(){return this.editorIsOpen}setEditor(t){this.editor=t}setDraft(t){this.draft.set(t),this.editor.setContents(t.body)}addTag(t){this.model.tags.find(e=>e.id===t.id)||this.model.tags.unshift(t)}submitReply(t={}){return this.replySaving=!0,this.tickets.saveReply(this.model.id,this.draft.getPayload(t)).pipe((0,a.b)(e=>{this.replySaving=!1,this.draft.delete(),this.performAfterReplyAction(),this.setStatus(t.status),this.replies.add(e.reply)},t=>{this.toast.open(t.message||"There was an issue submitting this reply."),this.replySaving=!1,this.isLoading=!1}))}performAfterReplyAction(){this.afterReplyAction.get()&&"stay_on_page"!==this.afterReplyAction.get()&&(this.isLoading=!0),this.afterReplyAction.perform()}init(t){!t||(this.model=t,this.status=t.tags.find(t=>"status"===t.type),this.replies.init(this.model.replies,this.model.id),this.draft.setTicketId(this.model.id),this.afterReplyAction.setTicketId(this.model.id),this.isLoading=!1,this.afterInit.emit())}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(r.n),n.LFG(c.F),n.LFG(l.g),n.LFG(d.I),n.LFG(u.G))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},6350:function(t,e,i){i.d(e,{n:function(){return p}});class n{constructor(t={}){this.type="replies";for(const e in t)this[e]=t[e]}}var s=i(25917),o=i(42145),a=i(12627),r=i(5304),c=i(18819),l=i(37716),d=i(69958),u=i(9141);let p=(()=>{class t{constructor(t,e){this.tickets=t,this.uploadQueue=e,this.reset()}get(){return this.model}set(t){this.model=t}setBody(t){this.model.body=t}setTicketId(t){this.ticketId=t}isEmpty(){return 0===this.model.body.length&&0===this.model.uploads.length}uploadFiles(t){this.uploadQueue.start(t).pipe((0,o.R)((t,e)=>[...t,e.fileEntry],[]),(0,a.Z)()).subscribe(t=>{this.model.uploads=[...this.model.uploads,...t],this.save()})}detachUpload(t){const e=this.model.uploads.filter(e=>e.id!==t.id).map(t=>t.id);this.tickets.updateReply(this.model.id,{uploads:e}).subscribe(()=>{const e=this.get().uploads.findIndex(e=>e.id===t.id);this.get().uploads.splice(e,1)})}save(t={}){if(this.isEmpty())return;const e=this.tickets.saveDraft(this.ticketId,this.getPayload(t),this.model.id).pipe((0,r.K)(()=>(0,s.of)({reply:this.get()})),(0,c.B)());return e.subscribe(t=>{this.set(t.reply)}),e}delete(){this.model.id&&this.tickets.deleteReply(this.model.id).subscribe(),this.reset()}getPayload(t={}){return Object.assign({},{body:this.model.body||null,uploads:this.model.uploads.map(t=>t.id)},t)}reset(){this.set(new n({uploads:[],body:""}))}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(d.g),l.LFG(u.A))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},19867:function(t,e,i){i.d(e,{b:function(){return a}});var n=i(37716),s=i(86911),o=i(66010);let a=(()=>{class t extends s.v{constructor(t,e,i){super(),this.el=t,this.conversation=e,this.zone=i,this.scrollTargetIsDocument=!1}ngOnInit(){this.scrollTargetIsDocument&&(this.el=new n.SBq(document)),super.ngOnInit()}getScrollContainer(){return document}loadMoreItems(){this.conversation.replies.loadMore()}isLoading(){return this.conversation.replies.isLoading}canLoadMore(){return this.conversation.replies.canLoadMore()}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(n.SBq),n.Y36(o.r),n.Y36(n.R0b))},t.\u0275dir=n.lG2({type:t,selectors:[["","conversationInfiniteScroll",""]],inputs:{scrollTargetIsDocument:"scrollTargetIsDocument"},features:[n.qOj]}),t})()},76590:function(t,e,i){i.d(e,{di:function(){return n},Sj:function(){return s}});const n="tickets.update";class s{constructor(t={}){for(const e in t)this[e]=t[e]}}},4075:function(t,e,i){i.d(e,{$:function(){return h}});var n=i(37716),s=i(3679),o=i(54395),a=i(87519),r=i(33935),c=i(69958),l=i(20082),d=i(35718),u=i(76627),p=i(38583);function g(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"button",7),n.NdJ("click",function(){const e=n.CHM(t).$implicit;return n.oxw().addTag(e.name)}),n._uU(1),n.qZA()}if(2&t){const t=e.$implicit;n.xp6(1),n.Oqu(t.name)}}let h=(()=>{class t{constructor(t,e,i){this.tickets=t,this.tagService=e,this.toast=i,this.ticketIds=[],this.tagAdded=new n.vpe,this.tagQuery=new s.NI,this.searchedOnce=!1,this.trackByFn=(t,e)=>e.id}ngOnInit(){this.bindTagQueryInput(),this.trigger.menuOpened.subscribe(()=>{this.searchedOnce||this.searchForTags(null,{perPage:5})}),this.trigger.menuClosed.subscribe(()=>{this.clearSearchField()})}open(){this.trigger.openMenu()}close(){this.trigger.closeMenu()}addTag(t){this.tickets.addTag(t,this.ticketIds).subscribe(t=>{this.clearSearchField(),this.toast.open("Tag added"),this.tagAdded.emit(t.data),this.close()})}clearSearchField(){!this.tagQuery.value||this.tagQuery.setValue(null)}bindTagQueryInput(){this.tagQuery.valueChanges.pipe((0,o.b)(300),(0,a.x)()).subscribe(t=>{this.searchForTags(t)})}searchForTags(t,e={}){this.tagService.search(t,e).subscribe(t=>this.tags=t.pagination.data)}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(c.g),n.Y36(l.c),n.Y36(d.F))},t.\u0275cmp=n.Xpm({type:t,selectors:[["add-tag-dropdown"]],viewQuery:function(t,e){if(1&t&&n.Gf(r.p6,7),2&t){let t;n.iGM(t=n.CRH())&&(e.trigger=t.first)}},inputs:{ticketIds:"ticketIds"},outputs:{tagAdded:"tagAdded"},decls:7,vars:5,consts:[[1,"no-style","add-tag-button","toolbar-item",3,"matMenuTriggerFor"],["svgIcon","add-tag-custom"],[1,"add-tag-menu",3,"overlapTrigger"],["addTagMenu","matMenu"],[1,"input-container",3,"ngSubmit","click"],["type","text","mat-menu-item","",1,"tag-search-input",3,"formControl"],["mat-menu-item","","class","tag-item",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["mat-menu-item","",1,"tag-item",3,"click"]],template:function(t,e){if(1&t&&(n.TgZ(0,"button",0),n._UZ(1,"mat-icon",1),n.qZA(),n.TgZ(2,"mat-menu",2,3),n.TgZ(4,"form",4),n.NdJ("ngSubmit",function(){return e.addTag(e.tagQuery.value)})("click",function(t){return t.stopPropagation()}),n._UZ(5,"input",5),n.qZA(),n.YNc(6,g,2,1,"button",6),n.qZA()),2&t){const t=n.MAs(3);n.Q6J("matMenuTriggerFor",t),n.xp6(2),n.Q6J("overlapTrigger",!1),n.xp6(3),n.Q6J("formControl",e.tagQuery),n.xp6(1),n.Q6J("ngForOf",e.tags)("ngForTrackBy",e.trackByFn)}},directives:[r.p6,u.Hw,r.VK,s._Y,s.JL,s.F,s.Fj,r.OP,s.JJ,s.oH,p.sg],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.input-container[_ngcontent-%COMP%]{padding:2px 10px 10px}.mat-menu-item[_ngcontent-%COMP%]:first-of-type{border-top:1px solid var(--be-divider-default)}"]}),t})()},44625:function(t,e,i){i.d(e,{H:function(){return m}});var n=i(37716),s=i(76590),o=i(33935),a=i(15257),r=i(73429),c=i(24688),l=i(69958),d=i(35718),u=i(76627),p=i(15515),g=i(38583);function h(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"button",7),n.NdJ("click",function(){const e=n.CHM(t).$implicit;return n.oxw().assignTicketsTo(e.id)}),n._uU(1),n.qZA()}if(2&t){const t=e.$implicit,i=n.oxw();n.ekj("active",i.ticket&&i.ticket.assigned_to==t.id),n.xp6(1),n.hij(" ",t.display_name," ")}}let m=(()=>{class t{constructor(t,e,i,s){this.users=t,this.currentUser=e,this.tickets=i,this.toast=s,this.agents=[],this.assigned=new n.vpe}ngOnInit(){this.trigger.menuOpened.pipe((0,a.q)(1)).subscribe(()=>{this.fetchAgents()})}open(){this.trigger.openMenu()}close(){this.trigger.closeMenu()}assignTicketsTo(t=null){this.tickets.assign(this.ticketIds?this.ticketIds:[this.ticket.id],t).subscribe(()=>{this.ticket&&(this.ticket.assigned_to=t),this.toast.open("Tickets assigned"),this.assigned.emit()})}fetchAgents(){this.users.getAll({permission:s.di,perPage:35}).subscribe(t=>{this.agents=t.filter(t=>t.id!==this.currentUser.get("id"))})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(r.Q),n.Y36(c.I),n.Y36(l.g),n.Y36(d.F))},t.\u0275cmp=n.Xpm({type:t,selectors:[["assign-ticket-dropdown"]],viewQuery:function(t,e){if(1&t&&n.Gf(o.p6,7),2&t){let t;n.iGM(t=n.CRH())&&(e.trigger=t.first)}},inputs:{ticket:"ticket",ticketIds:"ticketIds"},outputs:{assigned:"assigned"},decls:9,vars:7,consts:[[1,"no-style","toolbar-item",3,"matMenuTriggerFor"],["svgIcon","user-custom"],[1,"assign-ticket-menu",3,"overlapTrigger"],["assignTicketMenu","matMenu"],["mat-menu-item","","trans","",1,"anyone-item",3,"click"],["mat-menu-item","","trans","",1,"me-item",3,"click"],["mat-menu-item","","class","agent-item",3,"active","click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"agent-item",3,"click"]],template:function(t,e){if(1&t&&(n.TgZ(0,"button",0),n._UZ(1,"mat-icon",1),n.qZA(),n.TgZ(2,"mat-menu",2,3),n.TgZ(4,"button",4),n.NdJ("click",function(){return e.assignTicketsTo()}),n._uU(5," Anyone "),n.qZA(),n.TgZ(6,"button",5),n.NdJ("click",function(){return e.assignTicketsTo(e.currentUser.get("id"))}),n._uU(7," Me "),n.qZA(),n.YNc(8,h,2,3,"button",6),n.qZA()),2&t){const t=n.MAs(3);n.Q6J("matMenuTriggerFor",t),n.xp6(2),n.Q6J("overlapTrigger",!1),n.xp6(2),n.ekj("active",e.ticket&&!e.ticket.assigned_to),n.xp6(2),n.ekj("active",e.ticket&&e.ticket.assigned_to===e.currentUser.get("id")),n.xp6(2),n.Q6J("ngForOf",e.agents)}},directives:[o.p6,u.Hw,o.VK,o.OP,p.P,g.sg],styles:["assign-ticket-dropdown{position:relative;display:inline-block}.assign-ticket-menu.mat-menu-panel{max-height:500px}.assign-ticket-menu.mat-menu-panel .mat-menu-item.active{background-color:var(--be-hover)}\n"],encapsulation:2}),t})()},87291:function(t,e,i){i.d(e,{N:function(){return r}});var n=i(26215),s=i(68939),o=i(37716),a=i(90299);let r=(()=>{class t{constructor(t){this.httpClient=t,this.allTags$=new n.X([]),this.categoryTags=[],this.statusTags=[],this.activeTagId$=new n.X(null),this.loading$=new n.X(!1),this.allTags$.value.length||this.refresh()}setTags(t){!t||(this.statusTags=t.filter(t=>"status"===t.type),this.categoryTags=t.filter(t=>"category"===t.type),this.viewTags=t.filter(t=>"view"===t.type),this.allTags$.next(t))}refresh(){this.loading$.next(!0),this.httpClient.get("tags/agent-mailbox").pipe((0,s.x)(()=>this.loading$.next(!1))).subscribe(t=>{this.setTags(t.tags)})}setActiveTag(t){this.activeTagId$.next(t||"unassigned")}getTagByIdOrName(t){return this.allTags$.value.find(e=>e.id===+t||e.name===t)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(a.r))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);